(window.webpackJsonp=window.webpackJsonp||[]).push([[65],{SpuA:function(t,o,e){"use strict";e.d(o,"a",function(){return a});var i=e("wd/R"),n=e("fXoL");let a=(()=>{class t{transform(t){console.log(t,"fechin");let o=i.utc(t).toDate();return i(o).format("dddd, DD MMMM YYYY h:mm:a")}}return t.\u0275fac=function(o){return new(o||t)},t.\u0275pipe=n.Kb({name:"cambioUTC",type:t,pure:!0}),t})()},kKQS:function(t,o,e){"use strict";e.r(o),e.d(o,"MapaGruaPageModule",function(){return w});var i=e("ofXK"),n=e("3Pt+"),a=e("TEn/"),s=e("tyNb"),r=e("mrSG"),c=e("HDdC"),d=e("fXoL"),l=e("fsfq"),u=e("0xwK"),b=e("fmoy"),g=e("7JkF"),h=e("SpuA");function m(t,o){if(1&t){const t=d.Pb();d.Ob(0,"ion-button",14),d.Wb("click",function(){d.pc(t);const o=d.Yb(2);return o.tomar(o.grua)}),d.wc(1,"TOMAR SOLICITUD"),d.Nb()}}function p(t,o){if(1&t){const t=d.Pb();d.Ob(0,"ion-button",15),d.Wb("click",function(){return d.pc(t),d.Yb(2).ir()}),d.wc(1,"VER EN BANDEJA DE AGREGADOS"),d.Nb()}}function f(t,o){if(1&t&&(d.Ob(0,"ion-card",7),d.Ob(1,"strong",8),d.wc(2),d.Zb(3,"cambioUTC"),d.Nb(),d.Ob(4,"ion-card-title",9),d.wc(5),d.Nb(),d.Ob(6,"div",10),d.Ob(7,"p"),d.wc(8),d.Nb(),d.Mb(9,"div",11),d.Ob(10,"div"),d.Ob(11,"strong"),d.wc(12),d.Nb(),d.Nb(),d.Ob(13,"div"),d.Ob(14,"strong"),d.wc(15,"Tel\xe9fono: "),d.Nb(),d.wc(16),d.Nb(),d.Ob(17,"div"),d.Ob(18,"strong"),d.wc(19,"Correo: "),d.Nb(),d.wc(20),d.Nb(),d.Mb(21,"br"),d.Nb(),d.vc(22,m,2,0,"ion-button",12),d.vc(23,p,2,0,"ion-button",13),d.Nb()),2&t){const t=d.Yb();d.Ab(2),d.xc(d.ac(3,9,t.grua.fecha)),d.Ab(3),d.yc("",t.grua.creador.nombrecompleto," "),d.Ab(3),d.xc(t.grua.descripcion),d.Ab(4),d.zc("Ubicado en ",t.grua.creador.ciudad,", ",t.grua.creador.pais,""),d.Ab(4),d.yc(" ",t.grua.creador.tel,""),d.Ab(4),d.yc(" ",t.grua.creador.correo,""),d.Ab(2),d.fc("ngIf",t.mostrar),d.Ab(1),d.fc("ngIf",!t.mostrar)}}let k=(()=>{class t{constructor(t,o,e,i,n,a,s){this.router=t,this.almacenamiento=o,this.apiMonitoreo=e,this.toast=i,this.socket=n,this.alert=a,this.modal=s,this.cargado=!1,this.mostrar=!0,this.chat=!1}ngOnInit(){}ionViewWillEnter(){this.mostrar=!this.grua.tomado}escuchareliminados(){return new c.a(t=>{this.socket.on("gruachao",o=>{t.next(o)})})}cerrar(){this.modal.dismiss()}ir(){this.modal.dismiss(),this.router.navigate(["/central/menu/monitoreo/listado-agregados"])}tomar(t){return Object(r.a)(this,void 0,void 0,function*(){const o=yield this.alert.create({header:"Atenci\xf3n!",message:"\xbfQuieres ayudar al usuario con su solicitud.",buttons:[{text:"Cancelar",cssClass:"cancelarAlerta",role:"cancel",handler:()=>{}},{text:"Acepto",cssClass:"botonalerta",handler:()=>Object(r.a)(this,void 0,void 0,function*(){const o=yield this.almacenamiento.obtenerToken();o&&this.apiMonitoreo.GruaEditar(o.token,{id:t._id}).subscribe(e=>{console.log(e,"DATON",t,o.nombre),this.cargado=!0,e.exe?(this.socket.emit("gruatomar",{info:{chat:e.chat,personas:e.response},usuario:t.creador._id,nombre:o.nombre}),this.modal.dismiss({exe:!0,grua:this.grua})):this.toast.toastError("No se pudo completar la petici\xf3n, int\xe9ntelo m\xe1s tarde")},t=>{this.toast.toastError("No se pudo completar la petici\xf3n, int\xe9ntelo m\xe1s tarde")})})}]});yield o.present()})}}return t.\u0275fac=function(o){return new(o||t)(d.Lb(s.g),d.Lb(l.a),d.Lb(u.a),d.Lb(b.a),d.Lb(g.a),d.Lb(a.b),d.Lb(a.qb))},t.\u0275cmp=d.Fb({type:t,selectors:[["app-modal-info-grua"]],inputs:{grua:"grua"},decls:10,vars:1,consts:[[1,"ion-no-border"],["color","oscuro"],["slot","end"],[3,"click"],["name","close-outline","slot","icon-only"],[1,"opts"],["color","light","mode","ios",4,"ngIf"],["color","light","mode","ios"],[1,"gris"],[1,"tit"],[1,"info"],[1,"separador"],["color","barra","mode","ios","expand","block",3,"click",4,"ngIf"],["color","warning","mode","ios","expand","block",3,"click",4,"ngIf"],["color","barra","mode","ios","expand","block",3,"click"],["color","warning","mode","ios","expand","block",3,"click"]],template:function(t,o){1&t&&(d.Ob(0,"ion-header",0),d.Ob(1,"ion-toolbar",1),d.Ob(2,"ion-title"),d.wc(3,"Solicitud - Informaci\xf3n"),d.Nb(),d.Ob(4,"ion-buttons",2),d.Ob(5,"ion-button",3),d.Wb("click",function(){return o.cerrar()}),d.Mb(6,"ion-icon",4),d.Nb(),d.Nb(),d.Nb(),d.Nb(),d.Ob(7,"ion-content"),d.Ob(8,"div",5),d.vc(9,f,24,11,"ion-card",6),d.Nb(),d.Nb()),2&t&&(d.Ab(9),d.fc("ngIf",o.grua))},directives:[a.z,a.lb,a.jb,a.k,a.j,a.A,a.t,i.j,a.l,a.p],pipes:[h.a],styles:[".tit[_ngcontent-%COMP%]{font-size:18px}.gris[_ngcontent-%COMP%], .tit[_ngcontent-%COMP%]{padding:10px}.gris[_ngcontent-%COMP%]{color:var(--ion-color-medium)}.info[_ngcontent-%COMP%]{padding:10px}.tp[_ngcontent-%COMP%]{z-index:10;background-color:initial}.ct[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;font-size:20px;font-weight:300}.separadorr[_ngcontent-%COMP%]{padding:10px;color:#fff;background-color:#4a4a4a}.msg[_ngcontent-%COMP%]{position:absolute;top:0;right:0;text-align:center;padding:5px 10px;border-radius:10px}.escribiendo[_ngcontent-%COMP%]{color:#627e42;font-weight:700;font-size:14px;height:20px}.relativo[_ngcontent-%COMP%]{position:relative}.nv[_ngcontent-%COMP%]{position:absolute;bottom:5px;right:5px;background-color:#627e42;color:#fff;text-align:center;min-width:20px;min-height:20px;max-width:50px;max-height:50px;border-radius:100%}.infoo[_ngcontent-%COMP%]{font-size:14px}.ticket[_ngcontent-%COMP%]{color:#e53935}.pedido[_ngcontent-%COMP%]{color:orange}.hoja[_ngcontent-%COMP%]{color:#4a4a4a}"]}),t})();var y=e("Bfh1");const O=["mapa"],v=[{path:"",component:(()=>{class t{constructor(t,o,e,i,n,a,s){this.almacenamiento=t,this.loading=o,this.modal=e,this.geoReferencia=i,this.toastService=n,this.apiMonitoreo=a,this.socket=s,this.lng=0,this.lat=0,this.id="",this.gruas=[],this.cargado=!1,this.escucharNuevos().subscribe(t=>{if(this.cargado){this.gruas.push(t.grua);const o=document.createElement("div");o.className="marker",o.id=t.grua._id,o.style.background="#26A229",o.style.backgroundSize="100%",o.style.width="50px",o.style.height="50px",o.style.borderRadius="100%",new mapboxgl.Marker({element:o,draggable:!1}).setLngLat([t.grua.ubicacion.lng,t.grua.ubicacion.lat]).addTo(this.mapon),o.addEventListener("click",()=>{this.miModal(this.gruas.filter(o=>o._id===t.grua._id)[0])})}}),this.escucharSacados().subscribe(t=>{this.gruas=this.gruas.filter(o=>o._id!==t.id),document.getElementById(t.id).style.display="none"}),this.escuchareliminados().subscribe(t=>{console.log(t,"socket chao"),this.gruas=this.gruas.filter(o=>o._id!==t.id),document.getElementById(t.id).style.display="none"})}ngOnInit(){}ionViewWillEnter(){console.log(this.descripcion,"des"),this.comprobar()}refrescando(){this.comprobar()}cerrar(){this.modal.dismiss()}calcular(){return Object(r.a)(this,void 0,void 0,function*(){this.loadingg=yield this.loading.create({message:"Cargando Mapa...",spinner:"circles"});try{yield this.loadingg.present();const t=yield this.geoReferencia.getCurrentPosition({enableHighAccuracy:!0,timeout:2e4});t?(this.lat=t.coords.latitude,this.lng=t.coords.longitude,this.graficar()):yield this.loadingg.dismiss()}catch(t){console.log(t),yield this.loadingg.dismiss(),this.toastService.toastError("No se pudo capturar su posici\xf3n")}})}graficar(){mapboxgl.accessToken="pk.eyJ1Ijoic2FudGlhZ29mZXJuYW5kZXpkZXYiLCJhIjoiY2tmYmh6cXdzMDM0bDJ2cHRucTI4cHpkaSJ9.-01EYvsLdJOU1Oy4BtwBwA";const t=new mapboxgl.Map({container:this.mapa.nativeElement,style:"mapbox://styles/mapbox/streets-v11",center:[this.lng,this.lat],zoom:11});t.addControl(new mapboxgl.NavigationControl);const o=document.createElement("div");o.className="marker",o.style.backgroundImage="url(/assets/Marcador.png)",o.style.backgroundSize="100%",o.style.width="50px",o.style.height="70px",new mapboxgl.Marker({element:o}).setLngLat([this.lng,this.lat]).addTo(t),this.gruas.forEach(o=>{const e=document.createElement("div");e.className="marker",e.id=o._id,e.style.backgroundSize="100%",e.style.width="50px",e.style.height="50px",e.style.borderRadius="100%",o.tomados.length>0&&o.tomados.filter(t=>t._id===this.id).length>0?(e.style.background="#FFBB00",o.tomado=!0):e.style.background="#26A229",new mapboxgl.Marker({element:e,draggable:!1}).setLngLat([o.ubicacion.lng,o.ubicacion.lat]).addTo(t),e.addEventListener("click",()=>{this.miModal(this.gruas.filter(t=>t._id===o._id)[0])})}),this.cargado=!0,this.mapon=t,this.loading.dismiss()}miModal(t){return Object(r.a)(this,void 0,void 0,function*(){const o=yield this.modal.create({component:k,componentProps:{grua:t}});yield o.present();const e=yield o.onWillDismiss();e&&e.data&&e.data.exe&&(document.getElementById(e.data.grua._id).style.background="#FFBB00",this.gruas.forEach(t=>{t._id===e.data.grua._id&&(t.tomado=!0)}))})}escucharNuevos(){return new c.a(t=>{this.socket.on("gruanueva",o=>{t.next(o)})})}escucharSacados(){return new c.a(t=>{this.socket.on("gruasacados",o=>{t.next(o)})})}escuchareliminados(){return new c.a(t=>{this.socket.on("gruachao",o=>{t.next(o)})})}comprobar(){return Object(r.a)(this,void 0,void 0,function*(){const t=yield this.almacenamiento.obtenerToken();t&&(this.id=t._id,this.apiMonitoreo.consultarGruaMapa(t.token).subscribe(t=>{console.log(t,"DATON"),t.exe?(this.gruas=t.response,this.calcular()):this.toastService.toastError("No se pudo completar la petici\xf3n, int\xe9ntelo m\xe1s tarde")},t=>{this.toastService.toastError("No se pudo completar la petici\xf3n, int\xe9ntelo m\xe1s tarde")}))})}guardar(){return Object(r.a)(this,void 0,void 0,function*(){if(""!==this.descripcion&&this.ciudad.length>0&&0!==this.lat&&0!==this.lng){const t=yield this.almacenamiento.obtenerToken();t&&this.apiMonitoreo.crearGrua(t.token,{ciudad:this.ciudad,descripcion:this.descripcion,ubicacion:{lat:this.lat,lng:this.lng}}).subscribe(o=>{o.exe?(this.toastService.Especial("Solicitud creada correctamente"),console.log(o,"midata"),this.socket.emit("grua",{dispositivos:o.response,usuarios:o.response2,nombre:t.nombre,_id:t._id}),this.modal.dismiss({exe:!0})):(this.toastService.toastError("No se pudo crer la patinada, int\xe9ntelo m\xe1s tarde"),this.modal.dismiss())},t=>{this.toastService.toastError("No se pudo crer la patinada, int\xe9ntelo m\xe1s tarde"),this.modal.dismiss()})}else this.toastService.toastError("Verifique que tenga la descripci\xf3n de la patinada, el pa\xeds o ciudad de notificaci\xf3n")})}}return t.\u0275fac=function(o){return new(o||t)(d.Lb(l.a),d.Lb(a.ob),d.Lb(a.qb),d.Lb(y.a),d.Lb(b.a),d.Lb(u.a),d.Lb(g.a))},t.\u0275cmp=d.Fb({type:t,selectors:[["app-mapa-grua"]],viewQuery:function(t,o){if(1&t&&d.Ac(O,1),2&t){let t;d.oc(t=d.Xb())&&(o.mapa=t.first)}},inputs:{descripcion:"descripcion",ciudad:"ciudad"},decls:11,vars:0,consts:[[1,"ion-no-border"],["color","oscuro"],["slot","start","icon","chevron-back-outline","defaultHref","/central/menu/monitoreo"],["slot","end"],[3,"click"],["name","reload-outline","slot","icon-only"],[1,"mapa"],["mapa",""]],template:function(t,o){1&t&&(d.Ob(0,"ion-header",0),d.Ob(1,"ion-toolbar",1),d.Mb(2,"ion-back-button",2),d.Ob(3,"ion-title"),d.wc(4,"Mapa - Monitoreo de Solicitudes"),d.Nb(),d.Ob(5,"ion-buttons",3),d.Ob(6,"ion-button",4),d.Wb("click",function(){return o.refrescando()}),d.Mb(7,"ion-icon",5),d.Nb(),d.Nb(),d.Nb(),d.Nb(),d.Ob(8,"ion-content"),d.Mb(9,"div",6,7),d.Nb())},directives:[a.z,a.lb,a.g,a.h,a.jb,a.k,a.j,a.A,a.t],styles:[".mapa[_ngcontent-%COMP%]{width:100%;height:100%}"]}),t})()}];let x=(()=>{class t{}return t.\u0275fac=function(o){return new(o||t)},t.\u0275mod=d.Jb({type:t}),t.\u0275inj=d.Ib({imports:[[s.j.forChild(v)],s.j]}),t})(),w=(()=>{class t{}return t.\u0275fac=function(o){return new(o||t)},t.\u0275mod=d.Jb({type:t}),t.\u0275inj=d.Ib({imports:[[i.b,n.e,a.mb,x]]}),t})()}}]);