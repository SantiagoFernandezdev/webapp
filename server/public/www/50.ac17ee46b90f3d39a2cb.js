(window.webpackJsonp=window.webpackJsonp||[]).push([[50],{"+WxW":function(t,i,e){"use strict";e.d(i,"a",function(){return l});var n=e("AytR"),o=e("tk/3"),a=e("coGc"),r=e("lJxs"),s=e("IzEk"),c=e("MtjB"),d=e("PqYM"),b=e("fXoL"),h=e("tyNb");let l=(()=>{class t{constructor(t,i){this.http=t,this.router=i}hanflerError(t){return t.pipe(Object(a.a)(()=>Object(d.a)(3e3)),Object(r.a)(t=>{if(console.log("Entramos a intentos"),t instanceof ErrorEvent)throw new Error("Error de Red");if(404===t.status)throw new Error(" P\xe1gina no encontrada");if(401===t.status)throw new Error(" No tiene permisos ")}),Object(s.a)(3))}disponibilidad(t){const i={headers:new o.c({"x-token":t})};return this.http.get(`${n.a}/ticket/disponibilidad`,i).pipe(Object(c.a)(t=>this.hanflerError(t)))}Creardisponibilidad(t){const i={headers:new o.c({"x-token":t})};return this.http.post(`${n.a}/ticket/disponibilidad`,{},i).pipe(Object(c.a)(t=>this.hanflerError(t)))}editardisponibilidad(t,i){const e={headers:new o.c({"x-token":t})};return this.http.put(`${n.a}/ticket/disponibilidad`,i,e).pipe(Object(c.a)(t=>this.hanflerError(t)))}crearSala(t,i){const e={headers:new o.c({"x-token":t})};return this.http.post(`${n.a}/ticket/salas`,i,e).pipe(Object(c.a)(t=>this.hanflerError(t)))}misSalas(t){const i={headers:new o.c({"x-token":t})};return this.http.get(`${n.a}/ticket/salas`,i).pipe(Object(c.a)(t=>this.hanflerError(t)))}crearTicket(t,i){const e={headers:new o.c({"x-token":t})};return this.http.post(`${n.a}/ticket/crear`,i,e).pipe(Object(c.a)(t=>this.hanflerError(t)))}misTickets(t){const i={headers:new o.c({"x-token":t})};return this.http.get(`${n.a}/ticket/lista`,i).pipe(Object(c.a)(t=>this.hanflerError(t)))}misTicketsLista(t,i){const e={headers:new o.c({"x-token":t})};return this.http.put(`${n.a}/ticket/lista/negocio`,i,e).pipe(Object(c.a)(t=>this.hanflerError(t)))}salasNegocio(t,i){const e={headers:new o.c({"x-token":t})};return this.http.put(`${n.a}/ticket/salas/usuario`,i,e).pipe(Object(c.a)(t=>this.hanflerError(t)))}disponibilidadnegocio(t,i){const e={headers:new o.c({"x-token":t})};return this.http.put(`${n.a}/ticket/disponibilidad/negocio`,i,e).pipe(Object(c.a)(t=>this.hanflerError(t)))}ticketsolo(t,i){const e={headers:new o.c({"x-token":t})};return this.http.put(`${n.a}/ticket/solo`,i,e).pipe(Object(c.a)(t=>this.hanflerError(t)))}ticketelimina(t,i){const e={headers:new o.c({"x-token":t})};return this.http.put(`${n.a}/ticket/eliminar`,i,e).pipe(Object(c.a)(t=>this.hanflerError(t)))}crearHoja(t,i){const e={headers:new o.c({"x-token":t})};return this.http.post(`${n.a}/hoja/dos`,i,e).pipe(Object(c.a)(t=>this.hanflerError(t)))}consultarSala(t,i){const e={headers:new o.c({"x-token":t})};return this.http.post(`${n.a}/ticket/consultar/chat`,i,e).pipe(Object(c.a)(t=>this.hanflerError(t)))}}return t.\u0275fac=function(i){return new(i||t)(b.Qb(o.a),b.Qb(h.g))},t.\u0275prov=b.Fb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})()},NlP8:function(t,i,e){"use strict";e.r(i),e.d(i,"TallerTicketPageModule",function(){return z});var n=e("ofXK"),o=e("3Pt+"),a=e("TEn/"),r=e("tyNb"),s=e("mrSG"),c=e("HDdC"),d=e("fXoL"),b=e("fsfq"),h=e("fmoy"),l=e("+WxW"),p=e("7JkF"),u=e("OKd0");function f(t,i){1&t&&(d.Mb(0,"div",7),d.Kb(1,"ion-spinner",8),d.Mb(2,"div"),d.rc(3," Cargando sistema de turno para "),d.Kb(4,"br"),d.Lb(),d.Lb())}function g(t,i){1&t&&(d.Mb(0,"div",7),d.Mb(1,"div"),d.rc(2," A\xfan no tiene salas creadas "),d.Kb(3,"br"),d.Lb(),d.Lb())}function m(t,i){1&t&&(d.Mb(0,"strong"),d.rc(1,"Libre"),d.Lb())}function k(t,i){1&t&&(d.Mb(0,"strong"),d.rc(1,"Ocupada"),d.Lb())}function v(t,i){if(1&t&&(d.Mb(0,"div"),d.Mb(1,"strong"),d.rc(2,"Dureci\xf3n estimada del trabajo:"),d.Lb(),d.rc(3),d.Xb(4,"diferencia"),d.Lb()),2&t){const t=d.Wb(2).$implicit;d.zb(3),d.tc(" ",d.ac(4,1,t.fechainicio,t.fechafinal,1),"")}}function x(t,i){if(1&t&&(d.Mb(0,"div"),d.Mb(1,"strong"),d.rc(2,"Tiempo transcurrido:"),d.Lb(),d.rc(3),d.Xb(4,"diferencia"),d.Lb()),2&t){const t=d.Wb(2).$implicit;d.zb(3),d.tc(" ",d.ac(4,1,t.fechainicio,t.fechafinal,2),"")}}function w(t,i){if(1&t&&(d.Mb(0,"div"),d.Kb(1,"div",14),d.Mb(2,"div"),d.Mb(3,"strong"),d.rc(4,"Usuario:"),d.Lb(),d.rc(5),d.Lb(),d.qc(6,v,5,5,"div",13),d.qc(7,x,5,5,"div",13),d.Lb()),2&t){const t=d.Wb().$implicit;d.zb(5),d.tc(" ",t.mas.creador.nombrecompleto,""),d.zb(1),d.dc("ngIf",""!==t.fechainicio),d.zb(1),d.dc("ngIf",""!==t.fechainicio)}}function M(t,i){if(1&t&&(d.Mb(0,"ion-card",11),d.Mb(1,"ion-card-title"),d.rc(2),d.Lb(),d.Mb(3,"div",12),d.qc(4,m,2,0,"strong",13),d.qc(5,k,2,0,"strong",13),d.Lb(),d.Mb(6,"ion-card-content"),d.Mb(7,"div"),d.Mb(8,"strong"),d.rc(9,"Persona que atiende:"),d.Lb(),d.rc(10),d.Lb(),d.qc(11,w,8,3,"div",13),d.Lb(),d.Lb()),2&t){const t=i.$implicit,e=i.index;d.zb(2),d.tc("Sala ",e+1," "),d.zb(1),d.Bb("ocupado",t.ocupada)("desocupado",!t.ocupada),d.zb(1),d.dc("ngIf",!t.ocupada),d.zb(1),d.dc("ngIf",t.ocupada),d.zb(5),d.tc(" ",t.atiende,""),d.zb(1),d.dc("ngIf",t.info)}}function E(t,i){if(1&t&&(d.Mb(0,"div",9),d.qc(1,g,4,0,"div",4),d.qc(2,M,12,9,"ion-card",10),d.Lb()),2&t){const t=d.Wb();d.zb(1),d.dc("ngIf",0===t.salas.length),d.zb(1),d.dc("ngForOf",t.salas)}}const O=[{path:"",component:(()=>{class t{constructor(t,i,e,n,o,a,r){this.almacenamiento=t,this.toast=i,this.apiTickets=e,this.alert=n,this.router=o,this.active=a,this.socket=r,this.configurando=!1,this.usuario="",this.habilitado=!1,this.cargado=!1,this.id="",this.salas=[],this.escucharProcesados().subscribe(t=>{t.exe&&this.salas.forEach(i=>{i._id===t.data.sala._id&&(i.ocupada=!0,i.info=!0,i.mas=t.data.doc)})}),this.escucharFinalizados().subscribe(t=>{t.exe&&this.salas.forEach(i=>{i._id===t.data._id&&(i.ocupada=!1,i.info=!1)})})}ngOnInit(){}ionViewWillEnter(){this.disponibilidad(),this.almacenamiento.insertarTicket("entrando").then(t=>{if(t)return!0})}refrescando(t){this.salas=[],this.disponibilidad().then(()=>{t.detail.complete()}).catch(()=>{t.detail.complete()})}disponibilidad(){return Object(s.a)(this,void 0,void 0,function*(){const t=yield this.almacenamiento.obtenerToken();t&&(this.usuario=t.nombre,this.apiTickets.disponibilidadnegocio(t.token,{id:this.active.snapshot.paramMap.get("id")}).subscribe(t=>{t.exe?(this.cargado=!0,this.habilitado=t.data[0].estado,this.id=t.data[0]._id,"no"===t.response?(this.toast.toastNotificacion("No hay disponibilidad en este momento"),this.misSalas()):this.misSalas()):(this.toast.toastError("No se pudo consultar la disponibilidad, int\xe9ntelo m\xe1s tarde"),this.router.navigate(["/central/menu/"]))},t=>{this.toast.toastError("No se pudo consultar la disponibilidad, int\xe9ntelo m\xe1s tarde"),this.router.navigate(["/central/menu/"])}))})}misSalas(){return Object(s.a)(this,void 0,void 0,function*(){this.configurando=!0;const t=yield this.almacenamiento.obtenerToken();t&&this.apiTickets.salasNegocio(t.token,{id:this.active.snapshot.paramMap.get("id")}).subscribe(i=>{i.exe?(i.response.forEach(i=>(i.info=!1,this.socket.emit("ticket",{id:i.creador}),new Promise((e,n)=>{i.ocupada&&this.apiTickets.ticketsolo(t.token,{id:i.ticket._id}).subscribe(t=>{t.exe?(i.info=!0,i.mas=t.response,e(!0)):(i.info=!1,e(!1))},t=>{i.info=!1,e(!1)})}))),this.salas=i.response):(this.toast.toastError("No se pudo traer las salas, int\xe9ntelo m\xe1s tarde"),this.router.navigate(["/central/menu/"])),this.configurando=!1},t=>{this.toast.toastError("No se pudo traer las salas, int\xe9ntelo m\xe1s tarde"),this.router.navigate(["/central/menu/"]),this.configurando=!1})})}escucharProcesados(){return new c.a(t=>{this.socket.on("procesar",i=>{t.next(i)})})}escucharFinalizados(){return new c.a(t=>{this.socket.on("finalizar",i=>{t.next(i)})})}ionViewWillLeave(){this.almacenamiento.eleminarTicket().then(t=>{if(t)return!0})}}return t.\u0275fac=function(i){return new(i||t)(d.Jb(b.a),d.Jb(h.a),d.Jb(l.a),d.Jb(a.b),d.Jb(r.g),d.Jb(r.a),d.Jb(p.a))},t.\u0275cmp=d.Db({type:t,selectors:[["app-taller-ticket"]],decls:11,vars:2,consts:[["color","oscuro"],["slot","start","icon","chevron-back-outline","defaultHref","/central/menu"],["slot","fixed","pullFactor","0.5","pullMin","50","pullMax","150",3,"ionRefresh"],["pullingIcon","arrow-dropdown","refreshingSpinner","circles"],["class","flcenter ion-padding",4,"ngIf"],[1,"divider","light"],["class","salas",4,"ngIf"],[1,"flcenter","ion-padding"],["name","crescent","color","oscuro"],[1,"salas"],["mode","ios",4,"ngFor","ngForOf"],["mode","ios"],[1,"msg"],[4,"ngIf"],[1,"separador"]],template:function(t,i){1&t&&(d.Mb(0,"ion-header"),d.Mb(1,"ion-toolbar",0),d.Kb(2,"ion-back-button",1),d.Mb(3,"ion-title"),d.rc(4,"Turnos"),d.Lb(),d.Lb(),d.Lb(),d.Mb(5,"ion-content"),d.Mb(6,"ion-refresher",2),d.Ub("ionRefresh",function(t){return i.refrescando(t)}),d.Kb(7,"ion-refresher-content",3),d.Lb(),d.qc(8,f,5,0,"div",4),d.Kb(9,"div",5),d.qc(10,E,3,2,"div",6),d.Lb()),2&t&&(d.zb(8),d.dc("ngIf",i.configurando),d.zb(2),d.dc("ngIf",i.cargado))},directives:[a.z,a.jb,a.g,a.h,a.hb,a.t,a.P,a.Q,n.j,a.bb,n.i,a.l,a.p,a.m],pipes:[u.a],styles:[".flcenter[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:center;align-items:center;font-size:18px;text-align:center}.separador[_ngcontent-%COMP%]{width:100%;border-bottom:1px solid #566520;padding:5px;margin-bottom:5px}ion-card[_ngcontent-%COMP%]{position:relative}.msg[_ngcontent-%COMP%]{position:absolute;top:0;right:0;text-align:center;padding:5px 10px;border-radius:10px}ion-card-title[_ngcontent-%COMP%]{width:100%;padding:5px 15px}.ocupado[_ngcontent-%COMP%]{background-color:#ca0900!important;color:#fff}.desocupado[_ngcontent-%COMP%]{background-color:#819830!important;color:#fff}"]}),t})()}];let L=(()=>{class t{}return t.\u0275mod=d.Hb({type:t}),t.\u0275inj=d.Gb({factory:function(i){return new(i||t)},imports:[[r.i.forChild(O)],r.i]}),t})();var j=e("iTUp");let z=(()=>{class t{}return t.\u0275mod=d.Hb({type:t}),t.\u0275inj=d.Gb({factory:function(i){return new(i||t)},imports:[[n.b,o.e,a.kb,L,j.a]]}),t})()}}]);