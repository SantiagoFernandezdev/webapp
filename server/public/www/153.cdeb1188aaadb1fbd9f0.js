(window.webpackJsonp=window.webpackJsonp||[]).push([[153],{HY6V:function(i,o,e){"use strict";e.r(o),e.d(o,"CrearGruaPageModule",function(){return P});var t=e("ofXK"),s=e("3Pt+"),n=e("TEn/"),a=e("tyNb"),c=e("mrSG"),r=e("fXoL"),l=e("fsfq"),d=e("Bfh1"),b=e("fmoy"),u=e("0xwK"),h=e("7JkF");const p=["mapa"];let g=(()=>{class i{constructor(i,o,e,t,s,n,a){this.almacenamiento=i,this.loading=o,this.modal=e,this.geoReferencia=t,this.toastService=s,this.apiMonitoreo=n,this.socket=a,this.lng=0,this.lat=0}ngOnInit(){}ionViewWillEnter(){console.log(this.descripcion,"des"),this.calcular()}cerrar(){this.modal.dismiss()}calcular(){return Object(c.a)(this,void 0,void 0,function*(){this.loadingg=yield this.loading.create({message:"Cargando Mapa...",spinner:"circles"});try{yield this.loadingg.present();const i=yield this.geoReferencia.getCurrentPosition({enableHighAccuracy:!0,timeout:2e4});i?(this.lat=i.coords.latitude,this.lng=i.coords.longitude,this.graficar()):yield this.loadingg.dismiss()}catch(i){yield this.loadingg.dismiss(),this.toastService.toastError("No se pudo capturar su posici\xf3n")}})}graficar(){mapboxgl.accessToken="pk.eyJ1Ijoic2FudGlhZ29mZXJuYW5kZXpkZXYiLCJhIjoiY2tmYmh6cXdzMDM0bDJ2cHRucTI4cHpkaSJ9.-01EYvsLdJOU1Oy4BtwBwA";const i=new mapboxgl.Map({container:this.mapa.nativeElement,style:"mapbox://styles/mapbox/streets-v11",center:[this.lng,this.lat],zoom:11});i.addControl(new mapboxgl.NavigationControl);const o=document.createElement("div");o.className="marker",o.style.backgroundImage="url(/assets/Marcador.png)",o.style.backgroundSize="100%",o.style.width="50px",o.style.height="70px";const e=new mapboxgl.Marker({element:o,draggable:!0}).setLngLat([this.lng,this.lat]).addTo(i);e.on("dragend",()=>{const i=e.getLngLat();this.lat=i.lat,this.lng=i.lng}),this.loading.dismiss()}guardar(){return Object(c.a)(this,void 0,void 0,function*(){if(""!==this.descripcion&&this.ciudad.length>0&&0!==this.lat&&0!==this.lng){const i=yield this.almacenamiento.obtenerToken();i&&this.apiMonitoreo.crearGrua(i.token,{ciudad:this.ciudad,descripcion:this.descripcion,ubicacion:{lat:this.lat,lng:this.lng},negocios:this.negocios}).subscribe(o=>{o.exe?(this.toastService.Especial("Solicitud creada correctamente"),console.log(o,"midata"),this.socket.emit("grua",{dispositivos:o.response,usuarios:o.response2,nombre:i.nombre,_id:i._id,grua:o.grua}),this.modal.dismiss({exe:!0})):(this.toastService.toastError("No se pudo crer la patinada, int\xe9ntelo m\xe1s tarde"),this.modal.dismiss())},i=>{this.toastService.toastError("No se pudo crer la patinada, int\xe9ntelo m\xe1s tarde"),this.modal.dismiss()})}else this.toastService.toastError("Verifique que tenga la descripci\xf3n de la patinada, el pa\xeds o ciudad de notificaci\xf3n")})}}return i.\u0275fac=function(o){return new(o||i)(r.Lb(l.a),r.Lb(n.ob),r.Lb(n.qb),r.Lb(d.a),r.Lb(b.a),r.Lb(u.a),r.Lb(h.a))},i.\u0275cmp=r.Fb({type:i,selectors:[["app-grua-mapa"]],viewQuery:function(i,o){if(1&i&&r.Ac(p,1),2&i){let i;r.oc(i=r.Xb())&&(o.mapa=i.first)}},inputs:{descripcion:"descripcion",ciudad:"ciudad",negocios:"negocios"},decls:12,vars:0,consts:[[1,"ion-no-border"],["color","oscuro"],["slot","end"],[3,"click"],["slot","icon-only","name","close-outline"],["slot","icon-only","name","checkmark-outline"],[1,"mapa"],["mapa",""]],template:function(i,o){1&i&&(r.Ob(0,"ion-header",0),r.Ob(1,"ion-toolbar",1),r.Ob(2,"ion-title"),r.wc(3,"Ubicaci\xf3n"),r.Nb(),r.Ob(4,"ion-buttons",2),r.Ob(5,"ion-button",3),r.Wb("click",function(){return o.cerrar()}),r.Mb(6,"ion-icon",4),r.Nb(),r.Ob(7,"ion-button",3),r.Wb("click",function(){return o.guardar()}),r.Mb(8,"ion-icon",5),r.Nb(),r.Nb(),r.Nb(),r.Nb(),r.Ob(9,"ion-content"),r.Mb(10,"div",6,7),r.Nb())},directives:[n.z,n.lb,n.jb,n.k,n.j,n.A,n.t],styles:[".mapa[_ngcontent-%COMP%]{width:100%;height:100%}"]}),i})();var m=e("oQG1"),f=e("2qE+"),v=e("CDls");function O(i,o){if(1&i){const i=r.Pb();r.Ob(0,"ion-button",13),r.Wb("click",function(){return r.pc(i),r.Yb().ubicacion()}),r.Mb(1,"ion-icon",14),r.Nb()}}function N(i,o){if(1&i){const i=r.Pb();r.Ob(0,"ion-item",15),r.Ob(1,"ion-label",16),r.wc(2,"\xbfQuieres que la solicitud tamb\xeden se notifique a los talleres mec\xe1nicos ?"),r.Nb(),r.Ob(3,"ion-checkbox",17),r.Wb("ionChange",function(o){return r.pc(i),r.Yb().cbtaller(o)}),r.Nb(),r.Nb()}}function k(i,o){1&i&&(r.Ob(0,"ion-item-divider",6),r.Ob(1,"ion-label",16),r.wc(2,"Escoja un pa\xeds y luego las ciudades a las cuales quiere enviar la notificaci\xf3n"),r.Nb(),r.Nb())}function w(i,o){if(1&i&&(r.Ob(0,"ion-select-option",21),r.wc(1),r.Nb()),2&i){const i=o.$implicit;r.gc("value",i.nombre),r.Ab(1),r.xc(i.nombre)}}function M(i,o){if(1&i){const i=r.Pb();r.Ob(0,"ion-item",18),r.Ob(1,"ion-label",16),r.wc(2,"Selecciona el Pa\xeds"),r.Nb(),r.Ob(3,"ion-select",19),r.Wb("ionChange",function(o){return r.pc(i),r.Yb().listarCiudades(o)}),r.vc(4,w,2,2,"ion-select-option",20),r.Nb(),r.Nb()}if(2&i){const i=r.Yb();r.Ab(3),r.fc("value",i.pais),r.Ab(1),r.fc("ngForOf",i.paises)}}function x(i,o){if(1&i){const i=r.Pb();r.Ob(0,"ion-item",6),r.Ob(1,"ion-label"),r.wc(2),r.Nb(),r.Ob(3,"ion-checkbox",24),r.Wb("ionChange",function(e){r.pc(i);const t=o.index;return r.Yb(2).seleccionarCiudad(e,t)}),r.Nb(),r.Nb()}if(2&i){const i=o.$implicit;r.Ab(2),r.xc(i.nombre),r.Ab(1),r.gc("value",i.nombre),r.fc("checked",i.check)}}function C(i,o){if(1&i){const i=r.Pb();r.Ob(0,"ion-list"),r.Ob(1,"ion-searchbar",22),r.Wb("ionChange",function(o){return r.pc(i),r.Yb().buscar(o)}),r.Nb(),r.Mb(2,"br"),r.vc(3,x,4,3,"ion-item",23),r.Zb(4,"filtrociudad"),r.Nb()}if(2&i){const i=r.Yb();r.Ab(3),r.fc("ngForOf",r.bc(4,1,i.ciudades,i.texto))}}function y(i,o){if(1&i){const i=r.Pb();r.Ob(0,"ion-footer",13),r.Wb("click",function(){return r.pc(i),r.Yb().ubicacion()}),r.Ob(1,"ion-toolbar",25),r.Ob(2,"ion-label",26),r.wc(3," Marcar ubicaci\xf3n de solicitud"),r.Nb(),r.Ob(4,"ion-avatar",3),r.Mb(5,"img",27),r.Nb(),r.Nb(),r.Nb()}}const L=[{path:"",component:(()=>{class i{constructor(i,o,e,t,s,n,a,c){this.modal=i,this.apiUsuario=o,this.toast=e,this.almacenamiento=t,this.apiPatinada=s,this.socket=n,this.router=a,this.active=c,this.descripcion="",this.paises=[],this.ciudades=[],this.ciudad=!1,this.load=!1,this.pais="",this.miciudad="",this.vista=2,this.selecionadas=[],this.texto="",this.tipo="",this.negocios=[]}ngOnInit(){}ionViewWillEnter(){this.tipo=this.active.snapshot.paramMap.get("tipo"),"grua"===this.tipo?this.negocios.push("Servicios de Grua"):"almacen"===this.tipo?this.negocios.push("Almac\xe9n repuestos o accesorios para motos","Almac\xe9n repuestos o accesorios para carros"):"taller"===this.tipo?this.negocios.push("Taller Mec\xe1nico Motos","Taller Mec\xe1nico Carros"):"lavadero"===this.tipo?this.negocios.push("Lavadero"):"vulcanizadora"===this.tipo&&this.negocios.push("Vulcanizadora"),this.listarPaises()}cerrar(){this.modal.dismiss()}cbtaller(i){i.detail.checked?this.negocios.push("Taller Mec\xe1nico Motos","Taller Mec\xe1nico Carros"):this.negocios=this.negocios.filter(i=>"Taller Mec\xe1nico Motos"!==i&&"Taller Mec\xe1nico Carros"!==i)}listarPaises(){return Object(c.a)(this,void 0,void 0,function*(){(yield this.almacenamiento.obtenerToken())&&this.apiUsuario.listarPaises().subscribe(i=>{i.exe?(this.paises=i.response,console.log(this.paises,this.pais)):this.paises.push("Colombia")},i=>{this.paises.push("Colombia")})})}listarCiudades(i){this.miciudad=""!==this.miciudad?this.miciudad:"";const o=this.paises.filter(o=>o.nombre===i.detail.value)[0]._id;this.apiUsuario.listarCiudades(o).subscribe(i=>{i.exe?(i.response.forEach(i=>{i.check=!1,this.ciudades.push(i)}),console.log(this.ciudades),this.ciudad=!0):this.toast.toastError("No se pudo traer las ciudades, intente registrarse m\xe1s tarde")},i=>{this.toast.toastError("No se pudo traer las ciudades, intente registrarse m\xe1s tarde")})}seleccionarCiudad(i,o){this.ciudades[o].check=i.detail.checked,i.detail.checked?this.selecionadas.find(o=>o===i.detail.value)||this.selecionadas.push(i.detail.value):this.selecionadas=this.selecionadas.filter(o=>o!==i.detail.value),console.log(this.selecionadas)}paissel(i){this.pais=i.detail.value}buscar(i){this.texto=i.detail.value}escribir(i){this.descripcion=i.detail.value}ubicacion(){return Object(c.a)(this,void 0,void 0,function*(){const i=yield this.modal.create({component:g,componentProps:{descripcion:this.descripcion,ciudad:this.selecionadas,negocios:this.negocios}});yield i.present();const o=yield i.onWillDismiss();o&&o.data&&o.data.exe&&this.router.navigate(["/central/menu/monitoreo/grua",this.tipo])})}guardar(){return Object(c.a)(this,void 0,void 0,function*(){})}}return i.\u0275fac=function(o){return new(o||i)(r.Lb(n.qb),r.Lb(m.a),r.Lb(b.a),r.Lb(l.a),r.Lb(f.a),r.Lb(h.a),r.Lb(a.g),r.Lb(a.a))},i.\u0275cmp=r.Fb({type:i,selectors:[["app-crear-grua"]],decls:24,vars:6,consts:[[1,"ion-no-border"],["color","oscuro"],["slot","start","icon","chevron-back-outline","defaultHref","/central/menu/monitoreo/grua"],["slot","end"],[3,"click",4,"ngIf"],[1,"c1"],["color","light"],["color","light","mode","ios",1,"sinfondo"],["rows","5","placeholder","Escriba la descripci\xf3n de la solicitud",3,"ionChange"],["color","warning",4,"ngIf"],["color","light",4,"ngIf"],["color","light","lines","none","class","noborder","mode","md",4,"ngIf"],[4,"ngIf"],[3,"click"],["slot","icon-only","name","location-outline"],["color","warning"],[1,"ion-text-wrap"],["slot","end","color","oscuro",3,"ionChange"],["color","light","lines","none","mode","md",1,"noborder"],["okText","Aceptar","cancelText","Cancelar",3,"value","ionChange"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],["color","oscuro","mode","ios","placeholder","Buscar Ciudad",3,"ionChange"],["color","light",4,"ngFor","ngForOf"],["mode","ios","slot","end","color","success",3,"checked","value","ionChange"],["color","danger"],[1,"ion-margin-left"],["src","/assets/Marcador.png","width","20px","height","20px","alt",""]],template:function(i,o){1&i&&(r.Ob(0,"ion-header",0),r.Ob(1,"ion-toolbar",1),r.Mb(2,"ion-back-button",2),r.Ob(3,"ion-title"),r.wc(4,"Crear"),r.Nb(),r.Ob(5,"ion-buttons",3),r.vc(6,O,2,0,"ion-button",4),r.Nb(),r.Nb(),r.Nb(),r.Ob(7,"ion-content"),r.Ob(8,"div",5),r.Ob(9,"ion-list"),r.Ob(10,"ion-item-divider",6),r.Ob(11,"ion-label"),r.wc(12,"Descripci\xf3n"),r.Nb(),r.Nb(),r.Mb(13,"br"),r.Ob(14,"ion-item",7),r.Ob(15,"ion-textarea",8),r.Wb("ionChange",function(i){return o.escribir(i)}),r.Nb(),r.Nb(),r.Mb(16,"br"),r.vc(17,N,4,0,"ion-item",9),r.Mb(18,"br"),r.vc(19,k,3,0,"ion-item-divider",10),r.Mb(20,"br"),r.vc(21,M,5,2,"ion-item",11),r.Nb(),r.vc(22,C,5,4,"ion-list",12),r.Nb(),r.Nb(),r.vc(23,y,6,0,"ion-footer",4)),2&i&&(r.Ab(6),r.fc("ngIf",""!==o.descripcion&&o.selecionadas.length>0),r.Ab(11),r.fc("ngIf",2===o.vista&&"grua"===o.tipo),r.Ab(2),r.fc("ngIf",2===o.vista),r.Ab(2),r.fc("ngIf",2===o.vista),r.Ab(1),r.fc("ngIf",o.ciudad&&2===o.vista),r.Ab(1),r.fc("ngIf",""!==o.descripcion&&o.selecionadas.length>0))},directives:[n.z,n.lb,n.g,n.h,n.jb,n.k,t.j,n.t,n.L,n.G,n.K,n.F,n.hb,n.yb,n.j,n.A,n.q,n.d,n.X,n.xb,t.i,n.Y,n.U,n.x,n.f],pipes:[v.a],styles:[".c1[_ngcontent-%COMP%]{width:100%}ion-avatar[_ngcontent-%COMP%]{width:30px;height:50px;margin:5px 15px}.ion-margin-left[_ngcontent-%COMP%]{margin-left:20px}"]}),i})()}];let A=(()=>{class i{}return i.\u0275fac=function(o){return new(o||i)},i.\u0275mod=r.Jb({type:i}),i.\u0275inj=r.Ib({imports:[[a.j.forChild(L)],a.j]}),i})();var I=e("iTUp");let P=(()=>{class i{}return i.\u0275fac=function(o){return new(o||i)},i.\u0275mod=r.Jb({type:i}),i.\u0275inj=r.Ib({imports:[[t.b,s.e,n.mb,A,I.a]]}),i})()}}]);