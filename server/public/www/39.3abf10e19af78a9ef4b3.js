(window.webpackJsonp=window.webpackJsonp||[]).push([[39],{Fe5k:function(t,o,i){"use strict";i.r(o),i.d(o,"HojaPageModule",function(){return J});var e=i("ofXK"),n=i("3Pt+"),a=i("TEn/"),r=i("tyNb"),s=i("mrSG"),c=i("fXoL"),l=i("fsfq"),d=i("fmoy"),b=i("AQLj"),h=i("VYYF"),u=i("r3ab"),p=i("SpuA");const f=["inifinito"];function g(t,o){1&t&&(c.Mb(0,"ion-item"),c.Mb(1,"ion-avatar",12),c.Kb(2,"ion-skeleton-text",13),c.Lb(),c.Mb(3,"ion-label"),c.Kb(4,"ion-skeleton-text",14),c.Kb(5,"ion-skeleton-text",15),c.Lb(),c.Lb())}const m=function(){return[1,1,1,1]};function v(t,o){1&t&&(c.Mb(0,"ion-list"),c.qc(1,g,6,0,"ion-item",11),c.Lb()),2&t&&(c.zb(1),c.dc("ngForOf",c.gc(1,m)))}function j(t,o){1&t&&(c.Mb(0,"div",16),c.Kb(1,"img",17),c.Mb(2,"h3",18),c.rc(3,"Mis hojas de vida"),c.Lb(),c.Lb())}function M(t,o){if(1&t&&(c.Mb(0,"div",36),c.rc(1),c.Lb()),2&t){const t=c.Wb(2).$implicit;c.zb(1),c.sc(t.placa)}}function L(t,o){if(1&t&&(c.Mb(0,"div",29),c.Mb(1,"strong"),c.rc(2,"Trabajador: "),c.Lb(),c.Mb(3,"span",31),c.rc(4),c.Lb(),c.Lb()),2&t){const t=c.Wb(2).$implicit;c.zb(4),c.sc(t.trabajador.nombrecompleto)}}function x(t,o){1&t&&(c.Mb(0,"div",37),c.rc(1,"HOJA DE VIDA TERMINADA"),c.Lb())}function z(t,o){1&t&&(c.Mb(0,"div",38),c.rc(1,"HOJA DE VIDA SIN TERMINAR"),c.Lb())}function I(t,o){if(1&t&&(c.Mb(0,"ion-label",27),c.qc(1,M,2,1,"div",28),c.Mb(2,"div",29),c.Mb(3,"strong"),c.rc(4,"Taller: "),c.Lb(),c.Mb(5,"span",30),c.rc(6),c.Lb(),c.Lb(),c.Mb(7,"div",29),c.Mb(8,"strong"),c.rc(9,"Cliente: "),c.Lb(),c.Mb(10,"span",31),c.rc(11),c.Lb(),c.Lb(),c.Kb(12,"br"),c.qc(13,L,5,1,"div",32),c.Kb(14,"br"),c.Mb(15,"div",33),c.Mb(16,"strong"),c.rc(17,"Fecha: "),c.Lb(),c.Mb(18,"span",31),c.rc(19),c.Xb(20,"cambioUTC"),c.Lb(),c.Lb(),c.qc(21,x,2,0,"div",34),c.qc(22,z,2,0,"div",35),c.Lb()),2&t){const t=c.Wb().$implicit;c.zb(1),c.dc("ngIf",t.placa),c.zb(5),c.tc(" ",t.idtaller.nombrecompleto,""),c.zb(5),c.sc(t.idusuario.nombrecompleto),c.zb(2),c.dc("ngIf",t.trabajador),c.zb(6),c.sc(c.Yb(20,7,t.fecha)),c.zb(2),c.dc("ngIf",t.terminado),c.zb(1),c.dc("ngIf",!t.terminado)}}function C(t,o){if(1&t&&(c.Mb(0,"div",36),c.rc(1),c.Lb()),2&t){const t=c.Wb(2).$implicit;c.zb(1),c.sc(t.placa)}}function E(t,o){if(1&t&&(c.Mb(0,"div",29),c.Mb(1,"strong"),c.rc(2,"Cliente: "),c.Lb(),c.Mb(3,"span",31),c.rc(4),c.Lb(),c.Lb()),2&t){const t=c.Wb(2).$implicit;c.zb(4),c.tc(" ",t.nusuario,"")}}function k(t,o){if(1&t&&(c.Mb(0,"div",29),c.Mb(1,"strong"),c.rc(2,"Cliente: "),c.Lb(),c.Mb(3,"span",31),c.rc(4),c.Lb(),c.Lb()),2&t){const t=c.Wb(2).$implicit;c.zb(4),c.tc(" ",t.idusuario.nombrecompleto,"")}}function H(t,o){if(1&t&&(c.Mb(0,"div",29),c.Mb(1,"strong"),c.rc(2,"Tel\xe9fono: "),c.Lb(),c.Mb(3,"span",31),c.rc(4),c.Lb(),c.Lb()),2&t){const t=c.Wb(2).$implicit;c.zb(4),c.tc(" ",t.idusuario.tel,"")}}function O(t,o){if(1&t&&(c.Mb(0,"div",29),c.Mb(1,"strong"),c.rc(2,"Trabajador: "),c.Lb(),c.Mb(3,"span",31),c.rc(4),c.Lb(),c.Lb()),2&t){const t=o.$implicit;c.zb(4),c.sc(t.nombrecompleto)}}function w(t,o){if(1&t&&(c.Mb(0,"div"),c.qc(1,O,5,1,"div",39),c.Lb()),2&t){const t=c.Wb(2).$implicit;c.zb(1),c.dc("ngForOf",t.trabajador)}}function y(t,o){1&t&&(c.Mb(0,"div",37),c.rc(1,"HOJA DE VIDA TERMINADA"),c.Lb())}function N(t,o){1&t&&(c.Mb(0,"div",38),c.rc(1,"HOJA DE VIDA SIN TERMINAR"),c.Lb())}function q(t,o){if(1&t&&(c.Mb(0,"ion-label",27),c.qc(1,C,2,1,"div",28),c.Mb(2,"div",29),c.Mb(3,"strong"),c.rc(4,"Taller: "),c.Lb(),c.Mb(5,"span",30),c.rc(6),c.Lb(),c.Lb(),c.qc(7,E,5,1,"div",32),c.qc(8,k,5,1,"div",32),c.qc(9,H,5,1,"div",32),c.Kb(10,"br"),c.qc(11,w,2,1,"div",7),c.Kb(12,"br"),c.Mb(13,"div",33),c.Mb(14,"strong"),c.rc(15,"Fecha: "),c.Lb(),c.Mb(16,"span",31),c.rc(17),c.Xb(18,"cambioUTC"),c.Lb(),c.Lb(),c.qc(19,y,2,0,"div",34),c.qc(20,N,2,0,"div",35),c.Lb()),2&t){const t=c.Wb().$implicit;c.zb(1),c.dc("ngIf",""!==t.placa),c.zb(5),c.tc(" ",t.idtaller.nombrecompleto,""),c.zb(1),c.dc("ngIf",t.idusuario&&""===t.idusuario),c.zb(1),c.dc("ngIf",t.idusuario&&""!==t.idusuario),c.zb(1),c.dc("ngIf",t.idusuario&&""!==t.idusuario),c.zb(2),c.dc("ngIf",t.trabajador),c.zb(6),c.sc(c.Yb(18,9,t.fecha)),c.zb(2),c.dc("ngIf",t.terminado),c.zb(1),c.dc("ngIf",!t.terminado)}}function T(t,o){if(1&t){const t=c.Nb();c.Mb(0,"ion-item-option",40),c.Ub("click",function(){c.lc(t);const o=c.Wb().$implicit;return c.Wb(2).correo(o)}),c.Kb(1,"ion-icon",41),c.Lb()}}function A(t,o){if(1&t){const t=c.Nb();c.Mb(0,"ion-item-option",42),c.Ub("click",function(){c.lc(t);const o=c.Wb().$implicit;return c.Wb(2).eli(o._id)}),c.Kb(1,"ion-icon",43),c.Lb()}}function _(t,o){if(1&t){const t=c.Nb();c.Mb(0,"ion-item-sliding"),c.Mb(1,"ion-item",19),c.Ub("click",function(){c.lc(t);const i=o.$implicit;return c.Wb(2).navegar(i)}),c.Mb(2,"ion-avatar",12),c.Kb(3,"img",20),c.Lb(),c.qc(4,I,23,9,"ion-label",21),c.qc(5,q,21,11,"ion-label",21),c.Lb(),c.Mb(6,"ion-item-options",22),c.qc(7,T,2,0,"ion-item-option",23),c.Mb(8,"ion-item-option",24),c.Ub("click",function(){c.lc(t);const i=o.$implicit;return c.Wb(2).pdf(i)}),c.Kb(9,"ion-icon",25),c.Lb(),c.qc(10,A,2,0,"ion-item-option",26),c.Lb(),c.Lb()}if(2&t){const t=o.$implicit,i=c.Wb(2);c.zb(4),c.dc("ngIf",!t.tipo||"cita"===t.tipo),c.zb(1),c.dc("ngIf",t.tipo&&"hoja"===t.tipo),c.zb(2),c.dc("ngIf",t.idtaller._id===i.id),c.zb(3),c.dc("ngIf",t.idtaller._id===i.id)}}function D(t,o){if(1&t&&(c.Mb(0,"ion-list"),c.qc(1,_,11,4,"ion-item-sliding",11),c.Lb()),2&t){const t=c.Wb();c.zb(1),c.dc("ngForOf",t.hojas)}}function P(t,o){if(1&t){const t=c.Nb();c.Mb(0,"ion-infinite-scroll",44,45),c.Ub("ionInfinite",function(o){return c.lc(t),c.Wb().loadData(o)}),c.Kb(2,"ion-infinite-scroll-content",46),c.Lb()}}function W(t,o){if(1&t){const t=c.Nb();c.Mb(0,"ion-fab",47),c.Mb(1,"ion-fab-button",48),c.Ub("click",function(){return c.lc(t),c.Wb().abrir()}),c.Kb(2,"ion-icon",49),c.Lb(),c.Lb()}}const F=[{path:"",component:(()=>{class t{constructor(t,o,i,e,n,a,r){this.almacenamiento=t,this.toast=o,this.apiHoja=i,this.router=e,this.statusbar=n,this.alertCtrl=a,this.loading=r,this.desde=0,this.hojas=[],this.cargado=!0,this.patron="",this.textoBuscar="",this.role="",this.id=""}ngOnInit(){}ionViewWillEnter(){this.desde=0,this.hojas=[],this.inifinito.disabled=!1,this.cargarHojas()}refrescando(t){this.desde=0,this.cargarHojas().then(()=>{t.target.complete()}).catch(()=>{t.target.complete()})}cargarHojas(){return Object(s.a)(this,void 0,void 0,function*(){const t=yield this.almacenamiento.obtenerToken();t&&(this.role=t.role,this.id=t._id,this.textoBuscar="TALLER_ROLE"===t.role?"Buscar por cliente":"Buscar por taller",this.apiHoja.buscarHojas(t.token,{desde:this.desde}).subscribe(t=>{t.exe?this.hojas=t.response:(this.hojas=[],this.toast.toastError("No se pudo traer las hojas de vida, int\xe9ntelo m\xe1s tarde.")),this.cargado=!0},t=>{this.cargado=!0,this.hojas=[],this.toast.toastError("No se pudo traer las hojas de vida, int\xe9ntelo m\xe1s tarde.")}))})}buscar(t){return Object(s.a)(this,void 0,void 0,function*(){if(""!==t.detail.value){this.desde=0,this.patron=t.detail.value;const o=yield this.almacenamiento.obtenerToken();o&&this.apiHoja.buscarHojasFiltro(o.token,{desde:this.desde,patron:this.patron}).subscribe(t=>{t.exe?this.hojas=t.response:this.toast.toastError("No se pudo realizar la b\xfasqueda, intentelo m\xe1s tarde")},t=>{this.toast.toastError("No se pudo realizar la b\xfasqueda, intentelo m\xe1s tarde")})}else this.inifinito.disabled=!1,this.cargarHojas()})}loadData(t){return Object(s.a)(this,void 0,void 0,function*(){this.desde=this.desde+5;const o=yield this.almacenamiento.obtenerToken();o&&(""===this.patron?this.apiHoja.buscarHojas(o.token,{desde:this.desde}).subscribe(o=>{o.exe?o.response.length>0?(o.response.forEach(t=>{this.hojas.push(t)}),t.target.complete()):(t.target.disabled=!0,this.desde=0):this.toast.toastError("No se pudo traer las hojas de vida, int\xe9ntelo m\xe1s tarde.")},t=>{this.toast.toastError("No se pudo traer las hojas de vida, int\xe9ntelo m\xe1s tarde.")}):this.apiHoja.buscarHojasFiltro(o.token,{desde:this.desde,patron:this.patron}).subscribe(o=>{o.exe?o.response.length>0?(o.response.forEach(t=>{this.hojas.push(t)}),t.target.complete()):(t.target.disabled=!0,this.desde=0):this.toast.toastError("No se pudo realizar la b\xfasqueda, intentelo m\xe1s tarde")},t=>{this.toast.toastError("No se pudo realizar la b\xfasqueda, intentelo m\xe1s tarde")}))})}navegar(t){this.router.navigate(["/central/menu/hoja/mihoja",t._id,"hoja"])}abrir(){return Object(s.a)(this,void 0,void 0,function*(){const t=yield this.alertCtrl.create({header:"Crear Hoja de vida",message:"\xbfQuieres crear una nueva hoja de vida?",inputs:[{type:"text",placeholder:"Nombre del cliente",name:"cliente"},{type:"text",placeholder:"Placa del Veh\xedculo",name:"placa"}],buttons:[{text:"Cancelar",role:"cancel"},{text:"Crear Hoja",handler:t=>{""===t.cliente||""===t.placa?this.toast.toastError("Debe llenar todos los campos"):this.crear(t)}}]});yield t.present()})}eli(t){return Object(s.a)(this,void 0,void 0,function*(){const o=yield this.alertCtrl.create({header:"Atenci\xf3n!",message:"\xbfEstas seguro de eliminar esta hoja de vida? No podr\xe1 recuperarla de nuevo",buttons:[{text:"Cancelar",cssClass:"cancelarAlerta",role:"cancel",handler:()=>{}},{text:"Aceptar",cssClass:"botonalerta",handler:()=>Object(s.a)(this,void 0,void 0,function*(){const o=yield this.almacenamiento.obtenerToken();o&&this.apiHoja.eliminarHoja(o.token,{id:t}).subscribe(t=>{t.exe?(this.toast.Especial("Hoja Borrada"),this.cargarHojas()):this.toast.toastError("No se pudo eliminar la hoja, int\xe9ntelo m\xe1s tarde")},t=>{this.toast.toastError("No se pudo eliminar la hoja, int\xe9ntelo m\xe1s tarde")})})}]});yield o.present()})}pdf(t){return Object(s.a)(this,void 0,void 0,function*(){this.loading.cargaProcesos("Exportando PDF, por faovr espere...");const o=yield this.almacenamiento.obtenerToken();o&&this.apiHoja.pdfHoja(o.token,{id:t._id}).subscribe(o=>{console.log(o),o.exe?(this.toast.Especial("PDF generado"),window.open("https://www.motocaliapp.com/hojas/download?path="+o.nombre+"&name=hoja-de-vida-"+t.placa+".pdf","_self")):this.toast.toastError("No se pudo eliminar la hoja, int\xe9ntelo m\xe1s tarde"),this.loading.finalizarCargado()},t=>{this.toast.toastError("No se pudo eliminar la hoja, int\xe9ntelo m\xe1s tarde"),this.loading.finalizarCargado()})})}correo(t){return Object(s.a)(this,void 0,void 0,function*(){const o=yield this.alertCtrl.create({header:"Enviar hoja de vida al correo electr\xf3nico",message:"Se enviar\xe1 la hoja de vida al correo electr\xf3nico registrado por el cliente, en caso de no tener o querer cambiar \xe9l correo puede actualizarlo con el sigueinte campo",inputs:[{type:"email",name:"correo",value:t.idusuario?t.idusuario.correo:""}],buttons:[{text:"Cancelar",cssClass:"cancelarAlerta",role:"cancel",handler:()=>{}},{text:"Enviar",cssClass:"botonalerta",handler:o=>Object(s.a)(this,void 0,void 0,function*(){if(o.correo){this.loading.cargaProcesos("Enviando correo, por faovr espere...");const i=yield this.almacenamiento.obtenerToken();i&&this.apiHoja.pdfHoja(i.token,{id:t._id,correo:o.correo}).subscribe(t=>{t.exe?this.toast.Especial("PDF generado y enviado al correo electr\xf3nico"):this.toast.toastError("No se pudo eliminar la hoja, int\xe9ntelo m\xe1s tarde"),this.loading.finalizarCargado()},t=>{this.toast.toastError("No se pudo eliminar la hoja, int\xe9ntelo m\xe1s tarde"),this.loading.finalizarCargado()})}else this.toast.toastError("Debe diligenciar un correo v\xe1lido")})}]});yield o.present()})}crear(t){return Object(s.a)(this,void 0,void 0,function*(){const o=yield this.almacenamiento.obtenerToken();o&&this.apiHoja.crearHoja(o.token,{usuario:"",placa:t.placa,nusuario:t.cliente,cita:"",trabajador:t.trabajador}).subscribe(t=>{t.exe?(this.toast.toastExitoso("Hoja de vida creada"),this.cargarHojas()):this.toast.toastError("No se pudo crear la hoja de vida, intentelo m\xe1s tarde")},t=>{this.toast.toastError("No se pudo crear la hoja de vida, intentelo m\xe1s tarde")})})}}return t.\u0275fac=function(o){return new(o||t)(c.Jb(l.a),c.Jb(d.a),c.Jb(b.a),c.Jb(r.g),c.Jb(h.a),c.Jb(a.b),c.Jb(u.a))},t.\u0275cmp=c.Db({type:t,selectors:[["app-hoja"]],viewQuery:function(t,o){if(1&t&&c.vc(f,1),2&t){let t;c.kc(t=c.Vb())&&(o.inifinito=t.first)}},decls:15,vars:6,consts:[[1,"ion-no-border"],["color","oscuro"],["icon","chevron-back-outline","slot","start","defaultHref","/central/menu/"],["slot","fixed","pullFactor","0.5","pullMin","50","pullMax","150",3,"ionRefresh"],["pullingIcon","arrow-dropdown","refreshingSpinner","circles"],["mode","ios",3,"placeholder","ionChange"],[1,"divider","light"],[4,"ngIf"],["class","flexbet",4,"ngIf"],["threshold","100px",3,"ionInfinite",4,"ngIf"],["vertical","bottom","horizontal","end","slot","fixed",4,"ngIf"],[4,"ngFor","ngForOf"],["slot","start"],["animted","",2,"width","100%","height","100%"],["animted","",2,"width","100%","height","20px"],["animted","",2,"width","50%","height","20px"],[1,"flexbet"],["src","/assets/Hojas.png","width","70px","alt",""],[1,"tituloGrande"],[1,"item","sinfondo",3,"click"],["src","/assets/Hoja.png","width","100%","height","100%","alt",""],["class","ion-text-wrap",4,"ngIf"],["side","start"],["color","masoscuro",3,"click",4,"ngIf"],["color","medium",3,"click"],["name","document","slot","icon-only"],["color","danger",3,"click",4,"ngIf"],[1,"ion-text-wrap"],["class","placa",4,"ngIf"],[1,"flex"],[1,"cll"],[1,"cl"],["class","flex",4,"ngIf"],[1,"flex","fl"],["class","terminado","color","barra",4,"ngIf"],["class","terminado2","color","barra",4,"ngIf"],[1,"placa"],["color","barra",1,"terminado"],["color","barra",1,"terminado2"],["class","flex",4,"ngFor","ngForOf"],["color","masoscuro",3,"click"],["name","send","slot","icon-only"],["color","danger",3,"click"],["name","trash","slot","icon-only"],["threshold","100px",3,"ionInfinite"],["inifinito",""],["loadingSpinner","bubbles","loadingText","Cargando Hojas de Vida..."],["vertical","bottom","horizontal","end","slot","fixed"],["color","oscuro",3,"click"],["name","add-outline"]],template:function(t,o){1&t&&(c.Mb(0,"ion-header",0),c.Mb(1,"ion-toolbar",1),c.Kb(2,"ion-back-button",2),c.Mb(3,"ion-title"),c.rc(4,"Hojas de Vida"),c.Lb(),c.Lb(),c.Lb(),c.Mb(5,"ion-content"),c.Mb(6,"ion-refresher",3),c.Ub("ionRefresh",function(t){return o.refrescando(t)}),c.Kb(7,"ion-refresher-content",4),c.Lb(),c.Mb(8,"ion-searchbar",5),c.Ub("ionChange",function(t){return o.buscar(t)}),c.Lb(),c.Kb(9,"div",6),c.qc(10,v,2,2,"ion-list",7),c.qc(11,j,4,0,"div",8),c.qc(12,D,2,1,"ion-list",7),c.qc(13,P,3,0,"ion-infinite-scroll",9),c.qc(14,W,3,0,"ion-fab",10),c.Lb()),2&t&&(c.zb(8),c.ec("placeholder",o.textoBuscar),c.zb(2),c.dc("ngIf",!o.cargado),c.zb(1),c.dc("ngIf",o.cargado&&0===o.hojas.length),c.zb(1),c.dc("ngIf",o.hojas.length>0),c.zb(1),c.dc("ngIf",o.cargado),c.zb(1),c.dc("ngIf","TALLER_ROLE"===o.role))},directives:[a.z,a.kb,a.g,a.h,a.ib,a.t,a.Q,a.R,a.U,a.xb,e.j,a.L,e.i,a.F,a.f,a.Z,a.K,a.J,a.I,a.H,a.A,a.C,a.D,a.v,a.w],pipes:[p.a],styles:[".flexbet[_ngcontent-%COMP%]{margin-top:15px;text-align:center}.tituloGrande[_ngcontent-%COMP%]{opacity:.3}.flex[_ngcontent-%COMP%]{display:flex;justify-content:space-between}.fl[_ngcontent-%COMP%]{align-items:flex-start}.cl[_ngcontent-%COMP%], .cll[_ngcontent-%COMP%]{text-align:right}.separador[_ngcontent-%COMP%]{margin-top:5px;background:#e9e9e9;padding:5px}.item[_ngcontent-%COMP%]:nth-child(2n){--background:#f7f7f7!important}.terminado[_ngcontent-%COMP%]{background-color:#d9e2c6}.terminado[_ngcontent-%COMP%], .terminado2[_ngcontent-%COMP%]{width:100%;padding:10px;text-align:center;font-weight:700}.terminado2[_ngcontent-%COMP%]{background-color:#f2c9c5}.placa[_ngcontent-%COMP%]{width:150px;background-color:#ffa800;color:#000;font-size:18px;text-align:center;padding:5px 10;border-radius:5px;font-weight:700;border:3px solid #000;margin-bottom:5px}"]}),t})()}];let K=(()=>{class t{}return t.\u0275mod=c.Hb({type:t}),t.\u0275inj=c.Gb({factory:function(o){return new(o||t)},imports:[[r.i.forChild(F)],r.i]}),t})();var $=i("iTUp");let J=(()=>{class t{}return t.\u0275mod=c.Hb({type:t}),t.\u0275inj=c.Gb({factory:function(o){return new(o||t)},imports:[[e.b,n.e,a.lb,K,$.a]]}),t})()},SpuA:function(t,o,i){"use strict";i.d(o,"a",function(){return a});var e=i("wd/R"),n=i("fXoL");let a=(()=>{class t{transform(t){console.log(t,"fechin");let o=e.utc(t).toDate();return e(o).format("dddd, DD MMMM YYYY h:mm:a")}}return t.\u0275fac=function(o){return new(o||t)},t.\u0275pipe=n.Ib({name:"cambioUTC",type:t,pure:!0}),t})()},r3ab:function(t,o,i){"use strict";i.d(o,"a",function(){return r});var e=i("mrSG"),n=i("fXoL"),a=i("TEn/");let r=(()=>{class t{constructor(t){this.loadingCtrl=t}cargaProcesos(t){return Object(e.a)(this,void 0,void 0,function*(){return this.loading=yield this.loadingCtrl.create({message:t}),this.loading.present()})}finalizarCargado(){this.loading.dismiss()}}return t.\u0275fac=function(o){return new(o||t)(n.Qb(a.nb))},t.\u0275prov=n.Fb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})()}}]);