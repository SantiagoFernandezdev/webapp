(window.webpackJsonp=window.webpackJsonp||[]).push([[33],{E7SW:function(t,e,i){"use strict";i.r(e),i.d(e,"NotificacionesPageModule",function(){return x});var o=i("ofXK"),r=i("3Pt+"),a=i("TEn/"),n=i("tyNb"),s=i("mrSG"),c=i("fXoL"),u=i("fsfq"),p=i("oQG1"),h=i("fmoy"),l=i("SpuA");const d=["inifinito"];function b(t,e){1&t&&(c.Mb(0,"h3",9),c.rc(1,"La bandeja de notificaciones est\xe1 vac\xeda"),c.Lb())}function f(t,e){if(1&t&&c.Kb(0,"ion-img",17),2&t){const t=c.Wb().$implicit;c.fc("src","https://motocaliapp.com/",t.imagen,"")}}function g(t,e){if(1&t&&c.Kb(0,"ion-img",17),2&t){const t=c.Wb().$implicit;c.ec("src",t.rutaApp)}}function m(t,e){if(1&t){const t=c.Nb();c.Mb(0,"ion-item",12),c.Ub("click",function(){c.lc(t);const i=e.$implicit;return c.Wb(2).navegar(i)}),c.Mb(1,"ion-avatar",13),c.qc(2,f,1,1,"ion-img",14),c.qc(3,g,1,1,"ion-img",14),c.Lb(),c.Mb(4,"ion-label",15),c.Mb(5,"strong"),c.rc(6),c.Lb(),c.Kb(7,"br"),c.Mb(8,"div"),c.rc(9),c.Lb(),c.Mb(10,"div",16),c.rc(11),c.Xb(12,"cambioUTC"),c.Lb(),c.Lb(),c.Lb()}if(2&t){const t=e.$implicit;c.dc("color",t.abierta?"blanco":"light"),c.zb(2),c.dc("ngIf",t.cd),c.zb(1),c.dc("ngIf",!t.cd),c.zb(3),c.sc(t.titulo),c.zb(3),c.sc(t.mensaje),c.zb(2),c.sc(c.Yb(12,6,t.fechaCreado))}}function v(t,e){if(1&t&&(c.Mb(0,"ion-list",10),c.qc(1,m,13,8,"ion-item",11),c.Lb()),2&t){const t=c.Wb();c.zb(1),c.dc("ngForOf",t.notificaciones)}}function w(t,e){if(1&t){const t=c.Nb();c.Mb(0,"ion-infinite-scroll",18,19),c.Ub("ionInfinite",function(e){return c.lc(t),c.Wb().loadData(e)}),c.Kb(2,"ion-infinite-scroll-content",20),c.Lb()}}const E=[{path:"",component:(()=>{class t{constructor(t,e,i,o){this.almacenamiento=t,this.usuarioApi=e,this.toastCtrl=i,this.router=o,this.notificaciones=[""],this.desde=0,this.carga=!1}ngOnInit(){}ionViewWillEnter(){this.inicio()}inicio(){return Object(s.a)(this,void 0,void 0,function*(){const t=yield this.almacenamiento.obtenerToken();t&&this.usuarioApi.traerMisNotificaciones(t.token,this.desde).subscribe(t=>{t.exe?(t.response.forEach(t=>{t.usuarioCreador?(t.cd=!0,t.usuarioCreador.imagen.length>0&&(t.imagen=t.usuarioCreador.imagen[0].path)):t.cd=!1}),this.notificaciones=t.response,this.carga=!0):this.toastCtrl.alertApplication("No se pudo traer las notificaciones, intentelo m\xe1s tarde",!1)},t=>{this.toastCtrl.alertApplication("No se pudo traer las notificaciones, intentelo m\xe1s tarde",!1)})})}refrescando(t){this.desde=0,this.inicio().then(()=>{t.detail.complete()})}loadData(t){return Object(s.a)(this,void 0,void 0,function*(){this.desde=this.desde+10;const e=yield this.almacenamiento.obtenerToken();e&&this.usuarioApi.traerMisNotificaciones(e.token,this.desde).subscribe(e=>{e.exe?e.response.length>0?(e.response.forEach(t=>{t.usuarioCreador?(t.cd=!0,t.usuarioCreador.imagen.length>0&&(t.imagen=t.usuarioCreador.imagen[0].path)):t.cd=!1,this.notificaciones.push(t)}),t.target.complete()):(t.target.disabled=!0,this.desde=0):this.toastCtrl.alertApplication("No se pudo traer las notificaciones, intentelo m\xe1s tarde",!1)},t=>{this.toastCtrl.alertApplication("No se pudo traer las notificaciones, intentelo m\xe1s tarde",!1)})})}navegar(t){return Object(s.a)(this,void 0,void 0,function*(){const e=yield this.almacenamiento.obtenerToken();e&&this.usuarioApi.ActualizarNotificaciones(e.token,t._id).subscribe(e=>{e.exe&&("Seguimiento"===t.accion.tipo?this.router.navigate(["/central/menu/solicitudes"]):"SeguimientoAceptado"===t.accion.tipo?this.router.navigate(["/central/buscar/perfil-visita/",t.usuarioCreador.nombreusuario]):"Productos"===t.accion.tipo?this.router.navigate(["/central/menu/ivt-miinventario/",t.accion.data.id,"productos",t.accion.data.id]):"SalidaIVT"===t.accion.tipo?this.router.navigate(["/central/menu/ivt-miinventario/",t.accion.data.id,"salidas",t.accion.data.id,t.accion.data.creador]):"EntradaIVT"===t.accion.tipo?this.router.navigate(["/central/menu/ivt-miinventario/",t.accion.data.id,"entradas",t.accion.data.id]):"Publicacion"===t.accion.tipo?this.router.navigate(["/igtmpublic/",t.accion.data.id,"publicacion"]):"Historia"===t.accion.tipo?this.router.navigate(["/igtmpublic/",t.accion.data.id,"historia"]):"Historia"===t.accion.tipo?this.router.navigate(["/central/tickets/",t.accion.data.id]):"TicketRechazado"===t.accion.tipo||"TicketProcesado"===t.accion.tipo?this.router.navigate(["/central/tickets"]):"Pedido"===t.accion.tipo?this.router.navigate(["/central/pedidos/info",t.accion.data.id]):"Chat"===t.accion.tipo?this.router.navigate(["/central/citas",t.accion.data.idChat]):"patinada"===t.accion.tipo?this.router.navigate(["/central/patinadas"]):"mispatinadas"===t.accion.tipo&&this.router.navigate(["/central/mispatinadas"]))})})}}return t.\u0275fac=function(e){return new(e||t)(c.Jb(u.a),c.Jb(p.a),c.Jb(h.a),c.Jb(n.g))},t.\u0275cmp=c.Db({type:t,selectors:[["app-notificaciones"]],viewQuery:function(t,e){if(1&t&&c.vc(d,1),2&t){let t;c.kc(t=c.Vb())&&(e.infinite=t.first)}},decls:12,vars:3,consts:[[1,"ion-no-border"],["color","oscuro"],["slot","start"],["icon","chevron-back-outline","defaultHref","/central/menu/"],["slot","fixed","pullFactor","0.5","pullMin","50","pullMax","150",3,"ionRefresh"],["pullingIcon","arrow-dropdown","refreshingSpinner","circles"],["class","tituloGrande",4,"ngIf"],["class","blanco ",4,"ngIf"],["threshold","100px",3,"ionInfinite",4,"ngIf"],[1,"tituloGrande"],[1,"blanco"],["lines","none",3,"color","click",4,"ngFor","ngForOf"],["lines","none",3,"color","click"],["slot","start",1,"avatar"],[3,"src",4,"ngIf"],[1,"ion-text-wrap"],[1,"ion-text-right"],[3,"src"],["threshold","100px",3,"ionInfinite"],["inifinito",""],["loadingSpinner","bubbles","loadingText","Cargando entradas..."]],template:function(t,e){1&t&&(c.Mb(0,"ion-header",0),c.Mb(1,"ion-toolbar",1),c.Mb(2,"ion-buttons",2),c.Kb(3,"ion-back-button",3),c.Lb(),c.Mb(4,"ion-title"),c.rc(5,"Notificaciones"),c.Lb(),c.Lb(),c.Lb(),c.Mb(6,"ion-content"),c.Mb(7,"ion-refresher",4),c.Ub("ionRefresh",function(t){return e.refrescando(t)}),c.Kb(8,"ion-refresher-content",5),c.Lb(),c.qc(9,b,2,0,"h3",6),c.qc(10,v,2,1,"ion-list",7),c.qc(11,w,3,0,"ion-infinite-scroll",8),c.Lb()),2&t&&(c.zb(9),c.dc("ngIf",0===e.notificaciones.length),c.zb(1),c.dc("ngIf",e.notificaciones.length>0),c.zb(1),c.dc("ngIf",e.carga))},directives:[a.z,a.jb,a.k,a.g,a.h,a.hb,a.t,a.P,a.Q,o.j,a.L,o.i,a.F,a.f,a.K,a.B,a.C,a.D],pipes:[l.a],styles:[".avatar[_ngcontent-%COMP%]{width:80px;height:80px}.moto-padre[_ngcontent-%COMP%]{display:flex;justify-content:space-between}.tituloGrande[_ngcontent-%COMP%]{margin:50px auto;opacity:.5;text-align:center;width:300px}ion-item[_ngcontent-%COMP%]{border-bottom:2px solid rgba(0,0,0,.1)}"]}),t})()}];let j=(()=>{class t{}return t.\u0275mod=c.Hb({type:t}),t.\u0275inj=c.Gb({factory:function(e){return new(e||t)},imports:[[n.i.forChild(E)],n.i]}),t})();var O=i("iTUp");let x=(()=>{class t{}return t.\u0275mod=c.Hb({type:t}),t.\u0275inj=c.Gb({factory:function(e){return new(e||t)},imports:[[o.b,r.e,a.kb,j,O.a]]}),t})()},SpuA:function(t,e,i){"use strict";i.d(e,"a",function(){return a});var o=i("wd/R"),r=i("fXoL");let a=(()=>{class t{transform(t){console.log(t,"fechin");let e=o.utc(t).toDate();return o(e).format("dddd, DD MMMM YYYY h:mm:a")}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275pipe=r.Ib({name:"cambioUTC",type:t,pure:!0}),t})()},oQG1:function(t,e,i){"use strict";i.d(e,"a",function(){return g});var o=i("tk/3"),r=i("PqYM"),a=i("Cfvw"),n=i("coGc"),s=i("lJxs"),c=i("IzEk"),u=i("MtjB"),p=i("JIr8"),h=i("AytR"),l=i("fXoL"),d=i("B7Rs"),b=i("fsfq"),f=i("TEn/");let g=(()=>{class t{constructor(t,e,i,o){this.http=t,this.transfer=e,this.almacenamiento=i,this.navCtrl=o}hanflerError(t){let e=0;return t.pipe(Object(n.a)(()=>Object(r.a)(5e3)),Object(s.a)(t=>{if(e++,console.log("Entramos a intentos"),t instanceof ErrorEvent){if(3===e)throw new Error("Error de Red")}else{if(!(t instanceof ProgressEvent))throw 404===t.status?new Error(" al realizar la solicictud "):401===t.status?(this.almacenamiento.terminarPartida().then(()=>{this.navCtrl.navigateRoot("/home")}),new Error("No tiene permisos para realizar la petici\xf3n ")):(console.log(t,"Error de servidor"),new Error(" No se pudo realizar la petici\xf3n, intentalo m\xe1s tarde "));if(3===e)throw new Error("Error de Red")}}),Object(c.a)(3))}registrar(t){return this.http.post(`${h.a}/usuarios`,t).pipe(Object(s.a)(t=>t.exe?(t.response.exe=t.exe,t.response.token=t.token,t.response):t),Object(u.a)(t=>this.hanflerError(t)))}usuario(t){return this.http.post(`${h.a}/usuarios/unico`,{buscar:t}).pipe(Object(u.a)(t=>this.hanflerError(t)))}iniciarPartida(t,e){const i={headers:new o.c({"x-dispositivoID":e})};return this.http.post(`${h.a}/login`,t,i).pipe(Object(s.a)(t=>(console.log(t),t.exe?(t.response.exe=t.exe,t.response.token=t.token,t.response):t.exe)),Object(u.a)(t=>this.hanflerError(t)))}fotoPerfilUsuarioMoto(t,e,i){const o={fileKey:"archivo",httpMethod:"PUT",headers:{"x-token":e},params:{tipo:i}},r=this.transfer.create();return Object(a.a)(r.upload(t,`${h.a}/upload`,o)).pipe(Object(p.a)(t=>{throw console.log("No se pudo subir la imagen "),new Error("No se pudo subir la imagen ")}))}fotoPortada(t,e,i){const o={fileKey:"archivo",httpMethod:"PUT",headers:{"x-token":e},params:{old:i}},r=this.transfer.create();return Object(a.a)(r.upload(t,`${h.a}/upload/portada/`,o)).pipe(Object(p.a)(t=>{throw console.log("No se pudo subir la imagen "),new Error("No se pudo subir la imagen ")}))}viewImagen(t){const e={headers:new o.c({"x-token":t})};return this.http.get(`${h.a}/ver`,e).pipe(Object(u.a)(t=>this.hanflerError(t)))}buscarUsuario(t,e){const i={headers:new o.c({"x-token":e})};return this.http.get(`${h.a}/usuarios/${t}`,i).pipe(Object(u.a)(t=>this.hanflerError(t)))}cerrar(t){const e={headers:new o.c({"x-token":t})};return this.http.put(`${h.a}/usuarios/cerrar/`,{},e).pipe(Object(u.a)(t=>this.hanflerError(t)))}usuarioDatos(t){const e={headers:new o.c({"x-token":t})};return this.http.put(`${h.a}/usuarios/uno/`,{},e).pipe(Object(u.a)(t=>this.hanflerError(t)))}editarUusuario(t,e){const i={headers:new o.c({"x-token":t})};return this.http.put(`${h.a}/usuarios/editar/uno/`,e,i).pipe(Object(u.a)(t=>this.hanflerError(t)))}buscarPerfilUsuario(t,e){const i={headers:new o.c({"x-token":e})};return this.http.get(`${h.a}/usuarios/perfil/${t}`,i).pipe(Object(u.a)(t=>this.hanflerError(t)))}traerMisNotificaciones(t,e){const i={headers:new o.c({"x-token":t,"x-desde":e.toString()})};return this.http.get(`${h.a}/notificaciones/misnotificaciones/`,i).pipe(Object(u.a)(t=>this.hanflerError(t)))}notiCantidad(t){const e={headers:new o.c({"x-token":t})};return this.http.get(`${h.a}/notificaciones/numero/`,e).pipe(Object(u.a)(t=>this.hanflerError(t)))}ActualizarNotificaciones(t,e){const i={headers:new o.c({"x-token":t})};return this.http.put(`${h.a}/notificaciones/misnotificaciones/cambiarestado/`,{id:e},i).pipe(Object(u.a)(t=>this.hanflerError(t)))}validarClave(t,e){const i={headers:new o.c({"x-token":t})};return this.http.put(`${h.a}/usuarios/claves/`,e,i).pipe(Object(u.a)(t=>this.hanflerError(t)))}editarClaves(t,e){const i={headers:new o.c({"x-token":t})};return this.http.put(`${h.a}/usuarios/claves/editar`,e,i).pipe(Object(u.a)(t=>this.hanflerError(t)))}editarClaves2(t){return this.http.put(`${h.a}/usuarios/claves/editar/dos`,t).pipe(Object(u.a)(t=>this.hanflerError(t)))}listarPaises(){return this.http.get(`${h.a}/paises`).pipe(Object(u.a)(t=>this.hanflerError(t)))}listarCiudades(t){const e={headers:new o.c({"x-pais":t})};return this.http.get(`${h.a}/ciudad`,e).pipe(Object(u.a)(t=>this.hanflerError(t)))}CodigoComprobar(t){return this.http.put(`${h.a}/codigos`,t).pipe(Object(u.a)(t=>this.hanflerError(t)))}EditarCodigo(t){return this.http.put(`${h.a}/codigos/cambiar`,t).pipe(Object(u.a)(t=>this.hanflerError(t)))}negocios(){return this.http.get(`${h.a}/tiponegocio`).pipe(Object(u.a)(t=>this.hanflerError(t)))}modulos(t){const e={headers:new o.c({"x-token":t})};return this.http.get(`${h.a}/modulos`,e).pipe(Object(u.a)(t=>this.hanflerError(t)))}modulosTALLER(t,e){const i={headers:new o.c({"x-token":t})};return this.http.post(`${h.a}/modulos`,e,i).pipe(Object(u.a)(t=>this.hanflerError(t)))}Cambio(t){return this.http.post(`${h.a}/cambio`,t).pipe(Object(u.a)(t=>this.hanflerError(t)))}Validar(t){return this.http.put(`${h.a}/cambio`,t).pipe(Object(u.a)(t=>this.hanflerError(t)))}}return t.\u0275fac=function(e){return new(e||t)(l.Qb(o.a),l.Qb(d.a),l.Qb(b.a),l.Qb(f.pb))},t.\u0275prov=l.Fb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})()}}]);