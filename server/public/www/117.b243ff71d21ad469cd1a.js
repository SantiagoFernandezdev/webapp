(window.webpackJsonp=window.webpackJsonp||[]).push([[117],{pICn:function(t,i,e){"use strict";e.r(i),e.d(i,"SalasInicioPageModule",function(){return K});var o=e("ofXK"),s=e("3Pt+"),n=e("TEn/"),a=e("tyNb"),c=e("mrSG"),r=e("R0Ic"),d=e("HDdC"),l=e("ypew"),b=e("fXoL"),h=e("fsfq"),p=e("fmoy"),u=e("HavB"),f=e("7JkF"),g=e("SpuA");const m=["inifinito"],v=["contenido"];function M(t,i){if(1&t&&(b.Mb(0,"div",10),b.Kb(1,"ion-spinner",11),b.Mb(2,"div"),b.rc(3," Cargando chats... "),b.Kb(4,"br"),b.Mb(5,"strong"),b.rc(6),b.Lb(),b.Lb(),b.Lb()),2&t){const t=b.Wb(2);b.zb(6),b.tc(" ",t.usuario,"")}}function x(t,i){1&t&&(b.Mb(0,"div",10),b.Mb(1,"div",14),b.Kb(2,"img",15),b.Kb(3,"br"),b.rc(4," A\xfan no tiene chats creados "),b.Kb(5,"br"),b.Lb(),b.Lb())}function L(t,i){if(1&t&&(b.Mb(0,"ion-avatar",28),b.Kb(1,"img",29),b.Lb()),2&t){const t=b.Wb().$implicit;b.dc("@escribiendo",t.escribiendo?"activo":"noactivo"),b.zb(1),b.fc("src","https://www.motocaliapp.com/",t.taller.imagen[0].path,"",b.mc)}}function C(t,i){if(1&t&&(b.Mb(0,"ion-avatar",28),b.Kb(1,"img",29),b.Lb()),2&t){const t=b.Wb().$implicit;b.dc("@escribiendo",t.escribiendo?"activo":"noactivo"),b.zb(1),b.fc("src","https://www.motocaliapp.com/",t.creador.imagen[0].path,"",b.mc)}}function k(t,i){if(1&t&&(b.Mb(0,"strong"),b.rc(1),b.Lb()),2&t){const t=b.Wb().$implicit;b.zb(1),b.tc(" ",t.creador.nombrecompleto,"")}}function z(t,i){if(1&t&&(b.Mb(0,"strong"),b.rc(1),b.Lb()),2&t){const t=b.Wb().$implicit;b.zb(1),b.tc(" ",t.taller.nombrecompleto,"")}}function j(t,i){1&t&&(b.Mb(0,"span"),b.rc(1," Escribiendo..."),b.Lb())}function O(t,i){if(1&t&&(b.Mb(0,"div",30),b.rc(1),b.Lb()),2&t){const t=b.Wb().$implicit;b.zb(1),b.sc(t.novistos)}}function _(t,i){if(1&t){const t=b.Nb();b.Mb(0,"ion-item-option",31),b.Ub("click",function(){b.lc(t);const i=b.Wb().$implicit;return b.Wb(4).agregar(i)}),b.Kb(1,"ion-icon",32),b.Lb()}}function w(t,i){if(1&t){const t=b.Nb();b.Mb(0,"ion-item-sliding"),b.Mb(1,"ion-item",18),b.Ub("click",function(){b.lc(t);const e=i.$implicit;return b.Wb(4).entrar(e)}),b.qc(2,L,2,2,"ion-avatar",19),b.qc(3,C,2,2,"ion-avatar",19),b.Mb(4,"ion-label",20),b.Mb(5,"div",21),b.qc(6,k,2,1,"strong",2),b.qc(7,z,2,1,"strong",2),b.Lb(),b.Mb(8,"strong"),b.rc(9),b.Lb(),b.Mb(10,"div"),b.rc(11),b.Xb(12,"cambioUTC"),b.Lb(),b.Mb(13,"div",22),b.qc(14,j,2,0,"span",2),b.Lb(),b.qc(15,O,2,1,"div",23),b.Lb(),b.Lb(),b.Mb(16,"ion-item-options",24),b.qc(17,_,2,0,"ion-item-option",25),b.Mb(18,"ion-item-option",26),b.Ub("click",function(){b.lc(t);const e=i.$implicit;return b.Wb(4).quitar(e._id)}),b.Kb(19,"ion-icon",27),b.Lb(),b.Lb(),b.Lb()}if(2&t){const t=i.$implicit,e=b.Wb(4);b.zb(2),b.dc("ngIf",t.creador._id===e.id),b.zb(1),b.dc("ngIf",t.creador._id!==e.id),b.zb(2),b.dc("@escribiendo",t.escribiendo?"activo":"noactivo"),b.zb(1),b.dc("ngIf",t.creador._id!==e.id),b.zb(1),b.dc("ngIf",t.creador._id===e.id),b.zb(1),b.Bb("ticket","ticket"===t.tipo)("pedido","pedido"===t.tipo)("hoja","hoja"===t.tipo),b.dc("@escribiendo",t.escribiendo?"activo":"noactivo"),b.zb(1),b.tc("Chat Tipo: ",t.tipo,""),b.zb(1),b.dc("@escribiendo",t.escribiendo?"activo":"noactivo"),b.zb(1),b.sc(b.Yb(12,18,t.fecha)),b.zb(3),b.dc("ngIf",t.escribiendo),b.zb(1),b.dc("ngIf",t.novistos>0),b.zb(2),b.dc("ngIf",t.taller._id===e.id||"TALLER_ROLE"===e.role)}}function y(t,i){if(1&t&&(b.Mb(0,"div",16),b.Mb(1,"ion-list"),b.qc(2,w,20,20,"ion-item-sliding",17),b.Lb(),b.Lb()),2&t){const t=b.Wb(3);b.zb(2),b.dc("ngForOf",t.salas)}}function I(t,i){if(1&t&&(b.Mb(0,"div"),b.qc(1,x,6,0,"div",12),b.qc(2,y,3,1,"div",13),b.Lb()),2&t){const t=b.Wb(2);b.zb(1),b.dc("ngIf",0===t.salas.length),b.zb(1),b.dc("ngIf",t.salas.length>0)}}function E(t,i){if(1&t){const t=b.Nb();b.Mb(0,"ion-infinite-scroll",33,34),b.Ub("ionInfinite",function(i){return b.lc(t),b.Wb(2).loadData(i)}),b.Kb(2,"ion-infinite-scroll-content",35),b.Lb()}}function P(t,i){if(1&t){const t=b.Nb();b.Mb(0,"ion-content",null,3),b.Mb(2,"ion-refresher",4),b.Ub("ionRefresh",function(i){return b.lc(t),b.Wb().refrescando(i)}),b.Kb(3,"ion-refresher-content",5),b.Lb(),b.Mb(4,"ion-searchbar",6),b.Ub("ionChange",function(i){return b.lc(t),b.Wb().buscar(i)}),b.Lb(),b.qc(5,M,7,1,"div",7),b.Kb(6,"div",8),b.qc(7,I,3,2,"div",2),b.qc(8,E,3,0,"ion-infinite-scroll",9),b.Lb()}if(2&t){const t=b.Wb();b.zb(5),b.dc("ngIf",!t.cargado),b.zb(2),b.dc("ngIf",t.cargado),b.zb(1),b.dc("ngIf",t.cargado)}}const W=[{path:"",component:(()=>{class t{constructor(t,i,e,o,s,n,a){this.router=t,this.alert=i,this.almacenamiento=e,this.toast=o,this.apiPedidos=s,this.socket=n,this.modal=a,this.configurando=!1,this.usuario="",this.habilitado=!1,this.cargado=!1,this.id="",this.salas=[],this.desde=0,this.patron="",this.scroll=!0,this.role="",this.escucharEscritoss().subscribe(t=>{console.log("escribiendo...",t),t.exe&&this.salas.forEach(i=>{i._id===t.idsala&&(console.log("existe"),i.escribiendo=!0,setTimeout(()=>{i.escribiendo=!1},500))})}),this.escucharMensaje().subscribe(t=>Object(c.a)(this,void 0,void 0,function*(){if(console.log("mensaje",t),t.exe){const i=yield this.almacenamiento.obtenerToken();if(i){const e=this.salas.filter(i=>i._id===t.resp.sala._id);this.apiPedidos.mensajes(i.token,{idsala:e[0]._id}).subscribe(i=>{this.salas=this.salas.filter(i=>i._id!==t.resp.sala._id),e[0].novistos=i.exe?i.response.length:0,this.salas.unshift(e[0])},i=>{this.salas=this.salas.filter(i=>i._id!==t.resp.sala._id),e[0].novistos=0,this.salas.unshift(e[0])})}}}))}ngOnInit(){}ionViewWillEnter(){this.pedidosListar()}refrescando(t){this.pedidosListar().then(()=>{t.detail.complete()}).catch(()=>{t.detail.complete()})}pedidosListar(){return Object(c.a)(this,void 0,void 0,function*(){const t=yield this.almacenamiento.obtenerToken();t&&(this.role=t.role,this.id=t._id,this.usuario=t.nombre,this.apiPedidos.misChats(t.token,{patron:"",desde:this.desde}).subscribe(i=>{if(i.exe){let e=i.response.length;i.response.forEach(o=>Object(c.a)(this,void 0,void 0,function*(){o.escribiendo=!1,this.socket.emit("iniciochat",{id:o._id}),(yield new Promise((i,e)=>{this.apiPedidos.mensajes(t.token,{idsala:o._id}).subscribe(t=>{t.exe?(console.log(t,"RESPUESTA DEL TODO"),o.fechamsg=t.response.lemgth>0?t.response[t.response.length-1]:o.fecha,o.novistos=t.response.length,i(!0)):(o.novistos=0,i(!0))},t=>{o.novistos=0,i(!0)})}))&&(e-=1,0===e&&(this.salas=i.response,console.log(this.salas,"salas",e),this.salas.sort((t,i)=>(console.log(t.novistos),t.novistos<i.novistos?(console.log("meno"),1):t.novistos>i.novistos?(console.log("mayor"),-1):0))),this.cargado=!0)})),0===i.response.length&&(this.cargado=!0)}else this.toast.toastError("No se pudo consultar los pedidos, int\xe9ntelo m\xe1s tarde"),this.router.navigate(["/central/menu/"]),this.cargado=!0},t=>{this.toast.toastError("No se pudo consultar los pedidos, int\xe9ntelo m\xe1s tarde"),this.router.navigate(["/central/menu/"])}))})}crear(){return Object(c.a)(this,void 0,void 0,function*(){const t=yield this.alert.create({header:"Crear Pedido",message:"Los pedidos puedes realizarlos para comprar los repuestos o productos que necesites para tu veh\xedculo.",buttons:[{text:"Cancelar",cssClass:"cancelarAlerta",role:"cancel",handler:()=>{}},{text:"Crear",cssClass:"botonalerta",handler:t=>{this.router.navigate(["/central/menu/control-mapas"])}}]});yield t.present()})}escucharEscritoss(){return new d.a(t=>{this.socket.on("escribiendoChat",i=>{t.next(i)})})}escucharMensaje(){return new d.a(t=>{this.socket.on("mensajeChat",i=>{t.next(i)})})}entrar(t){this.almacenamiento.insertarChat(t).then(()=>{this.router.navigate(["/central/chats/chat"])}).catch(()=>{this.toast.toastError("No se puede acceder al chat, int\xe9ntelo m\xe1s tarde")})}agregar(t){return Object(c.a)(this,void 0,void 0,function*(){const i=yield this.modal.create({component:l.a,componentProps:{sala:t}});yield i.present()})}quitar(t){return Object(c.a)(this,void 0,void 0,function*(){const i=yield this.alert.create({header:"Atenci\xf3n!",message:"\xbfEstas seguro de abandonar esta sala? No podras visualizar de nuevo la  informaci\xf3n dentro de ella",buttons:[{text:"Cancelar",cssClass:"cancelarAlerta",role:"cancel",handler:()=>{}},{text:"Salir",cssClass:"botonalerta",handler:()=>Object(c.a)(this,void 0,void 0,function*(){const i=yield this.almacenamiento.obtenerToken();if(i){let e=this.salas.filter(i=>i._id===t)[0].accesos;e=e.map(t=>t),e=e.filter(t=>t!==i._id),console.log(e),this.apiPedidos.editarChat(i.token,{id:t,accesos:e}).subscribe(t=>{t.exe?(this.toast.Especial("Saliste de la sala"),this.pedidosListar()):this.toast.toastError("No se pudo realizar la petici\xf3n, int\xe9ntelo m\xe1s tarde")},t=>{this.toast.toastError("No se pudo realizar la petici\xf3n, int\xe9ntelo m\xe1s tarde")})}})}]});yield i.present()})}buscar(t){return Object(c.a)(this,void 0,void 0,function*(){if(""!==t.detail.value){this.desde=0,this.infinite.disabled=!1,this.patron=t.detail.value;const i=yield this.almacenamiento.obtenerToken();i&&this.apiPedidos.misChats(i.token,{desde:this.desde,patron:this.patron}).subscribe(t=>{t.exe?(this.salas=t.response,0===t.response.length&&(this.desde=0)):this.toast.toastError("No se pudo realizar la consulta, intentelo m\xe1s tarde")},t=>{this.toast.toastError("No se pudo realizar la consulta, intentelo m\xe1s tarde")})}else this.desde=0,this.pedidosListar()})}loadData(t){return Object(c.a)(this,void 0,void 0,function*(){this.desde=this.desde+15;const i=yield this.almacenamiento.obtenerToken();i&&(""===this.patron?this.apiPedidos.misChats(i.token,{desde:this.desde,patron:this.patron}).subscribe(i=>{i.exe?i.response.length>0?(i.response.forEach(t=>{this.salas.push(t)}),t.target.complete()):(t.target.disabled=!0,this.desde=0):this.toast.toastError("No se pudo traer los chats, int\xe9ntelo m\xe1s tarde.")},t=>{this.toast.toastError("No se pudo traer los chats, int\xe9ntelo m\xe1s tarde.")}):this.apiPedidos.misChats(i.token,{desde:this.desde,patron:this.patron}).subscribe(i=>{i.exe?i.response.length>0?(i.response.forEach(t=>{this.salas.push(t)}),t.target.complete()):(t.target.disabled=!0,this.desde=0):this.toast.toastError("No se pudo realizar la consulta, intentelo m\xe1s tarde")},t=>{this.toast.toastError("No se pudo realizar la consulta, intentelo m\xe1s tarde")}))})}ionViewWillLeave(){this.salas.forEach(t=>{this.socket.emit("salidachat",{id:t._id})})}}return t.\u0275fac=function(i){return new(i||t)(b.Jb(a.g),b.Jb(n.b),b.Jb(h.a),b.Jb(p.a),b.Jb(u.a),b.Jb(f.a),b.Jb(n.ob))},t.\u0275cmp=b.Db({type:t,selectors:[["app-salas-inicio"]],viewQuery:function(t,i){if(1&t&&(b.vc(m,1),b.vc(v,1)),2&t){let t;b.kc(t=b.Vb())&&(i.infinite=t.first),b.kc(t=b.Vb())&&(i.contenido=t.first)}},decls:6,vars:1,consts:[["color","oscuro"],["slot","start","icon","chevron-back-outline","defaultHref","/central/menu"],[4,"ngIf"],["contenido",""],["slot","fixed","pullFactor","0.5","pullMin","50","pullMax","150",3,"ionRefresh"],["pullingIcon","arrow-dropdown","refreshingSpinner","circles"],["debounce","300","mode","ios","placeholder","Buscar chats por tipo",3,"ionChange"],["class","flcenter ion-padding",4,"ngIf"],[1,"divider","light"],["threshold","100px",3,"ionInfinite",4,"ngIf"],[1,"flcenter","ion-padding"],["name","crescent","color","oscuro"],["class","flcenter ion-padding ",4,"ngIf"],["class"," ",4,"ngIf"],[1,"ct"],["src","/assets/Citas.png","width","80px","alt",""],[1,""],[4,"ngFor","ngForOf"],[3,"click"],["slot","start",4,"ngIf"],[1,"relativo"],[1,"info"],[1,"escribiendo"],["class","nv",4,"ngIf"],["side","end"],["color","barra",3,"click",4,"ngIf"],["color","danger",3,"click"],["name","trash-outline","slot","icon-only"],["slot","start"],[3,"src"],[1,"nv"],["color","barra",3,"click"],["name","add-outline","slot","icon-only"],["threshold","100px",3,"ionInfinite"],["inifinito",""],["loadingSpinner","bubbles","loadingText","Cargando Hojas de Vida..."]],template:function(t,i){1&t&&(b.Mb(0,"ion-header"),b.Mb(1,"ion-toolbar",0),b.Kb(2,"ion-back-button",1),b.Mb(3,"ion-title"),b.rc(4,"Sistema de Chats"),b.Lb(),b.Lb(),b.Lb(),b.qc(5,P,9,3,"ion-content",2)),2&t&&(b.zb(5),b.dc("ngIf",i.scroll))},directives:[n.z,n.jb,n.g,n.h,n.hb,o.j,n.t,n.P,n.Q,n.T,n.wb,n.bb,n.L,o.i,n.J,n.F,n.K,n.I,n.H,n.A,n.f,n.C,n.D],pipes:[g.a],styles:[".flcenter[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:center;align-items:center;font-size:20px;text-align:center}ion-card[_ngcontent-%COMP%]{position:relative}.tp[_ngcontent-%COMP%]{z-index:10;background-color:initial}.ct[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;font-size:20px;font-weight:300}.msg[_ngcontent-%COMP%]{position:absolute;top:0;right:0;text-align:center;padding:5px 10px;border-radius:10px}.escribiendo[_ngcontent-%COMP%]{color:#627e42;font-weight:700;font-size:14px;height:20px}.relativo[_ngcontent-%COMP%]{position:relative}.nv[_ngcontent-%COMP%]{position:absolute;bottom:5px;right:5px;background-color:#627e42;color:#fff;text-align:center;min-width:20px;min-height:20px;max-width:50px;max-height:50px;border-radius:100%}.info[_ngcontent-%COMP%]{width:70%}.ticket[_ngcontent-%COMP%]{color:#e53935}.pedido[_ngcontent-%COMP%]{color:orange}.hoja[_ngcontent-%COMP%]{color:#4a4a4a}"],data:{animation:[Object(r.l)("escribiendo",[Object(r.i)("activo",Object(r.j)({opacity:.5})),Object(r.i)("noactivo",Object(r.j)({opacity:1})),Object(r.k)("activo <=> noactivo",[Object(r.e)("300ms")])])]}}),t})()}];let q=(()=>{class t{}return t.\u0275mod=b.Hb({type:t}),t.\u0275inj=b.Gb({factory:function(i){return new(i||t)},imports:[[a.i.forChild(W)],a.i]}),t})();var N=e("iTUp");let K=(()=>{class t{}return t.\u0275mod=b.Hb({type:t}),t.\u0275inj=b.Gb({factory:function(i){return new(i||t)},imports:[[o.b,s.e,n.kb,q,N.a]]}),t})()}}]);