(window.webpackJsonp=window.webpackJsonp||[]).push([[32],{"+Aiu":function(t,e,o){"use strict";o.r(e),o.d(e,"InicioTicketsPersonasPageModule",function(){return O});var n=o("ofXK"),r=o("3Pt+"),i=o("TEn/"),c=o("tyNb"),a=o("mrSG"),s=o("HDdC"),d=o("fXoL"),l=o("fsfq"),h=o("fmoy"),b=o("+WxW"),p=o("7JkF"),u=o("SpuA");function f(t,e){1&t&&(d.Mb(0,"div",12),d.Mb(1,"div"),d.rc(2," A\xfan no tiene tickets creados "),d.Kb(3,"br"),d.Lb(),d.Lb())}function g(t,e){1&t&&(d.Mb(0,"strong"),d.rc(1,"Esperando"),d.Lb())}function k(t,e){1&t&&(d.Mb(0,"strong"),d.rc(1,"Cancelada"),d.Lb())}function m(t,e){1&t&&(d.Mb(0,"strong"),d.rc(1,"Procesada"),d.Lb())}function M(t,e){if(1&t){const t=d.Nb();d.Mb(0,"div",21),d.Ub("click",function(){d.lc(t);const e=d.Wb().$implicit;return d.Wb(2).eliminar(e)}),d.Mb(1,"strong"),d.rc(2,"Cancelar Ticket"),d.Lb(),d.Lb()}}function v(t,e){if(1&t){const t=d.Nb();d.Mb(0,"ion-card",13),d.Mb(1,"div",14),d.Ub("click",function(){d.lc(t);const o=e.$implicit;return d.Wb(2).viajar(o)}),d.Mb(2,"ion-card-title"),d.rc(3),d.Lb(),d.Mb(4,"div",15),d.qc(5,g,2,0,"strong",16),d.qc(6,k,2,0,"strong",16),d.qc(7,m,2,0,"strong",16),d.Lb(),d.Mb(8,"ion-card-content"),d.Mb(9,"div"),d.Mb(10,"strong"),d.rc(11,"Negocio:"),d.Lb(),d.rc(12),d.Lb(),d.Mb(13,"div"),d.Mb(14,"strong"),d.rc(15,"Tel\xe9fono:"),d.Lb(),d.rc(16),d.Lb(),d.Kb(17,"div",17),d.Mb(18,"div"),d.Mb(19,"strong"),d.rc(20,"Usuario:"),d.Lb(),d.rc(21),d.Lb(),d.Mb(22,"div"),d.Mb(23,"strong"),d.rc(24,"Tel\xe9fono:"),d.Lb(),d.rc(25),d.Lb(),d.Mb(26,"div"),d.Mb(27,"strong"),d.rc(28,"Fecha Ticket:"),d.Lb(),d.rc(29),d.Xb(30,"cambioUTC"),d.Lb(),d.Lb(),d.Lb(),d.Mb(31,"div",18),d.Mb(32,"ion-button",19),d.Ub("click",function(){d.lc(t);const o=e.$implicit;return d.Wb(2).navegar(o._id)}),d.rc(33,"Chat"),d.Lb(),d.Lb(),d.qc(34,M,3,0,"div",20),d.Lb()}if(2&t){const t=e.$implicit,o=e.index;d.zb(3),d.tc("Ticket ",o+1," "),d.zb(1),d.Bb("ocupado",t.cancelado&&!t.procesado)("procesado",t.procesado&&!t.cancelado)("espera",!t.cancelado&&!t.procesado),d.zb(1),d.dc("ngIf",!t.cancelado&&!t.procesado),d.zb(1),d.dc("ngIf",t.cancelado&&!t.procesado),d.zb(1),d.dc("ngIf",t.procesado&&!t.cancelado),d.zb(5),d.tc(" ",t.negocio.nombrecompleto,""),d.zb(4),d.tc(" ",t.negocio.tel,""),d.zb(5),d.tc(" ",t.creador.nombrecompleto,""),d.zb(4),d.tc(" ",t.creador.tel,""),d.zb(4),d.tc(" ",d.Yb(30,16,t.fecha),""),d.zb(5),d.dc("ngIf",!t.cancelado&&!t.procesado)}}function x(t,e){if(1&t&&(d.Mb(0,"div",9),d.qc(1,f,4,0,"div",10),d.qc(2,v,35,18,"ion-card",11),d.Lb()),2&t){const t=d.Wb();d.zb(1),d.dc("ngIf",0===t.tickets.length),d.zb(1),d.dc("ngForOf",t.tickets)}}const w=[{path:"",component:(()=>{class t{constructor(t,e,o,n,r,i){this.almacenamiento=t,this.toast=e,this.apiTickets=o,this.alert=n,this.router=r,this.socket=i,this.configurando=!1,this.usuario="",this.habilitado=!1,this.cargado=!1,this.id="",this.tickets=[],this.escucharRechazos().subscribe(t=>{t.exe?this.tickets.forEach(e=>{e._id===t.data._id&&(e.cancelado=!0)}):this.toast.toastError("No se pudo rechazar tu ticket")}),this.escucharProcesados().subscribe(t=>{t.exe?this.tickets.forEach(e=>{e._id===t.data.doc._id&&(e.procesado=!0)}):this.toast.toastError("No se pudo procesar tu ticket")}),this.escucharMensajes().subscribe(t=>{t.msg?t.eli&&(this.tickets=this.tickets.filter(e=>e._id!==t.id),this.toast.toastExitoso("Ticket rechazado")):this.toast.toastError("No se pudo rechazar el ticket, int\xe9ntelo m\xe1s tarde")})}ngOnInit(){}ionViewWillEnter(){this.misTickets(),this.almacenamiento.insertarTicket("entrando").then(t=>{if(t)return!0})}refrescando(t){this.tickets=[],this.misTickets().then(()=>{t.detail.complete()}).catch(()=>{t.detail.complete()})}misTickets(){return Object(a.a)(this,void 0,void 0,function*(){this.configurando=!0;const t=yield this.almacenamiento.obtenerToken();t&&this.apiTickets.misTickets(t.token).subscribe(t=>{t.exe?(this.tickets=t.response,this.tickets.forEach(t=>{t.procesado||t.cancelado||this.socket.emit("ticket",{id:t.negocio._id})})):(this.toast.toastError("No se pudo traer las tickets, int\xe9ntelo m\xe1s tarde"),this.router.navigate(["/central/menu/"])),this.configurando=!1,this.cargado=!0},t=>{this.toast.toastError("No se pudo traer las tickets, int\xe9ntelo m\xe1s tarde"),this.router.navigate(["/central/menu/"]),this.configurando=!1,this.cargado=!0})})}viajar(t){t.procesado||t.cancelado||this.router.navigate(["/central/tickets/tallerticket",t.negocio._id])}crear(){this.router.navigate(["/central/menu/control-mapas"])}escucharRechazos(){return new s.a(t=>{this.socket.on("rechazar",e=>{t.next(e)})})}escucharProcesados(){return new s.a(t=>{this.socket.on("procesar",e=>{t.next(e)})})}eliminar(t){return Object(a.a)(this,void 0,void 0,function*(){const e=yield this.alert.create({header:"\xbfEstas seguro de eliminar este ticket?",message:"se eliminar\xe1 de forma permanente",buttons:[{text:"Cancelar",cssClass:"cancelarAlerta",role:"cancel"},{text:"Configurar",cssClass:"botonalerta",handler:()=>Object(a.a)(this,void 0,void 0,function*(){(yield this.almacenamiento.obtenerToken())&&this.socket.emit("rechazar",{idtaller:t.negocio._id,id:t._id,idusuario:t.negocio._id})})}]});yield e.present()})}escucharMensajes(){return new s.a(t=>{this.socket.on("mensajeTicket",e=>{t.next(e)})})}ionViewWillLeave(){this.almacenamiento.eleminarTicket().then(t=>{if(t)return!0})}navegar(t){return Object(a.a)(this,void 0,void 0,function*(){const e=yield this.almacenamiento.obtenerToken();e&&this.apiTickets.consultarSala(e.token,{ticket:t}).subscribe(t=>{t.exe&&t.response.length>0?t.response[0].accesos.length>0?this.almacenamiento.insertarChat(t.response[0]).then(()=>{this.router.navigate(["/central/chats/chat"])}).catch(()=>{this.toast.toastError("No se puede acceder al chat, int\xe9ntelo m\xe1s tarde")}):this.toast.Especial("El ticket fue cancelado, ya no puede acceder al chat"):this.toast.toastError("No se puede acceder al chat, int\xe9ntelo m\xe1s tarde")},t=>{this.toast.toastError("No se puede acceder al chat, int\xe9ntelo m\xe1s tarde")})})}}return t.\u0275fac=function(e){return new(e||t)(d.Jb(l.a),d.Jb(h.a),d.Jb(b.a),d.Jb(i.b),d.Jb(c.g),d.Jb(p.a))},t.\u0275cmp=d.Db({type:t,selectors:[["app-inicio-tickets-personas"]],decls:13,vars:1,consts:[["color","oscuro"],["slot","start","icon","chevron-back-outline","defaultHref","/central/menu"],["slot","fixed","pullFactor","0.5","pullMin","50","pullMax","150",3,"ionRefresh"],["pullingIcon","arrow-dropdown","refreshingSpinner","circles"],[1,"divider","light"],["class","salas",4,"ngIf"],["vertical","bottom","horizontal","end","slot","fixed"],["color","oscuro",3,"click"],["name","add"],[1,"salas"],["class","flcenter ion-padding",4,"ngIf"],["mode","ios",4,"ngFor","ngForOf"],[1,"flcenter","ion-padding"],["mode","ios"],[1,"san",3,"click"],[1,"msg"],[4,"ngIf"],[1,"separador"],[1,"botones"],["mode","ios","color","light","expand","block",3,"click"],["class","msg2",3,"click",4,"ngIf"],[1,"msg2",3,"click"]],template:function(t,e){1&t&&(d.Mb(0,"ion-header"),d.Mb(1,"ion-toolbar",0),d.Kb(2,"ion-back-button",1),d.Mb(3,"ion-title"),d.rc(4,"Turnos"),d.Lb(),d.Lb(),d.Lb(),d.Mb(5,"ion-content"),d.Mb(6,"ion-refresher",2),d.Ub("ionRefresh",function(t){return e.refrescando(t)}),d.Kb(7,"ion-refresher-content",3),d.Lb(),d.Kb(8,"div",4),d.qc(9,x,3,2,"div",5),d.Mb(10,"ion-fab",6),d.Mb(11,"ion-fab-button",7),d.Ub("click",function(){return e.crear()}),d.Kb(12,"ion-icon",8),d.Lb(),d.Lb(),d.Lb()),2&t&&(d.zb(9),d.dc("ngIf",e.cargado))},directives:[i.z,i.jb,i.g,i.h,i.hb,i.t,i.P,i.Q,n.j,i.v,i.w,i.A,n.i,i.l,i.p,i.m,i.j],pipes:[u.a],styles:[".flcenter[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:center;align-items:center;font-size:18px;text-align:center}.separador[_ngcontent-%COMP%]{width:100%;border-bottom:1px solid #566520;padding:5px;margin-bottom:5px}.san[_ngcontent-%COMP%], ion-card[_ngcontent-%COMP%]{position:relative}.msg[_ngcontent-%COMP%]{top:0}.msg[_ngcontent-%COMP%], .msg2[_ngcontent-%COMP%]{position:absolute;right:0;text-align:center;padding:5px 10px;border-radius:10px}.msg2[_ngcontent-%COMP%]{bottom:0;background-color:#7b2e18;color:#fff;z-index:10}ion-card-title[_ngcontent-%COMP%]{width:100%;padding:5px 15px}.ocupado[_ngcontent-%COMP%]{background-color:#ca0900!important;color:#fff}.espera[_ngcontent-%COMP%]{background-color:#ffaf00;color:#fff}.procesado[_ngcontent-%COMP%]{background-color:#819830!important;color:#fff}"]}),t})()}];let E=(()=>{class t{}return t.\u0275mod=d.Hb({type:t}),t.\u0275inj=d.Gb({factory:function(e){return new(e||t)},imports:[[c.i.forChild(w)],c.i]}),t})();var L=o("iTUp");let O=(()=>{class t{}return t.\u0275mod=d.Hb({type:t}),t.\u0275inj=d.Gb({factory:function(e){return new(e||t)},imports:[[n.b,r.e,i.kb,E,L.a]]}),t})()},"+WxW":function(t,e,o){"use strict";o.d(e,"a",function(){return b});var n=o("AytR"),r=o("tk/3"),i=o("coGc"),c=o("lJxs"),a=o("IzEk"),s=o("MtjB"),d=o("PqYM"),l=o("fXoL"),h=o("tyNb");let b=(()=>{class t{constructor(t,e){this.http=t,this.router=e}hanflerError(t){return t.pipe(Object(i.a)(()=>Object(d.a)(3e3)),Object(c.a)(t=>{if(console.log("Entramos a intentos"),t instanceof ErrorEvent)throw new Error("Error de Red");if(404===t.status)throw new Error(" P\xe1gina no encontrada");if(401===t.status)throw new Error(" No tiene permisos ")}),Object(a.a)(3))}disponibilidad(t){const e={headers:new r.c({"x-token":t})};return this.http.get(`${n.a}/ticket/disponibilidad`,e).pipe(Object(s.a)(t=>this.hanflerError(t)))}Creardisponibilidad(t){const e={headers:new r.c({"x-token":t})};return this.http.post(`${n.a}/ticket/disponibilidad`,{},e).pipe(Object(s.a)(t=>this.hanflerError(t)))}editardisponibilidad(t,e){const o={headers:new r.c({"x-token":t})};return this.http.put(`${n.a}/ticket/disponibilidad`,e,o).pipe(Object(s.a)(t=>this.hanflerError(t)))}crearSala(t,e){const o={headers:new r.c({"x-token":t})};return this.http.post(`${n.a}/ticket/salas`,e,o).pipe(Object(s.a)(t=>this.hanflerError(t)))}misSalas(t){const e={headers:new r.c({"x-token":t})};return this.http.get(`${n.a}/ticket/salas`,e).pipe(Object(s.a)(t=>this.hanflerError(t)))}crearTicket(t,e){const o={headers:new r.c({"x-token":t})};return this.http.post(`${n.a}/ticket/crear`,e,o).pipe(Object(s.a)(t=>this.hanflerError(t)))}misTickets(t){const e={headers:new r.c({"x-token":t})};return this.http.get(`${n.a}/ticket/lista`,e).pipe(Object(s.a)(t=>this.hanflerError(t)))}misTicketsLista(t,e){const o={headers:new r.c({"x-token":t})};return this.http.put(`${n.a}/ticket/lista/negocio`,e,o).pipe(Object(s.a)(t=>this.hanflerError(t)))}salasNegocio(t,e){const o={headers:new r.c({"x-token":t})};return this.http.put(`${n.a}/ticket/salas/usuario`,e,o).pipe(Object(s.a)(t=>this.hanflerError(t)))}disponibilidadnegocio(t,e){const o={headers:new r.c({"x-token":t})};return this.http.put(`${n.a}/ticket/disponibilidad/negocio`,e,o).pipe(Object(s.a)(t=>this.hanflerError(t)))}ticketsolo(t,e){const o={headers:new r.c({"x-token":t})};return this.http.put(`${n.a}/ticket/solo`,e,o).pipe(Object(s.a)(t=>this.hanflerError(t)))}ticketelimina(t,e){const o={headers:new r.c({"x-token":t})};return this.http.put(`${n.a}/ticket/eliminar`,e,o).pipe(Object(s.a)(t=>this.hanflerError(t)))}crearHoja(t,e){const o={headers:new r.c({"x-token":t})};return this.http.post(`${n.a}/hoja/dos`,e,o).pipe(Object(s.a)(t=>this.hanflerError(t)))}consultarSala(t,e){const o={headers:new r.c({"x-token":t})};return this.http.post(`${n.a}/ticket/consultar/chat`,e,o).pipe(Object(s.a)(t=>this.hanflerError(t)))}}return t.\u0275fac=function(e){return new(e||t)(l.Qb(r.a),l.Qb(h.g))},t.\u0275prov=l.Fb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})()},SpuA:function(t,e,o){"use strict";o.d(e,"a",function(){return i});var n=o("wd/R"),r=o("fXoL");let i=(()=>{class t{transform(t){console.log(t,"fechin");let e=n.utc(t).toDate();return n(e).format("dddd, DD MMMM YYYY h:mm:a")}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275pipe=r.Ib({name:"cambioUTC",type:t,pure:!0}),t})()}}]);