(window.webpackJsonp=window.webpackJsonp||[]).push([[70],{"+Hj7":function(t,e,i){"use strict";i.r(e),i.d(e,"InicioTicketsPageModule",function(){return $});var a=i("ofXK"),n=i("3Pt+"),o=i("TEn/"),r=i("tyNb"),s=i("mrSG"),c=i("HDdC"),d=i("fXoL"),l=i("fsfq"),b=i("fmoy"),u=i("+WxW"),h=i("7JkF"),p=i("OKd0");function f(t,e){if(1&t&&(d.Ob(0,"div",9),d.Mb(1,"ion-spinner",10),d.Ob(2,"div"),d.wc(3," Configurando sistema de turno para "),d.Mb(4,"br"),d.Ob(5,"strong"),d.wc(6),d.Nb(),d.Nb(),d.Nb()),2&t){const t=d.Yb();d.Ab(6),d.yc(" ",t.usuario,"")}}function g(t,e){1&t&&(d.Ob(0,"ion-label"),d.wc(1,"Apagar mi sala de turnos"),d.Nb())}function m(t,e){1&t&&(d.Ob(0,"ion-label"),d.wc(1,"Encender mi sala de turnos"),d.Nb())}function k(t,e){if(1&t){const t=d.Pb();d.Ob(0,"ion-list"),d.Ob(1,"ion-item",11),d.vc(2,g,2,0,"ion-label",5),d.vc(3,m,2,0,"ion-label",5),d.Ob(4,"ion-toggle",12),d.Wb("ionChange",function(e){return d.pc(t),d.Yb().cambiar(e)}),d.Nb(),d.Nb(),d.Nb()}if(2&t){const t=d.Yb();d.Ab(2),d.fc("ngIf",t.habilitado),d.Ab(1),d.fc("ngIf",!t.habilitado),d.Ab(1),d.fc("checked",t.habilitado)}}function v(t,e){1&t&&(d.Ob(0,"div",9),d.Ob(1,"div"),d.wc(2," A\xfan no tiene salas creadas "),d.Mb(3,"br"),d.Nb(),d.Nb())}function O(t,e){1&t&&(d.Ob(0,"strong"),d.wc(1,"Libre"),d.Nb())}function w(t,e){1&t&&(d.Ob(0,"strong"),d.wc(1,"Ocupada"),d.Nb())}function N(t,e){if(1&t&&(d.Ob(0,"div"),d.Ob(1,"strong"),d.wc(2,"Dureci\xf3n estimada del trabajo:"),d.Nb(),d.wc(3),d.Zb(4,"diferencia"),d.Nb()),2&t){const t=d.Yb().$implicit;d.Ab(3),d.yc(" ",d.cc(4,1,t.fechainicio,t.fechafinal,1),"")}}function x(t,e){if(1&t&&(d.Ob(0,"div"),d.Ob(1,"strong"),d.wc(2,"Tiempo transcurrido:"),d.Nb(),d.wc(3),d.Zb(4,"diferencia"),d.Nb()),2&t){const t=d.Yb().$implicit;d.Ab(3),d.yc(" ",d.cc(4,1,t.fechainicio,t.fechafinal,2),"")}}function E(t,e){if(1&t){const t=d.Pb();d.Ob(0,"div",18),d.Ob(1,"ion-button",19),d.Wb("click",function(){d.pc(t);const e=d.Yb().$implicit;return d.Yb(2).navegar(e.ticket._id)}),d.wc(2,"Chat"),d.Nb(),d.Nb()}}function j(t,e){if(1&t){const t=d.Pb();d.Ob(0,"div",18),d.Ob(1,"ion-button",19),d.Wb("click",function(){d.pc(t);const e=d.Yb().$implicit;return d.Yb(2).finalizar(e)}),d.wc(2,"Finalizar Ticket"),d.Nb(),d.Nb()}}function y(t,e){if(1&t){const t=d.Pb();d.Ob(0,"ion-card",15),d.Wb("click",function(){d.pc(t);const i=e.$implicit;return d.Yb(2).salon(i)}),d.Ob(1,"ion-card-title"),d.wc(2),d.Nb(),d.Ob(3,"div",16),d.vc(4,O,2,0,"strong",5),d.vc(5,w,2,0,"strong",5),d.Nb(),d.Ob(6,"ion-card-content"),d.Ob(7,"div"),d.Ob(8,"strong"),d.wc(9,"Persona que atiende:"),d.Nb(),d.wc(10),d.Nb(),d.Mb(11,"br"),d.vc(12,N,5,5,"div",5),d.vc(13,x,5,5,"div",5),d.Mb(14,"br"),d.vc(15,E,3,0,"div",17),d.vc(16,j,3,0,"div",17),d.Nb(),d.Nb()}if(2&t){const t=e.$implicit,i=e.index;d.Ab(2),d.yc("Sala ",i+1," "),d.Ab(1),d.Db("ocupado",t.ocupada)("desocupado",!t.ocupada),d.Ab(1),d.fc("ngIf",!t.ocupada),d.Ab(1),d.fc("ngIf",t.ocupada),d.Ab(5),d.yc(" ",t.atiende,""),d.Ab(2),d.fc("ngIf",""!==t.fechainicio&&t.ocupada),d.Ab(1),d.fc("ngIf",""!==t.fechainicio&&t.ocupada),d.Ab(2),d.fc("ngIf",t.ocupada),d.Ab(1),d.fc("ngIf",t.ocupada)}}function C(t,e){if(1&t&&(d.Ob(0,"div",13),d.vc(1,v,4,0,"div",4),d.vc(2,y,17,12,"ion-card",14),d.Nb()),2&t){const t=d.Yb();d.Ab(1),d.fc("ngIf",0===t.salas.length),d.Ab(1),d.fc("ngForOf",t.salas)}}function A(t,e){if(1&t){const t=d.Pb();d.Ob(0,"ion-fab",20),d.Ob(1,"ion-fab-button",21),d.Wb("click",function(){return d.pc(t),d.Yb().crear()}),d.Mb(2,"ion-icon",22),d.Nb(),d.Nb()}}const T=[{path:"",component:(()=>{class t{constructor(t,e,i,a,n,o){this.almacenamiento=t,this.toast=e,this.apiTickets=i,this.alert=a,this.router=n,this.socket=o,this.configurando=!1,this.usuario="",this.habilitado=!1,this.cargado=!1,this.id="",this.salas=[],this.escucharMensajes().subscribe(t=>{t.msg?(this.salas.forEach(e=>{e._id===t.id&&(e.ocupada=!1,e.info=!1)}),this.toast.toastExitoso("Ticket Finalizado")):this.toast.toastError("No se pudo finalizar el ticket, int\xe9ntelo m\xe1s tarde")})}ngOnInit(){}ionViewWillEnter(){this.disponibilidad(),this.almacenamiento.insertarTicket("entrando").then(t=>{if(t)return!0})}refrescando(t){this.salas=[],this.disponibilidad().then(()=>{t.detail.complete()}).catch(()=>{t.detail.complete()})}disponibilidad(){return Object(s.a)(this,void 0,void 0,function*(){const t=yield this.almacenamiento.obtenerToken();t&&("USER_ROLE"===t.role?this.router.navigate(["/central/menu"]):(this.socket.emit("ticket",{id:t._id}),this.usuario=t.nombre,this.apiTickets.disponibilidad(t.token).subscribe(t=>{t.exe?"no"===t.response?this.alerta():(this.cargado=!0,this.habilitado=t.data[0].estado,this.id=t.data[0]._id,this.misSalas()):(this.toast.toastError("No se pudo consultar la disponibilidad, int\xe9ntelo m\xe1s tarde"),this.router.navigate(["/central/menu/"]))},t=>{this.toast.toastError("No se pudo consultar la disponibilidad, int\xe9ntelo m\xe1s tarde"),this.router.navigate(["/central/menu/"])})))})}Creardisponibilidad(){return Object(s.a)(this,void 0,void 0,function*(){this.configurando=!0;const t=yield this.almacenamiento.obtenerToken();t&&this.apiTickets.Creardisponibilidad(t.token).subscribe(t=>{t.exe?(this.toast.toastExitoso("Configuraci\xf3n realizada correcxtamente, ya puedes disfrutar de este m\xf3dulo"),this.disponibilidad()):(this.toast.toastError("No se pudo configurar tu sala de turnos, int\xe9ntelo m\xe1s tarde"),this.router.navigate(["/central/menu/"])),this.configurando=!1},t=>{this.toast.toastError("No se pudo configurar tu sala de turnos, int\xe9ntelo m\xe1s tarde"),this.router.navigate(["/central/menu/"]),this.configurando=!1})})}alerta(){return Object(s.a)(this,void 0,void 0,function*(){const t=yield this.alert.create({header:"Configurar sistema de turnos",message:"A\xfan no has comenzado a usar este m\xf3dulo, si quieres empezar a crear tus salas de turno puedes dar click en configurar",buttons:[{text:"Cancelar",cssClass:"cancelarAlerta",role:"cancel",handler:()=>{this.router.navigate(["/central/menu/"])}},{text:"Configurar",cssClass:"botonalerta",handler:()=>{this.Creardisponibilidad()}}]});yield t.present()})}cambiar(t){return Object(s.a)(this,void 0,void 0,function*(){this.configurando=!0;const e=yield this.almacenamiento.obtenerToken();e&&this.apiTickets.editardisponibilidad(e.token,{id:this.id,estado:t.detail.checked}).subscribe(t=>{t.exe?this.habilitado=t.response.estado:(this.toast.toastError("No se pudo configurar tu sala de turnos, int\xe9ntelo m\xe1s tarde"),this.router.navigate(["/central/menu/"])),this.configurando=!1},t=>{this.toast.toastError("No se pudo configurar tu sala de turnos, int\xe9ntelo m\xe1s tarde"),this.router.navigate(["/central/menu/"]),this.configurando=!1})})}crear(){return Object(s.a)(this,void 0,void 0,function*(){const t=yield this.alert.create({header:"Crear sala",message:"Por medio de una sala puedes atender los usuarios que esten esperando en la fila, crea tus salas dependiendo de la capacidad del negocio.",inputs:[{type:"text",placeholder:"Persona que atiende",name:"persona"}],buttons:[{text:"Cancelar",cssClass:"cancelarAlerta",role:"cancel"},{text:"Crear Sala",cssClass:"botonalerta",handler:t=>{this.CrearSala({persona:t.persona})}}]});yield t.present()})}misSalas(){return Object(s.a)(this,void 0,void 0,function*(){this.configurando=!0;const t=yield this.almacenamiento.obtenerToken();t&&this.apiTickets.misSalas(t.token).subscribe(t=>{t.exe?this.salas=t.response:(this.toast.toastError("No se pudo traer las salas, int\xe9ntelo m\xe1s tarde"),this.router.navigate(["/central/menu/"])),this.configurando=!1},t=>{this.toast.toastError("No se pudo traer las salas, int\xe9ntelo m\xe1s tarde"),this.router.navigate(["/central/menu/"]),this.configurando=!1})})}CrearSala(t){return Object(s.a)(this,void 0,void 0,function*(){this.configurando=!0;const e=yield this.almacenamiento.obtenerToken();e&&this.apiTickets.crearSala(e.token,t).subscribe(t=>{t.exe?(this.toast.toastExitoso("La sala se cre\xf3 correctamente"),this.salas.push(t.response)):(this.toast.toastError("No se pudo crear la sala, int\xe9ntelo m\xe1s tarde"),this.router.navigate(["/central/menu/"])),this.configurando=!1},t=>{this.toast.toastError("No se pudo crear la sala, int\xe9ntelo m\xe1s tarde"),this.router.navigate(["/central/menu/"]),this.configurando=!1})})}salon(t){t.ocupada||this.router.navigate(["/central/menu/tickets",this.id,"ticketsala",t._id])}escucharMensajes(){return new c.a(t=>{this.socket.on("mensajeTicket",e=>{t.next(e)})})}finalizar(t){return Object(s.a)(this,void 0,void 0,function*(){const e=yield this.almacenamiento.obtenerToken();e&&this.socket.emit("finalizar",{idtaller:e._id,id:t._id,ticket:t.ticket._id})})}navegar(t){return Object(s.a)(this,void 0,void 0,function*(){const e=yield this.almacenamiento.obtenerToken();e&&this.apiTickets.consultarSala(e.token,{ticket:t}).subscribe(t=>{t.exe&&t.response.length>0?t.response[0].accesos.length>0?this.almacenamiento.insertarChat(t.response[0]).then(()=>{this.router.navigate(["/central/menu/chats/chat"])}).catch(()=>{this.toast.toastError("No se puede acceder al chat, int\xe9ntelo m\xe1s tarde")}):this.toast.Especial("El ficho fue cancelado, ya no puede acceder al chat"):this.toast.toastError("No se puede acceder al chat, int\xe9ntelo m\xe1s tarde")},t=>{this.toast.toastError("No se puede acceder al chat, int\xe9ntelo m\xe1s tarde")})})}ionViewWillLeave(){this.almacenamiento.eleminarTicket().then(t=>{if(t)return!0})}}return t.\u0275fac=function(e){return new(e||t)(d.Lb(l.a),d.Lb(b.a),d.Lb(u.a),d.Lb(o.b),d.Lb(r.g),d.Lb(h.a))},t.\u0275cmp=d.Fb({type:t,selectors:[["app-inicio-tickets"]],decls:13,vars:4,consts:[["color","oscuro"],["slot","start","icon","chevron-back-outline","defaultHref","/central/menu"],["slot","fixed","pullFactor","0.5","pullMin","50","pullMax","150",3,"ionRefresh"],["pullingIcon","arrow-dropdown","refreshingSpinner","circles"],["class","flcenter ion-padding",4,"ngIf"],[4,"ngIf"],[1,"divider","light"],["class","salas",4,"ngIf"],["vertical","bottom","horizontal","end","slot","fixed",4,"ngIf"],[1,"flcenter","ion-padding"],["name","crescent","color","oscuro"],["lines","none","color","light"],["slot","end","mode","ios","color","barra",3,"checked","ionChange"],[1,"salas"],["mode","ios",3,"click",4,"ngFor","ngForOf"],["mode","ios",3,"click"],[1,"msg"],["class","botones",4,"ngIf"],[1,"botones"],["mode","ios","color","light","expand","block",3,"click"],["vertical","bottom","horizontal","end","slot","fixed"],["color","oscuro",3,"click"],["name","add"]],template:function(t,e){1&t&&(d.Ob(0,"ion-header"),d.Ob(1,"ion-toolbar",0),d.Mb(2,"ion-back-button",1),d.Ob(3,"ion-title"),d.wc(4,"Turnos"),d.Nb(),d.Nb(),d.Nb(),d.Ob(5,"ion-content"),d.Ob(6,"ion-refresher",2),d.Wb("ionRefresh",function(t){return e.refrescando(t)}),d.Mb(7,"ion-refresher-content",3),d.Nb(),d.vc(8,f,7,1,"div",4),d.vc(9,k,5,3,"ion-list",5),d.Mb(10,"div",6),d.vc(11,C,3,2,"div",7),d.vc(12,A,3,0,"ion-fab",8),d.Nb()),2&t&&(d.Ab(8),d.fc("ngIf",e.configurando),d.Ab(1),d.fc("ngIf",e.cargado),d.Ab(2),d.fc("ngIf",e.cargado),d.Ab(1),d.fc("ngIf",e.cargado))},directives:[o.z,o.lb,o.g,o.h,o.jb,o.t,o.Q,o.R,a.j,o.cb,o.L,o.F,o.kb,o.d,o.K,a.i,o.l,o.p,o.m,o.j,o.v,o.w,o.A],pipes:[p.a],styles:[".flcenter[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:center;align-items:center;font-size:18px;text-align:center}ion-card[_ngcontent-%COMP%]{position:relative}.msg[_ngcontent-%COMP%]{position:absolute;top:0;right:0;text-align:center;padding:5px 10px;border-radius:10px}ion-card-title[_ngcontent-%COMP%]{width:100%;padding:5px 15px}.ocupado[_ngcontent-%COMP%]{background-color:#ca0900!important;color:#fff}.desocupado[_ngcontent-%COMP%]{background-color:#819830!important;color:#fff}"]}),t})()}];let I=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=d.Jb({type:t}),t.\u0275inj=d.Ib({imports:[[r.j.forChild(T)],r.j]}),t})();var M=i("iTUp");let $=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=d.Jb({type:t}),t.\u0275inj=d.Ib({imports:[[a.b,n.e,o.mb,I,M.a]]}),t})()},"+WxW":function(t,e,i){"use strict";i.d(e,"a",function(){return u});var a=i("AytR"),n=i("tk/3"),o=i("coGc"),r=i("lJxs"),s=i("IzEk"),c=i("MtjB"),d=i("PqYM"),l=i("fXoL"),b=i("tyNb");let u=(()=>{class t{constructor(t,e){this.http=t,this.router=e}hanflerError(t){return t.pipe(Object(o.a)(()=>Object(d.a)(3e3)),Object(r.a)(t=>{if(console.log("Entramos a intentos"),t instanceof ErrorEvent)throw new Error("Error de Red");if(404===t.status)throw new Error(" P\xe1gina no encontrada");if(401===t.status)throw new Error(" No tiene permisos ")}),Object(s.a)(3))}disponibilidad(t){const e={headers:new n.c({"x-token":t})};return this.http.get(`${a.a}/ticket/disponibilidad`,e).pipe(Object(c.a)(t=>this.hanflerError(t)))}Creardisponibilidad(t){const e={headers:new n.c({"x-token":t})};return this.http.post(`${a.a}/ticket/disponibilidad`,{},e).pipe(Object(c.a)(t=>this.hanflerError(t)))}editardisponibilidad(t,e){const i={headers:new n.c({"x-token":t})};return this.http.put(`${a.a}/ticket/disponibilidad`,e,i).pipe(Object(c.a)(t=>this.hanflerError(t)))}crearSala(t,e){const i={headers:new n.c({"x-token":t})};return this.http.post(`${a.a}/ticket/salas`,e,i).pipe(Object(c.a)(t=>this.hanflerError(t)))}misSalas(t){const e={headers:new n.c({"x-token":t})};return this.http.get(`${a.a}/ticket/salas`,e).pipe(Object(c.a)(t=>this.hanflerError(t)))}crearTicket(t,e){const i={headers:new n.c({"x-token":t})};return this.http.post(`${a.a}/ticket/crear`,e,i).pipe(Object(c.a)(t=>this.hanflerError(t)))}misTickets(t){const e={headers:new n.c({"x-token":t})};return this.http.get(`${a.a}/ticket/lista`,e).pipe(Object(c.a)(t=>this.hanflerError(t)))}misTicketsLista(t,e){const i={headers:new n.c({"x-token":t})};return this.http.put(`${a.a}/ticket/lista/negocio`,e,i).pipe(Object(c.a)(t=>this.hanflerError(t)))}salasNegocio(t,e){const i={headers:new n.c({"x-token":t})};return this.http.put(`${a.a}/ticket/salas/usuario`,e,i).pipe(Object(c.a)(t=>this.hanflerError(t)))}disponibilidadnegocio(t,e){const i={headers:new n.c({"x-token":t})};return this.http.put(`${a.a}/ticket/disponibilidad/negocio`,e,i).pipe(Object(c.a)(t=>this.hanflerError(t)))}ticketsolo(t,e){const i={headers:new n.c({"x-token":t})};return this.http.put(`${a.a}/ticket/solo`,e,i).pipe(Object(c.a)(t=>this.hanflerError(t)))}ticketelimina(t,e){const i={headers:new n.c({"x-token":t})};return this.http.put(`${a.a}/ticket/eliminar`,e,i).pipe(Object(c.a)(t=>this.hanflerError(t)))}crearHoja(t,e){const i={headers:new n.c({"x-token":t})};return this.http.post(`${a.a}/hoja/dos`,e,i).pipe(Object(c.a)(t=>this.hanflerError(t)))}consultarSala(t,e){const i={headers:new n.c({"x-token":t})};return this.http.post(`${a.a}/ticket/consultar/chat`,e,i).pipe(Object(c.a)(t=>this.hanflerError(t)))}}return t.\u0275fac=function(e){return new(e||t)(l.Sb(n.a),l.Sb(b.g))},t.\u0275prov=l.Hb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})()}}]);