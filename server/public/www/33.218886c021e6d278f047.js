(window.webpackJsonp=window.webpackJsonp||[]).push([[33,147],{WGaO:function(t,e,i){"use strict";i.d(e,"a",function(){return g});var o=i("AytR"),n=i("tk/3"),r=i("coGc"),a=i("lJxs"),s=i("IzEk"),c=i("MtjB"),p=i("JIr8"),l=i("PqYM"),d=i("Cfvw"),h=i("fXoL"),u=i("B7Rs");let g=(()=>{class t{constructor(t,e){this.http=t,this.MmyTransfer=e}hanflerError(t){return t.pipe(Object(r.a)(()=>Object(l.a)(3e3)),Object(a.a)(t=>{if(console.log("Entramos a intentos"),t instanceof ErrorEvent)throw new Error("Error de Red");if(404===t.status)throw new Error(" P\xe1gina no encontrada")}),Object(s.a)(3))}BuscarUsuarios(t,e){const i={headers:new n.c({"x-token":t})};return this.http.put(`${o.a}/empleados/buscar/`,{patron:e},i).pipe(Object(c.a)(t=>this.hanflerError(t)))}crearPublicacion(t,e){const i={headers:new n.c({"x-token":t})};return this.http.post(`${o.a}/igtm/crear/`,e,i).pipe(Object(c.a)(t=>this.hanflerError(t)))}crearPublicacionGrupo(t,e){const i={headers:new n.c({"x-token":t})};return this.http.post(`${o.a}/igtm/crear/grupo`,e,i).pipe(Object(c.a)(t=>this.hanflerError(t)))}leerPublicacion(t,e){const i={headers:new n.c({"x-token":t})};return this.http.put(`${o.a}/igtm/leer/`,e,i).pipe(Object(c.a)(t=>this.hanflerError(t)))}leerPublicacionUsuario(t,e){const i={headers:new n.c({"x-token":t})};return this.http.put(`${o.a}/igtm/leer/usuario`,e,i).pipe(Object(c.a)(t=>this.hanflerError(t)))}subirArchivosChat(t,e,i,n,r,a,s,c){console.log("archivo",i);const l={fileKey:"archivo",fileName:s,mimeType:c,httpMethod:"POST",headers:{"x-token":t,"x-idpublicacion":e,"x-final":n,"x-cont":r,"x-historia":a}},h=this.MmyTransfer.create();return Object(d.a)(h.upload(i,`${o.a}/igtm/upload`,l)).pipe(Object(p.a)(t=>{throw console.log("No se pudo subir la imagen ",t),new Error("No se pudo subir la imagen ")}))}subirweb(t,e,i,r,a,s){console.log(t,e,i,r,a);const p={headers:new n.c({"x-final":i.toString(),"x-cont":r.toString(),"x-historia":a.toString(),"x-token":t,"x-idpublicacion":e})};return this.http.post(`${o.a}/igtm/upload`,s,p).pipe(Object(c.a)(t=>this.hanflerError(t)))}leerFotos(t,e){const i={headers:new n.c({"x-token":t})};return this.http.put(`${o.a}/igtm/fotos/leer/`,e,i).pipe(Object(c.a)(t=>this.hanflerError(t)))}vistos(t,e){const i={headers:new n.c({"x-token":t})};return this.http.post(`${o.a}/igtm/historias/vistos/`,e,i).pipe(Object(c.a)(t=>this.hanflerError(t)))}eliminar(t,e){const i={headers:new n.c({"x-token":t})};return this.http.put(`${o.a}/igtm/eliminar/`,e,i).pipe(Object(c.a)(t=>this.hanflerError(t)))}eliminarHistoria(t,e){const i={headers:new n.c({"x-token":t})};return this.http.put(`${o.a}/igtm/historia/eliminar/`,e,i).pipe(Object(c.a)(t=>this.hanflerError(t)))}meGusta(t,e){const i={headers:new n.c({"x-token":t})};return this.http.put(`${o.a}/igtm/megusta/`,e,i).pipe(Object(c.a)(t=>this.hanflerError(t)))}saber(t,e){const i={headers:new n.c({"x-token":t})};return this.http.put(`${o.a}/igtm/publicacion/seguidos/`,e,i).pipe(Object(c.a)(t=>this.hanflerError(t)))}saberHistorias(t,e){const i={headers:new n.c({"x-token":t})};return this.http.put(`${o.a}/igtm/historias/seguidos/`,e,i).pipe(Object(c.a)(t=>this.hanflerError(t)))}leerUna(t,e){const i={headers:new n.c({"x-token":t})};return this.http.put(`${o.a}/igtm/leer/uno/`,e,i).pipe(Object(c.a)(t=>this.hanflerError(t)))}leerUna2(t,e){const i={headers:new n.c({"x-token":t})};return this.http.put(`${o.a}/igtm/leer/uno/historia`,e,i).pipe(Object(c.a)(t=>this.hanflerError(t)))}crearComentario(t,e){const i={headers:new n.c({"x-token":t})};return this.http.post(`${o.a}/igtm/comentarios/`,e,i).pipe(Object(c.a)(t=>this.hanflerError(t)))}crearCompartida(t,e){const i={headers:new n.c({"x-token":t})};return this.http.post(`${o.a}/igtm/compartir/`,e,i).pipe(Object(c.a)(t=>this.hanflerError(t)))}crearGuardado(t,e){const i={headers:new n.c({"x-token":t})};return this.http.post(`${o.a}/igtm/guardado/`,e,i).pipe(Object(c.a)(t=>this.hanflerError(t)))}eliminarComentario(t,e){const i={headers:new n.c({"x-token":t})};return this.http.post(`${o.a}/igtm/comentarios/eliminar`,e,i).pipe(Object(c.a)(t=>this.hanflerError(t)))}}return t.\u0275fac=function(e){return new(e||t)(h.Qb(n.a),h.Qb(u.a))},t.\u0275prov=h.Fb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})()},nUQ8:function(t,e,i){"use strict";i.r(e),i.d(e,"InterfazGrupoInicioPageModule",function(){return D});var o=i("ofXK"),n=i("3Pt+"),r=i("TEn/"),a=i("tyNb"),s=i("mrSG"),c=i("fXoL"),p=i("fsfq"),l=i("oQG1"),d=i("fmoy"),h=i("vLoH"),u=i("a/9d"),g=i("r3ab"),b=i("Gq8O"),f=i("7JkF"),m=i("WGaO"),v=i("FlrC"),x=i("IlVf");const O=["inifinito"],M=["miSlide"],w=["miContenido"],k=["fileUpload"];function j(t,e){if(1&t&&(c.Mb(0,"ion-title"),c.rc(1),c.Lb()),2&t){const t=c.Wb();c.zb(1),c.sc(t.grupo.nombre)}}function _(t,e){if(1&t){const t=c.Nb();c.Mb(0,"ion-avatar",24),c.Ub("click",function(){return c.lc(t),c.Wb(2).herramientas()}),c.Kb(1,"img",25),c.Lb()}if(2&t){const t=c.Wb(2);c.zb(1),c.fc("src","https://motocaliapp.com/",t.grupo.usuario.imagen[0].path,"",c.mc)}}function P(t,e){if(1&t){const t=c.Nb();c.Mb(0,"ion-avatar",24),c.Ub("click",function(){return c.lc(t),c.Wb(2).herramientas()}),c.Lb()}}function C(t,e){if(1&t){const t=c.Nb();c.Mb(0,"ion-button",26),c.Ub("click",function(){return c.lc(t),c.Wb(2).seguimiento()}),c.rc(1,"Solcitar Unirse"),c.Lb()}}function E(t,e){if(1&t){const t=c.Nb();c.Mb(0,"ion-button",27),c.Ub("click",function(){return c.lc(t),c.Wb(2).seguimiento()}),c.rc(1,"Cancelar solicitud"),c.Lb()}}function I(t,e){if(1&t){const t=c.Nb();c.Mb(0,"ion-button",28),c.Ub("click",function(){return c.lc(t),c.Wb(2).eliminar()}),c.rc(1,"Salir del grupo"),c.Lb()}}function y(t,e){1&t&&(c.Mb(0,"ion-button",29),c.rc(1,"Mi grupo"),c.Lb())}function z(t,e){1&t&&c.Kb(0,"div",30),2&t&&c.pc("background",e.$implicit)}function $(t,e){if(1&t&&(c.Mb(0,"ion-card",14),c.Mb(1,"div",15),c.qc(2,_,2,1,"ion-avatar",16),c.qc(3,P,1,0,"ion-avatar",16),c.qc(4,C,2,0,"ion-button",17),c.qc(5,E,2,0,"ion-button",18),c.qc(6,I,2,0,"ion-button",19),c.qc(7,y,2,0,"ion-button",20),c.Lb(),c.Mb(8,"div",21),c.Mb(9,"div",22),c.qc(10,z,1,2,"div",23),c.Lb(),c.Mb(11,"div"),c.rc(12),c.Lb(),c.Mb(13,"div"),c.rc(14),c.Xb(15,"year"),c.Lb(),c.Mb(16,"div"),c.Mb(17,"strong"),c.rc(18),c.Lb(),c.Lb(),c.Lb(),c.Lb()),2&t){const t=c.Wb();c.zb(2),c.dc("ngIf",t.grupo.usuario.imagen.length>0&&"notfound.png"!==t.grupo.usuario.imagen[0].path),c.zb(1),c.dc("ngIf","notfound.png"===t.grupo.usuario.imagen[0].path),c.zb(1),c.dc("ngIf",t.grupo.creador!==t.id&&!t.solicitudEnviada),c.zb(1),c.dc("ngIf",t.grupo.creador!==t.id&&t.solicitudEnviada&&!t.eliminada),c.zb(1),c.dc("ngIf",t.grupo.creador!==t.id&&t.solicitudEnviada&&t.eliminada),c.zb(1),c.dc("ngIf",t.grupo.creador===t.id),c.zb(3),c.dc("ngForOf",t.grupo.bandera),c.zb(2),c.uc("",t.grupo.ciudad,", ",t.grupo.pais,""),c.zb(2),c.tc("Inici\xf3 en ",c.Yb(15,11,t.grupo.fecha),""),c.zb(4),c.tc("Grupo de ",t.grupo.tipo,"")}}function L(t,e){if(1&t&&(c.Mb(0,"ion-card",31),c.Mb(1,"ion-avatar"),c.Kb(2,"img",32),c.Lb(),c.Mb(3,"ion-card-title"),c.rc(4),c.Lb(),c.Lb()),2&t){const t=c.Wb();c.zb(4),c.tc("",t.grupo.kilometros," Km")}}function S(t,e){if(1&t&&(c.Mb(0,"ion-card",31),c.Mb(1,"ion-avatar"),c.Kb(2,"img",33),c.Lb(),c.Mb(3,"ion-card-title"),c.rc(4),c.Lb(),c.Lb()),2&t){const t=c.Wb();c.zb(4),c.tc("",t.grupo.integrantes.length," Miembros")}}function T(t,e){if(1&t&&(c.Mb(0,"ion-card",34),c.Mb(1,"ion-card-title",35),c.rc(2),c.Lb(),c.Mb(3,"div",36),c.Kb(4,"img",37),c.Mb(5,"div",38),c.Mb(6,"div"),c.Mb(7,"strong",39),c.rc(8,"Oro"),c.Lb(),c.Lb(),c.Mb(9,"div"),c.rc(10),c.Lb(),c.Lb(),c.Lb(),c.Mb(11,"div",40),c.Kb(12,"img",41),c.Mb(13,"div",38),c.Mb(14,"div"),c.Mb(15,"strong",42),c.rc(16,"Plata"),c.Lb(),c.Lb(),c.Mb(17,"div"),c.rc(18),c.Lb(),c.Lb(),c.Lb(),c.Mb(19,"div",43),c.Kb(20,"img",44),c.Mb(21,"div",38),c.Mb(22,"div"),c.Mb(23,"strong",45),c.rc(24,"Bronce"),c.Lb(),c.Lb(),c.Mb(25,"div"),c.rc(26),c.Lb(),c.Lb(),c.Lb(),c.Lb()),2&t){const t=c.Wb();c.zb(2),c.tc("",t.grupo.premios.length," Premios"),c.zb(8),c.tc("",t.oro," copas ganadas, primer puesto "),c.zb(8),c.tc("",t.plata," , segundo puesto "),c.zb(8),c.tc("",t.bronce," copas, tercer puesto ")}}function G(t,e){if(1&t&&(c.Mb(0,"div",51),c.Kb(1,"div",52),c.Lb()),2&t){const t=c.Wb().$implicit;c.zb(1),c.pc("background",t.dibujo.fondo)("color",t.dibujo.color)}}function A(t,e){if(1&t&&c.Kb(0,"img",58),2&t){const t=c.Wb().$implicit;c.fc("src","https://motocaliapp.com/11927613401/",t.ruta,"",c.mc)}}function U(t,e){if(1&t&&(c.Mb(0,"ion-slide",56),c.qc(1,A,1,1,"img",57),c.Lb()),2&t){const t=e.$implicit;c.zb(1),c.dc("ngIf",t.mime.includes("image"))}}function q(t,e){if(1&t&&(c.Mb(0,"ion-slides",54),c.qc(1,U,2,1,"ion-slide",55),c.Lb()),2&t){const t=c.Wb(2).$implicit;c.dc("pager",t.pager),c.zb(1),c.dc("ngForOf",t.archivos)}}function F(t,e){if(1&t&&(c.Mb(0,"div",51),c.qc(1,q,2,2,"ion-slides",53),c.Lb()),2&t){const t=c.Wb(3);c.zb(1),c.dc("ngIf",t.cargadentro)}}function N(t,e){if(1&t){const t=c.Nb();c.Mb(0,"div",48),c.Ub("click",function(){c.lc(t);const i=e.index;return c.Wb(2).abrir(i)}),c.qc(1,G,2,4,"div",49),c.qc(2,F,2,1,"div",50),c.Lb()}if(2&t){const t=e.$implicit;c.zb(1),c.dc("ngIf","dibujar"===t.tipo),c.zb(1),c.dc("ngIf","multimedia"===t.tipo)}}function W(t,e){if(1&t&&(c.Mb(0,"div",46),c.qc(1,N,3,2,"div",47),c.Lb()),2&t){const t=c.Wb();c.zb(1),c.dc("ngForOf",t.publicaciones)}}function J(t,e){if(1&t){const t=c.Nb();c.Mb(0,"ion-infinite-scroll",59,60),c.Ub("ionInfinite",function(e){return c.lc(t),c.Wb().loadData(e)}),c.Kb(2,"ion-infinite-scroll-content",61),c.Lb()}}function K(t,e){if(1&t){const t=c.Nb();c.Mb(0,"ion-fab",62),c.Mb(1,"ion-fab-button",63),c.Ub("click",function(){return c.lc(t),c.Wb().creando()}),c.Kb(2,"ion-icon",64),c.Lb(),c.Lb()}}const R=[{path:"",component:(()=>{class t{constructor(t,e,i,o,n,r,a,s,c,p,l,d,h,u){this.almacenamiento=t,this.apiUsuario=e,this.toast=i,this.apiGrupos=o,this.router=n,this.active=r,this.actionCtrl=a,this.camera=s,this.loadingService=c,this.seguimientoService=p,this.socket=l,this.alert=d,this.IGTMApi=h,this.entrada=u,this.cargado=!1,this.solicitudEnviada=!1,this.estado="Seguir Cuenta",this.estadoSolicitud=!1,this.cargarInformacion=!1,this.eliminada=!1,this.cargarBoton=!1,this.titulo2="",this.publicaciones=[],this.click=!1,this.cargadentro=!1,this.over=!1,this.atrasBoton=!1,this.cargaTodo=!1,this.eliminado=!1,this.cargainfinite=!0,this.desde=0,this.vehiculos=[],this.datos={pais:"",ciudad:"",placa:""},this.oro=0,this.plata=0,this.bronce=0}ngOnInit(){}ionViewWillEnter(){this.listar()}refrescando(t){this.solicitudEnviada=!1,this.eliminada=!1,this.cargado=!1,this.listar().then(()=>{t.target.complete()}).catch(()=>{t.target.complete()})}listar(){return Object(s.a)(this,void 0,void 0,function*(){const t=yield this.almacenamiento.obtenerToken();t&&(this.id=t._id,this.apiGrupos.info(t.token,{id:this.active.snapshot.paramMap.get("grupo")}).subscribe(t=>{console.log(t),t.exe?(this.grupo=t.response[0],this.oro=this.grupo.premios.filter(t=>"oro"===t.tipo).length,this.plata=this.grupo.premios.filter(t=>"plata"===t.tipo).length,this.bronce=this.grupo.premios.filter(t=>"bronce"===t.tipo).length,this.cargarSolicitud(this.grupo.usuario._id),this.publicacion(),console.log(t)):this.toast.toastError("No se pudo consultar la informaci\xf3n, int\xe9ntelo m\xe1s tarde"),this.cargado=!0},t=>{this.toast.toastError("No se pudo consultar la informaci\xf3n, int\xe9ntelo m\xe1s tarde"),this.cargado=!0}))})}crear(){this.router.navigate(["/interactivo/grupos/crear"])}cargarSolicitud(t){this.almacenamiento.obtenerToken().then(e=>{this.seguimientoService.consultarSolicitud(e.token,t).subscribe(t=>{t.response.length>0?"pendiente"===t.response[0].estado?(this.cargarBoton=!0,this.solicitudEnviada=!0,this.eliminada=!1,this.cargarInformacion=!1,this.estado="Cancelar Solicitud"):"aceptado"===t.response[0].estado&&(this.cargarInformacion=!0,this.titulo2="Dejar de seguir",this.eliminada=!0,this.solicitudEnviada=!0):(this.cargarInformacion=!1,this.cargarBoton=!0)},t=>{this.toast.alertApplication("No se pudo realizar la petici\xf3n",!1)})}).catch(t=>{this.toast.alertApplication(t,!1)})}seguimiento(){this.solicitudEnviada?this.almacenamiento.obtenerToken().then(t=>{this.seguimientoService.cancelarSolicitud(t.token,this.grupo.usuario._id,"1").subscribe(t=>{t.exe&&(this.solicitudEnviada=!1)},t=>{this.toast.alertApplication(t.message,!1)})}).catch(t=>{this.toast.alertApplication(t,!1)}):this.almacenamiento.obtenerToken().then(t=>{this.estadoSolicitud=!0,this.seguimientoService.enviarSolicitud({token:t.token,IDreceptor:this.grupo.usuario._id,nombre:t.nombre,grupocreador:this.grupo.creador,grupo:!0,gp:this.grupo._id,usuario:this.grupo.usuario.nombrecompleto,dp:this.grupo.usuario.usuarioID}).subscribe(e=>{this.socket.emit("solicitudesgrupo",{usuario:this.IDreceptor,nombre:t.nombre,grupo:this.grupo._id}),this.estadoSolicitud=!1,this.solicitudEnviada=!0,this.estado="Cancelar Solicitud"},t=>{this.estadoSolicitud=!1,this.toast.alertApplication(t.message,!1)})})}eliminar(){return Object(s.a)(this,void 0,void 0,function*(){const t=yield this.alert.create({header:"Atenci\xf3n!",message:"\xbfQuieres salir del grupo?",buttons:[{text:"Cancelar",role:"cancel",cssClass:"cancelarAlerta"},{text:"Si, salir",cssClass:"botonalerta",handler:()=>{this.almacenamiento.obtenerToken().then(t=>{this.seguimientoService.cancelarSolicitudGrupo(t.token,this.grupo.usuario._id,"1",{grupo:this.grupo._id}).subscribe(t=>{t.exe&&(this.solicitudEnviada=!1)},t=>{this.toast.alertApplication(t.message,!1)})}).catch(t=>{this.toast.alertApplication(t,!1)})}}]});yield t.present()})}herramientas(){return Object(s.a)(this,void 0,void 0,function*(){const t=yield this.actionCtrl.create({translucent:!0,header:"Fotos",buttons:[{text:"Seleccionar Foto de Perfil",icon:"image",handler:()=>{this.tomarFoto(this.camera.PictureSourceType.PHOTOLIBRARY,"perfil")}},{text:"Seleccionar Foto de Perfil",icon:"image",handler:()=>Object(s.a)(this,void 0,void 0,function*(){const t=yield this.almacenamiento.obtenerToken();if(t){console.log(t);const e=this.fileUpload.nativeElement;e.onchange=i=>{for(let o=0;o<e.files.length;o++){const i=e.files[o],n=new FormData;n.append("archivo",i),this.loadingService.cargaProcesos("Actualizando foto de perf\xedl..."),this.apiGrupos.subirweb(t.token,n,this.grupo.usuario._id).subscribe(t=>Object(s.a)(this,void 0,void 0,function*(){this.grupo.usuario=t.response,this.loadingService.finalizarCargado(),yield this.toast.toastExitoso("Foto de perf\xedl actualizada")}),t=>Object(s.a)(this,void 0,void 0,function*(){this.loadingService.finalizarCargado(),yield this.toast.alertApplication(t.message,!1)}))}},e.click()}})},{text:"Cancelar",role:"cancel",icon:"close",cssClass:"rojo"}]});return yield t.present()})}tomarFoto(t,e){this.camera.getPicture({quality:100,targetWidth:900,targetHeight:600,correctOrientation:!0,destinationType:this.camera.DestinationType.FILE_URI,encodingType:0,mediaType:this.camera.MediaType.PICTURE,sourceType:t}).then(t=>Object(s.a)(this,void 0,void 0,function*(){yield this.loadingService.cargaProcesos("Subiendo Imagen, por favor espera."),this.almacenamiento.obtenerToken().then(i=>{"perfil"===e&&this.apiGrupos.fotoPerfilUsuarioMoto(i.token,t,"perfil",this.grupo.usuario._id).subscribe(t=>Object(s.a)(this,void 0,void 0,function*(){this.loadingService.finalizarCargado(),yield this.toast.alertApplication("Imagen subida con \xe9xito",!0)}),t=>Object(s.a)(this,void 0,void 0,function*(){this.loadingService.finalizarCargado(),yield this.toast.alertApplication(t.message,!1)}))}).catch(()=>{this.loadingService.finalizarCargado()})}),t=>{})}creando(){this.router.navigate(["/interfaz-grupo",this.grupo._id,"inicio",this.grupo._id,"creador","publicacion","gp",this.grupo.usuario._id])}abrir(t){return Object(s.a)(this,void 0,void 0,function*(){this.entrada.publi({publicaciones:this.publicaciones,visita:!0,i:t,receptor:this.grupo.usuario._id,desde:this.desde}),this.router.navigate(["/interfaz-grupo",this.grupo._id,"inicio",this.grupo._id,"pub"])})}loadData(t){return Object(s.a)(this,void 0,void 0,function*(){this.desde=this.desde+9;const e=yield this.almacenamiento.obtenerToken();e&&this.IGTMApi.leerPublicacionUsuario(e.token,{_id:this.grupo.usuario._id,desde:this.desde}).subscribe(i=>{i.exe?i.response.length>0?(t.target.complete(),i.response.forEach((t,i)=>Object(s.a)(this,void 0,void 0,function*(){t.eliminar=t.creador._id===e._id,t.guardado=!1,t.image=t.creador.imagen.length>0?`https://motocaliapp.com/${t.creador.imagen[0].path}`:"/assets/notfound.png",t.creadororiginal?(t.cog=!0,t.imageori=t.creadororiginal.imagen.length>0?`https://motocaliapp.com/${t.creadororiginal.imagen[0].path}`:"/assets/notfound.png"):t.cog=!1,yield new Promise((i,o)=>{this.IGTMApi.leerFotos(e.token,{id:t._id,historia:"false"}).subscribe(e=>{e.exe?(t.archivos=e.response,e.response.length>1?(t.pager=!0,i({exe:!0})):(i({exe:!1}),t.pager=!1)):(i({exe:!0}),t.archivos=[]),this.cargadentro=!0},e=>{i({exe:!1}),t.archivos=[]})}),yield new Promise((i,o)=>{this.IGTMApi.crearGuardado(e.token,{publicacion:t._id,tipo:"leer"}).subscribe(e=>{t.guardado=!!e.exe,i(!0)},e=>{i(!0),t.guardado=!1})}),yield new Promise((i,o)=>{this.IGTMApi.meGusta(e.token,{id:t._id,tipo:"leer"}).subscribe(o=>{t.megusta=!!o.response.find(t=>t.creador._id===e._id),t.valormg=o.response.length,t.mglista=o.response,i(!0)},e=>{i(!0),t.megusta=!1,t.valormg=""})}),yield new Promise((i,o)=>{this.IGTMApi.crearComentario(e.token,{_id:t._id,tipo:"leer"}).subscribe(e=>{e.exe?(t.comentarios=e.response,t.msg=e.response.length>0?`${t.comentarios.length} comentarios...`:"No hay ning\xfan comentario paraesta publicaci\xf3n"):t.comentarios=[],i(!0),this.cargadentro=!0},e=>{i(!0),t.comentarios=[]})}),this.publicaciones.push(t)}))):(t.target.disabled=!0,this.desde=0):this.toast.alertApplication("No se pudo traer las publicaciones, intentelo m\xe1s tarde",!1)},t=>{this.toast.alertApplication("No se pudo traer las publicaciones, intentelo m\xe1s tarde",!1)})})}publicacion(){return Object(s.a)(this,void 0,void 0,function*(){const t=yield this.almacenamiento.obtenerToken();t&&this.IGTMApi.leerPublicacionUsuario(t.token,{_id:this.grupo.usuario._id,desde:this.desde}).subscribe(e=>{e.exe&&(e.response.forEach((e,i)=>Object(s.a)(this,void 0,void 0,function*(){e.eliminar=e.creador._id===t._id,e.guardado=!1,e.image=e.creador.imagen.length>0?`https://motocaliapp.com/${e.creador.imagen[0].path}`:"/assets/notfound.png",e.creadororiginal?(e.cog=!0,e.imageori=e.creadororiginal.imagen.length>0?`https://motocaliapp.com/${e.creadororiginal.imagen[0].path}`:"/assets/notfound.png"):e.cog=!1,yield new Promise((i,o)=>{this.IGTMApi.leerFotos(t.token,{id:e._id}).subscribe(t=>{t.exe?(e.archivos=t.response,t.response.length>1?(e.pager=!0,i({exe:!0})):(i({exe:!1}),e.pager=!1)):(i({exe:!0}),e.archivos=[]),this.cargadentro=!0},t=>{i({exe:!1}),e.archivos=[]})}),yield new Promise((i,o)=>{this.IGTMApi.crearGuardado(t.token,{publicacion:e._id,tipo:"leer"}).subscribe(t=>{e.guardado=!!t.exe,i(!0)},t=>{i(!0),e.guardado=!1})}),yield new Promise((i,o)=>{this.IGTMApi.meGusta(t.token,{id:e._id,tipo:"leer"}).subscribe(o=>{e.megusta=!!o.response.find(e=>e.creador===t._id),e.valormg=o.response.length,e.mglista=o.response,i(!0)},t=>{i(!0),e.megusta=!1,e.valormg=""})}),yield new Promise((i,o)=>{this.IGTMApi.crearComentario(t.token,{_id:e._id,tipo:"leer"}).subscribe(t=>{t.exe?(e.comentarios=t.response,e.msg=t.response.length>0?`${e.comentarios.length} comentarios...`:"No hay ning\xfan comentario paraesta publicaci\xf3n"):e.comentarios=[],i(!0),this.cargadentro=!0},t=>{i(!0),e.comentarios=[]})})})),this.publicaciones=e.response),this.cargaTodo=!0,this.infinite.disabled=!1},t=>{})})}}return t.\u0275fac=function(e){return new(e||t)(c.Jb(p.a),c.Jb(l.a),c.Jb(d.a),c.Jb(h.a),c.Jb(a.g),c.Jb(a.a),c.Jb(r.a),c.Jb(u.a),c.Jb(g.a),c.Jb(b.a),c.Jb(f.a),c.Jb(r.b),c.Jb(m.a),c.Jb(v.a))},t.\u0275cmp=c.Db({type:t,selectors:[["app-interfaz-grupo-inicio"]],viewQuery:function(t,e){if(1&t&&(c.vc(O,1),c.vc(M,1),c.vc(w,1),c.vc(k,1)),2&t){let t;c.kc(t=c.Vb())&&(e.infinite=t.first),c.kc(t=c.Vb())&&(e.miSlide=t.first),c.kc(t=c.Vb())&&(e.miContenido=t.first),c.kc(t=c.Vb())&&(e.fileUpload=t.first)}},decls:18,vars:8,consts:[["color","oscuro"],[4,"ngIf"],["slot","fixed","pullFactor","0.5","pullMin","50","pullMax","150",3,"ionRefresh"],["pullingIcon","arrow-dropdown","refreshingSpinner","circles"],["type","file","id","fileUpload","name","archivo","accept","image/*",2,"display","none"],["fileUpload",""],["mode","ios","class","tarjeta info",4,"ngIf"],[1,"divider","light"],["class","tar","mode","ios",4,"ngIf"],["mode","ios",4,"ngIf"],[1,"divider"],["class","publicaciones",4,"ngIf"],["threshold","100px",3,"ionInfinite",4,"ngIf"],["vertical","bottom","horizontal","end","slot","fixed",4,"ngIf"],["mode","ios",1,"tarjeta","info"],[1,"foto"],["class","avatar","slot","start",3,"click",4,"ngIf"],["mode","ios","color","oscuro",3,"click",4,"ngIf"],["mode","ios","color","warning",3,"click",4,"ngIf"],["mode","ios","color","danger",3,"click",4,"ngIf"],["mode","ios","color","success",4,"ngIf"],[1,"mas"],[1,"bandera"],["class","color",3,"background",4,"ngFor","ngForOf"],["slot","start",1,"avatar",3,"click"],[3,"src"],["mode","ios","color","oscuro",3,"click"],["mode","ios","color","warning",3,"click"],["mode","ios","color","danger",3,"click"],["mode","ios","color","success"],[1,"color"],["mode","ios",1,"tar"],["src","/assets/km.png","width","30px","alt",""],["src","/assets/Miembros.png","width","30px","alt",""],["mode","ios"],[1,"tit"],[1,"oro"],["src","/assets/Campeon.png","width","20px","alt",""],[1,"info"],[1,"or"],[1,"plata"],["src","/assets/Plata.png","width","20px","alt",""],[1,"pl"],[1,"bronce"],["src","/assets/Bronce.png","width","20px","alt",""],[1,"bc"],[1,"publicaciones"],["class","pb",3,"click",4,"ngFor","ngForOf"],[1,"pb",3,"click"],["class","publicacion ",4,"ngIf"],["class","publicacion",4,"ngIf"],[1,"publicacion"],[1,"lienzo"],["color","dark","mode","ios",3,"pager",4,"ngIf"],["color","dark","mode","ios",3,"pager"],["class","diapo",4,"ngFor","ngForOf"],[1,"diapo"],["width","100%",3,"src",4,"ngIf"],["width","100%",3,"src"],["threshold","100px",3,"ionInfinite"],["inifinito",""],["loadingSpinner","bubbles","loadingText","Cargando publicaciones..."],["vertical","bottom","horizontal","end","slot","fixed"],["color","masoscuro",3,"click"],["name","add-outline"]],template:function(t,e){1&t&&(c.Mb(0,"ion-header"),c.Mb(1,"ion-toolbar",0),c.qc(2,j,2,1,"ion-title",1),c.Lb(),c.Lb(),c.Mb(3,"ion-content"),c.Mb(4,"ion-refresher",2),c.Ub("ionRefresh",function(t){return e.refrescando(t)}),c.Kb(5,"ion-refresher-content",3),c.Lb(),c.Kb(6,"input",4,5),c.qc(8,$,19,13,"ion-card",6),c.Kb(9,"div",7),c.qc(10,L,5,1,"ion-card",8),c.qc(11,S,5,1,"ion-card",8),c.qc(12,T,27,4,"ion-card",9),c.Kb(13,"div",7),c.Kb(14,"div",10),c.qc(15,W,2,1,"div",11),c.qc(16,J,3,0,"ion-infinite-scroll",12),c.qc(17,K,3,0,"ion-fab",13),c.Lb()),2&t&&(c.zb(2),c.dc("ngIf",e.grupo),c.zb(6),c.dc("ngIf",e.grupo&&e.cargado),c.zb(2),c.dc("ngIf",e.grupo),c.zb(1),c.dc("ngIf",e.grupo),c.zb(1),c.dc("ngIf",e.grupo),c.zb(3),c.dc("ngIf",e.cargaTodo),c.zb(1),c.dc("ngIf",e.cargainfinite),c.zb(1),c.dc("ngIf",e.cargado&&e.id===e.grupo.creador))},directives:[r.z,r.kb,o.j,r.t,r.Q,r.R,r.ib,r.l,o.i,r.f,r.j,r.p,r.bb,r.ab,r.C,r.D,r.v,r.w,r.A],pipes:[x.a],styles:[".tarjeta[_ngcontent-%COMP%]{border-radius:0;width:100%;margin:0}.tarje[_ngcontent-%COMP%]{margin:10px 0 auto}.tarjeta[_ngcontent-%COMP%]   ion-card-content[_ngcontent-%COMP%]{padding:0}.info[_ngcontent-%COMP%]{align-items:center;justify-content:space-between}.info[_ngcontent-%COMP%], .mas[_ngcontent-%COMP%]{display:flex}.mas[_ngcontent-%COMP%]{padding:5px 15px;text-align:right;align-items:flex-end;flex-direction:column}.bandera[_ngcontent-%COMP%]{width:45px;height:45px;border-radius:100%;overflow:hidden;border:2px solid #333}.color[_ngcontent-%COMP%]{height:15px;width:100%}ion-button[_ngcontent-%COMP%]{padding:10px;margin:1px 0}.km[_ngcontent-%COMP%]{color:var(--ion-color-masoscuro)}.tar[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;border-bottom:5px solid var(--ion-color-masoscuro);padding:10px}.avatar[_ngcontent-%COMP%]{margin:10px;width:100px!important;height:100px!important;background-color:#006c78;z-index:11}.ct[_ngcontent-%COMP%]{text-align:center}.publicaciones[_ngcontent-%COMP%]{width:100%;display:flex;flex-wrap:wrap}.pb[_ngcontent-%COMP%]{width:calc(33.33% - 3px);height:100px;margin:1.5px;background:#fff}.publicacion[_ngcontent-%COMP%]{height:100%;overflow:hidden}.publicacion[_ngcontent-%COMP%]   ion-slide[_ngcontent-%COMP%], .publicacion[_ngcontent-%COMP%]   ion-slides[_ngcontent-%COMP%]{width:100%;height:100%}.publicacion[_ngcontent-%COMP%]   ion-slide[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;min-height:100%}.lienzo[_ngcontent-%COMP%]{height:100%;padding:10px;display:flex;text-align:center;justify-content:center;align-items:center;white-space:pre-wrap;font-size:5px}.lienzo[_ngcontent-%COMP%], .opciones[_ngcontent-%COMP%]{width:100%}.comentarios[_ngcontent-%COMP%]{text-align:left;padding:10px 10px 10px 15px;font-weight:300;line-height:1.6;font-size:16px}.gris[_ngcontent-%COMP%]{color:#333}.espacio[_ngcontent-%COMP%]{padding-right:10px}.diapo[_ngcontent-%COMP%]   video[_ngcontent-%COMP%]{max-width:100%;max-height:100%}.diapo[_ngcontent-%COMP%]   .btonDiapo[_ngcontent-%COMP%]{margin:auto 5%;width:90%;position:absolute;bottom:10px;left:0;z-index:10}.etiquetas[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{width:100px;border-radius:3px;text-align:center;background-color:#f1f1f1;color:#333}.comentar[_ngcontent-%COMP%]{color:#777;padding:5px 15px;font-size:14px;text-align:left}.opt[_ngcontent-%COMP%]{opacity:.5}.av[_ngcontent-%COMP%]{width:30px;height:70px}.barra[_ngcontent-%COMP%]{position:absolute;width:130px;height:40px;right:0;bottom:-25px;color:#fff;font-weight:700;display:flex;justify-content:center;align-items:center;text-align:center}.ama[_ngcontent-%COMP%]{background-color:#2c8f53}.ama[_ngcontent-%COMP%], .rj[_ngcontent-%COMP%]{color:#fff}.rj[_ngcontent-%COMP%]{background-color:#ca0900}.tit[_ngcontent-%COMP%]{width:100%;padding:10px;text-align:center;background:#e2f4f6}.bronce[_ngcontent-%COMP%], .oro[_ngcontent-%COMP%], .plata[_ngcontent-%COMP%]{width:100%;padding:10px 15px;display:flex;color:#333;font-size:14px;font-weight:700;text-align:left}.bronce[_ngcontent-%COMP%]   img[_ngcontent-%COMP%], .oro[_ngcontent-%COMP%]   img[_ngcontent-%COMP%], .plata[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{margin-right:20px}.bronce[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%], .oro[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%], .plata[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]{display:flex;align-items:flex-start;flex-direction:column}.or[_ngcontent-%COMP%]{color:#f7c127}.or[_ngcontent-%COMP%], .pl[_ngcontent-%COMP%]{font-size:16px;margin-bottom:5px}.pl[_ngcontent-%COMP%]{color:#babcb9}.bc[_ngcontent-%COMP%]{color:#ea9e67;font-size:16px;margin-bottom:5px}"]}),t})()}];let B=(()=>{class t{}return t.\u0275mod=c.Hb({type:t}),t.\u0275inj=c.Gb({factory:function(e){return new(e||t)},imports:[[a.i.forChild(R)],a.i]}),t})();var Q=i("iTUp");let D=(()=>{class t{}return t.\u0275mod=c.Hb({type:t}),t.\u0275inj=c.Gb({factory:function(e){return new(e||t)},imports:[[o.b,n.e,r.lb,Q.a,B]]}),t})()},r3ab:function(t,e,i){"use strict";i.d(e,"a",function(){return a});var o=i("mrSG"),n=i("fXoL"),r=i("TEn/");let a=(()=>{class t{constructor(t){this.loadingCtrl=t}cargaProcesos(t){return Object(o.a)(this,void 0,void 0,function*(){return this.loading=yield this.loadingCtrl.create({message:t}),this.loading.present()})}finalizarCargado(){this.loading.dismiss()}}return t.\u0275fac=function(e){return new(e||t)(n.Qb(r.nb))},t.\u0275prov=n.Fb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})()},vLoH:function(t,e,i){"use strict";i.d(e,"a",function(){return f});var o=i("tk/3"),n=i("PqYM"),r=i("Cfvw"),a=i("coGc"),s=i("lJxs"),c=i("IzEk"),p=i("MtjB"),l=i("JIr8"),d=i("AytR"),h=i("fXoL"),u=i("B7Rs"),g=i("fsfq"),b=i("TEn/");let f=(()=>{class t{constructor(t,e,i,o){this.http=t,this.transfer=e,this.almacenamiento=i,this.navCtrl=o}hanflerError(t){let e=0;return t.pipe(Object(a.a)(()=>Object(n.a)(5e3)),Object(s.a)(t=>{if(e++,console.log("Entramos a intentos"),t instanceof ErrorEvent){if(3===e)throw new Error("Error de Red")}else{if(!(t instanceof ProgressEvent))throw 404===t.status?new Error(" al realizar la solicictud "):401===t.status?(this.almacenamiento.terminarPartida().then(()=>{this.navCtrl.navigateRoot("/home")}),new Error("No tiene permisos para realizar la petici\xf3n ")):(console.log(t,"Error de servidor"),new Error(" No se pudo realizar la petici\xf3n, intentalo m\xe1s tarde "));if(3===e)throw new Error("Error de Red")}}),Object(c.a)(3))}crearGrupo(t,e){const i={headers:new o.c({"x-token":t})};return this.http.post(`${d.a}/grupos/crear`,e,i).pipe(Object(p.a)(t=>this.hanflerError(t)))}listarGrupos(t,e){const i={headers:new o.c({"x-token":t})};return this.http.put(`${d.a}/grupos/lista`,e,i).pipe(Object(p.a)(t=>this.hanflerError(t)))}info(t,e){const i={headers:new o.c({"x-token":t})};return this.http.put(`${d.a}/grupos/info`,e,i).pipe(Object(p.a)(t=>this.hanflerError(t)))}integrantes(t,e){const i={headers:new o.c({"x-token":t})};return this.http.put(`${d.a}/grupos/integrantes`,e,i).pipe(Object(p.a)(t=>this.hanflerError(t)))}fotoPerfilUsuarioMoto(t,e,i,o){const n={fileKey:"archivo",httpMethod:"PUT",headers:{"x-token":t,"x-id":o},params:{tipo:i}},a=this.transfer.create();return Object(r.a)(a.upload(e,`${d.a}/upload/grupos`,n)).pipe(Object(l.a)(t=>{throw console.log("No se pudo subir la imagen "),new Error("No se pudo subir la imagen ")}))}subirweb(t,e,i){const n={headers:new o.c({"x-token":t,"x-id":i})};return this.http.put(`${d.a}/upload/grupos`,e,n).pipe(Object(p.a)(t=>this.hanflerError(t)))}leerProducto(t,e){const i={headers:new o.c({"x-token":t})};return this.http.put(`${d.a}/grupos/filtrar`,e,i).pipe(Object(p.a)(t=>this.hanflerError(t)))}chat(t,e){const i={headers:new o.c({"x-token":t})};return this.http.put(`${d.a}/grupos/chat`,e,i).pipe(Object(p.a)(t=>this.hanflerError(t)))}descarga(t,e){return this.http.get(`https://api.mapbox.com/directions/v5/mapbox/driving-traffic/${e.coordsIniciales.lng},${e.coordsIniciales.lat};${e.coordsFinales.lng},${e.coordsFinales.lat}?geometries=geojson&steps=true&language=es&access_token=${t}`).pipe(Object(p.a)(t=>this.hanflerError(t)))}dibujar(t,e){return this.http.get(`https://api.mapbox.com/directions/v5/mapbox/driving-traffic/${e.lng},${e.lat};${e.lngf},${e.latf}?geometries=geojson&steps=true&language=es&access_token=${t}`).pipe(Object(p.a)(t=>this.hanflerError(t)))}viaje(t,e){const i={headers:new o.c({"x-token":t})};return this.http.post(`${d.a}/grupos/viajes`,e,i).pipe(Object(p.a)(t=>this.hanflerError(t)))}irgrupo(t,e){const i={headers:new o.c({"x-token":t})};return this.http.put(`${d.a}/grupos/bu`,e,i).pipe(Object(p.a)(t=>this.hanflerError(t)))}podio(t,e){const i={headers:new o.c({"x-token":t})};return this.http.put(`${d.a}/grupos/podio`,e,i).pipe(Object(p.a)(t=>this.hanflerError(t)))}tabla(t,e){const i={headers:new o.c({"x-token":t})};return this.http.put(`${d.a}/grupos/tabla`,e,i).pipe(Object(p.a)(t=>this.hanflerError(t)))}viajechao(t,e){const i={headers:new o.c({"x-token":t})};return this.http.put(`${d.a}/grupos/viajes/eliminar`,e,i).pipe(Object(p.a)(t=>this.hanflerError(t)))}fotospodio(t,e){const i={headers:new o.c({"x-token":t})};return this.http.put(`${d.a}/grupos/podio/fotos`,e,i).pipe(Object(p.a)(t=>this.hanflerError(t)))}viajeBuscarUno(t,e){const i={headers:new o.c({"x-token":t})};return this.http.put(`${d.a}/grupos/buscar`,e,i).pipe(Object(p.a)(t=>this.hanflerError(t)))}viajeBuscar(t,e){const i={headers:new o.c({"x-token":t})};return this.http.put(`${d.a}/grupos/viajes/filtrar`,e,i).pipe(Object(p.a)(t=>this.hanflerError(t)))}fotoviaje(t,e,i){const o={fileKey:"archivo",httpMethod:"PUT",headers:{"x-token":e,"x-viaje":i}},n=this.transfer.create();return Object(r.a)(n.upload(t,`${d.a}/grupos/viaje/upload`,o)).pipe(Object(l.a)(t=>{throw new Error("No se pudo subir la imagen ")}))}subirweb2(t,e,i){const n={headers:new o.c({"x-token":t,"x-viaje":i})};return this.http.put(`${d.a}/grupos/viaje/upload`,e,n).pipe(Object(p.a)(t=>this.hanflerError(t)))}fotosviaje(t,e){const i={headers:new o.c({"x-token":t})};return this.http.put(`${d.a}/grupos/viaje/fotos`,e,i).pipe(Object(p.a)(t=>this.hanflerError(t)))}destino(t,e){const i={headers:new o.c({"x-token":t})};return this.http.put(`${d.a}/grupos/viaje/destino`,e,i).pipe(Object(p.a)(t=>this.hanflerError(t)))}eliminarviaje(t,e){const i={headers:new o.c({"x-token":t})};return this.http.put(`${d.a}/grupos/viaje/eliminar`,e,i).pipe(Object(p.a)(t=>this.hanflerError(t)))}eliminarFoto(t,e){const i={headers:new o.c({"x-token":t})};return this.http.put(`${d.a}/grupos/viaje/eliminarfoto`,e,i).pipe(Object(p.a)(t=>this.hanflerError(t)))}km(t,e){const i={headers:new o.c({"x-token":t})};return this.http.put(`${d.a}/grupos/km`,e,i).pipe(Object(p.a)(t=>this.hanflerError(t)))}}return t.\u0275fac=function(e){return new(e||t)(h.Qb(o.a),h.Qb(u.a),h.Qb(g.a),h.Qb(b.qb))},t.\u0275prov=h.Fb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})()}}]);