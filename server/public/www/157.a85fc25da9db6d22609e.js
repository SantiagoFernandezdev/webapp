(window.webpackJsonp=window.webpackJsonp||[]).push([[157],{pICn:function(t,i,e){"use strict";e.r(i),e.d(i,"SalasInicioPageModule",function(){return z});var o=e("ofXK"),s=e("3Pt+"),n=e("TEn/"),a=e("tyNb"),c=e("mrSG"),r=e("R0Ic"),l=e("HDdC"),d=e("ypew"),b=e("fXoL"),h=e("fsfq"),p=e("fmoy"),f=e("HavB"),u=e("7JkF"),g=e("SpuA");const m=["inifinito"],v=["contenido"];function O(t,i){if(1&t&&(b.Ob(0,"div",10),b.Mb(1,"ion-spinner",11),b.Ob(2,"div"),b.wc(3," Cargando chats... "),b.Mb(4,"br"),b.Ob(5,"strong"),b.wc(6),b.Nb(),b.Nb(),b.Nb()),2&t){const t=b.Yb(2);b.Ab(6),b.yc(" ",t.usuario,"")}}function x(t,i){1&t&&(b.Ob(0,"div",10),b.Ob(1,"div",14),b.Mb(2,"img",15),b.Mb(3,"br"),b.wc(4," A\xfan no tiene chats creados "),b.Mb(5,"br"),b.Nb(),b.Nb())}function N(t,i){if(1&t&&(b.Ob(0,"ion-avatar",28),b.Mb(1,"img",29),b.Nb()),2&t){const t=b.Yb().$implicit;b.fc("@escribiendo",t.escribiendo?"activo":"noactivo"),b.Ab(1),b.hc("src","https://www.motocaliapp.com/",t.taller.imagen[0].path,"",b.qc)}}function w(t,i){if(1&t&&(b.Ob(0,"ion-avatar",28),b.Mb(1,"img",29),b.Nb()),2&t){const t=b.Yb().$implicit;b.fc("@escribiendo",t.escribiendo?"activo":"noactivo"),b.Ab(1),b.hc("src","https://www.motocaliapp.com/",t.creador.imagen[0].path,"",b.qc)}}function C(t,i){if(1&t&&(b.Ob(0,"strong"),b.wc(1),b.Nb()),2&t){const t=b.Yb().$implicit;b.Ab(1),b.yc(" ",t.creador.nombrecompleto,"")}}function k(t,i){if(1&t&&(b.Ob(0,"strong"),b.wc(1),b.Nb()),2&t){const t=b.Yb().$implicit;b.Ab(1),b.yc(" ",t.taller.nombrecompleto,"")}}function j(t,i){1&t&&(b.Ob(0,"span"),b.wc(1," Escribiendo..."),b.Nb())}function A(t,i){if(1&t&&(b.Ob(0,"div",30),b.wc(1),b.Nb()),2&t){const t=b.Yb().$implicit;b.Ab(1),b.xc(t.novistos)}}function y(t,i){if(1&t){const t=b.Pb();b.Ob(0,"ion-item-option",31),b.Wb("click",function(){b.pc(t);const i=b.Yb().$implicit;return b.Yb(4).agregar(i)}),b.Mb(1,"ion-icon",32),b.Nb()}}function _(t,i){if(1&t){const t=b.Pb();b.Ob(0,"ion-item-sliding"),b.Ob(1,"ion-item",18),b.Wb("click",function(){b.pc(t);const e=i.$implicit;return b.Yb(4).entrar(e)}),b.vc(2,N,2,2,"ion-avatar",19),b.vc(3,w,2,2,"ion-avatar",19),b.Ob(4,"ion-label",20),b.Ob(5,"div",21),b.vc(6,C,2,1,"strong",2),b.vc(7,k,2,1,"strong",2),b.Nb(),b.Ob(8,"strong"),b.wc(9),b.Nb(),b.Ob(10,"div"),b.wc(11),b.Zb(12,"cambioUTC"),b.Nb(),b.Ob(13,"div",22),b.vc(14,j,2,0,"span",2),b.Nb(),b.vc(15,A,2,1,"div",23),b.Nb(),b.Nb(),b.Ob(16,"ion-item-options",24),b.vc(17,y,2,0,"ion-item-option",25),b.Ob(18,"ion-item-option",26),b.Wb("click",function(){b.pc(t);const e=i.$implicit;return b.Yb(4).quitar(e._id)}),b.Mb(19,"ion-icon",27),b.Nb(),b.Nb(),b.Nb()}if(2&t){const t=i.$implicit,e=b.Yb(4);b.Ab(2),b.fc("ngIf",t.creador._id===e.id),b.Ab(1),b.fc("ngIf",t.creador._id!==e.id),b.Ab(2),b.fc("@escribiendo",t.escribiendo?"activo":"noactivo"),b.Ab(1),b.fc("ngIf",t.creador._id!==e.id),b.Ab(1),b.fc("ngIf",t.creador._id===e.id),b.Ab(1),b.Db("ticket","ticket"===t.tipo)("pedido","pedido"===t.tipo)("hoja","hoja"===t.tipo),b.fc("@escribiendo",t.escribiendo?"activo":"noactivo"),b.Ab(1),b.yc("Chat Tipo: ",t.tipo,""),b.Ab(1),b.fc("@escribiendo",t.escribiendo?"activo":"noactivo"),b.Ab(1),b.xc(b.ac(12,18,t.fecha)),b.Ab(3),b.fc("ngIf",t.escribiendo),b.Ab(1),b.fc("ngIf",t.novistos>0),b.Ab(2),b.fc("ngIf",(t.taller._id===e.id||"TALLER_ROLE"===e.role)&&"directo"!==t.tipo)}}function I(t,i){if(1&t&&(b.Ob(0,"div",16),b.Ob(1,"ion-list"),b.vc(2,_,20,20,"ion-item-sliding",17),b.Nb(),b.Nb()),2&t){const t=b.Yb(3);b.Ab(2),b.fc("ngForOf",t.salas)}}function M(t,i){if(1&t&&(b.Ob(0,"div"),b.vc(1,x,6,0,"div",12),b.vc(2,I,3,1,"div",13),b.Nb()),2&t){const t=b.Yb(2);b.Ab(1),b.fc("ngIf",0===t.salas.length),b.Ab(1),b.fc("ngIf",t.salas.length>0)}}function P(t,i){if(1&t){const t=b.Pb();b.Ob(0,"ion-infinite-scroll",33,34),b.Wb("ionInfinite",function(i){return b.pc(t),b.Yb(2).loadData(i)}),b.Mb(2,"ion-infinite-scroll-content",35),b.Nb()}}function E(t,i){if(1&t){const t=b.Pb();b.Ob(0,"ion-content",null,3),b.Ob(2,"ion-refresher",4),b.Wb("ionRefresh",function(i){return b.pc(t),b.Yb().refrescando(i)}),b.Mb(3,"ion-refresher-content",5),b.Nb(),b.Ob(4,"ion-searchbar",6),b.Wb("ionChange",function(i){return b.pc(t),b.Yb().buscar(i)}),b.Nb(),b.vc(5,O,7,1,"div",7),b.Mb(6,"div",8),b.vc(7,M,3,2,"div",2),b.vc(8,P,3,0,"ion-infinite-scroll",9),b.Nb()}if(2&t){const t=b.Yb();b.Ab(5),b.fc("ngIf",!t.cargado),b.Ab(2),b.fc("ngIf",t.cargado),b.Ab(1),b.fc("ngIf",t.cargado)}}const L=[{path:"",component:(()=>{class t{constructor(t,i,e,o,s,n,a,r,l){this.router=t,this.alert=i,this.almacenamiento=e,this.toast=o,this.apiPedidos=s,this.socket=n,this.modal=a,this.plt=r,this.nav=l,this.configurando=!1,this.usuario="",this.habilitado=!1,this.cargado=!1,this.id="",this.salas=[],this.desde=0,this.patron="",this.scroll=!0,this.role="",this.parar=!1,this.plt.backButton.subscribe(()=>{}),this.escucharEscritoss().subscribe(t=>{console.log("escribiendo...",t),t.exe&&this.salas.forEach(i=>{i._id===t.idsala&&(console.log("existe"),i.escribiendo=!0,setTimeout(()=>{i.escribiendo=!1},500))})}),this.escucharMensaje().subscribe(t=>Object(c.a)(this,void 0,void 0,function*(){if(console.log("mensaje",t),t.exe){const i=yield this.almacenamiento.obtenerToken();if(i){const e=this.salas.filter(i=>i._id===t.resp.sala._id);this.apiPedidos.mensajes(i.token,{idsala:e[0]._id}).subscribe(i=>{this.salas=this.salas.filter(i=>i._id!==t.resp.sala._id),e[0].novistos=i.exe?i.response.length:0,this.salas.unshift(e[0])},i=>{this.salas=this.salas.filter(i=>i._id!==t.resp.sala._id),e[0].novistos=0,this.salas.unshift(e[0])})}}}))}ngOnInit(){}ionViewWillEnter(){this.parar=!1,this.pedidosListar()}refrescando(t){this.pedidosListar().then(()=>{t.detail.complete()}).catch(()=>{t.detail.complete()})}pedidosListar(){return Object(c.a)(this,void 0,void 0,function*(){this.salas=[];const t=yield this.almacenamiento.obtenerToken();t&&(this.role=t.role,this.id=t._id,this.usuario=t.nombre,this.apiPedidos.misChats(t.token,{patron:"",desde:this.desde}).subscribe(i=>{if(i.exe){let e=i.response.length;i.response.forEach(o=>Object(c.a)(this,void 0,void 0,function*(){o.escribiendo=!1,this.socket.emit("iniciochat",{id:o._id}),(yield new Promise((i,e)=>{this.apiPedidos.mensajes(t.token,{idsala:o._id}).subscribe(t=>{t.exe?(console.log(t,"RESPUESTA DEL TODO"),o.fechamsg=t.response.lemgth>0?t.response[t.response.length-1]:o.fecha,o.novistos=t.response.length,i(!0)):(o.novistos=0,i(!0))},t=>{o.novistos=0,i(!0)})}))&&(e-=1,0===e&&(this.salas=i.response,console.log(this.salas,"salas",e),this.salas.sort((t,i)=>(console.log(t.novistos),t.novistos<i.novistos?(console.log("meno"),1):t.novistos>i.novistos?(console.log("mayor"),-1):0))),this.cargado=!0)})),0===i.response.length&&(this.cargado=!0)}else this.toast.toastError("No se pudo consultar los pedidos, int\xe9ntelo m\xe1s tarde"),this.router.navigate(["/central/menu/"]),this.cargado=!0},t=>{this.toast.toastError("No se pudo consultar los pedidos, int\xe9ntelo m\xe1s tarde"),this.router.navigate(["/central/menu/"])}))})}crear(){return Object(c.a)(this,void 0,void 0,function*(){const t=yield this.alert.create({header:"Crear Pedido",message:"Los pedidos puedes realizarlos para comprar los repuestos o productos que necesites para tu veh\xedculo.",buttons:[{text:"Cancelar",cssClass:"cancelarAlerta",role:"cancel",handler:()=>{}},{text:"Crear",cssClass:"botonalerta",handler:t=>{this.router.navigate(["/central/menu/control-mapas"])}}]});yield t.present()})}escucharEscritoss(){return new l.a(t=>{this.socket.on("escribiendoChat",i=>{t.next(i)})})}escucharMensaje(){return new l.a(t=>{this.socket.on("mensajeChat",i=>{t.next(i)})})}entrar(t){this.almacenamiento.insertarChat(t).then(()=>{this.nav.navigateRoot("/central/menu/chats/chat")}).catch(()=>{this.toast.toastError("No se puede acceder al chat, int\xe9ntelo m\xe1s tarde")})}agregar(t){return Object(c.a)(this,void 0,void 0,function*(){const i=yield this.modal.create({component:d.a,componentProps:{sala:t}});yield i.present()})}quitar(t){return Object(c.a)(this,void 0,void 0,function*(){const i=yield this.alert.create({header:"Atenci\xf3n!",message:"\xbfEstas seguro de abandonar esta sala? No podras visualizar de nuevo la  informaci\xf3n dentro de ella",buttons:[{text:"Cancelar",cssClass:"cancelarAlerta",role:"cancel",handler:()=>{}},{text:"Salir",cssClass:"botonalerta",handler:()=>Object(c.a)(this,void 0,void 0,function*(){const i=yield this.almacenamiento.obtenerToken();if(i){let e=this.salas.filter(i=>i._id===t)[0].accesos;e=e.map(t=>t._id),e=e.filter(t=>t!==i._id),console.log(e," eliminado"),console.log(e),this.apiPedidos.editarChat(i.token,{id:t,accesos:e}).subscribe(t=>{t.exe?(this.toast.Especial("Saliste de la sala"),this.pedidosListar()):this.toast.toastError("No se pudo realizar la petici\xf3n, int\xe9ntelo m\xe1s tarde")},t=>{this.toast.toastError("No se pudo realizar la petici\xf3n, int\xe9ntelo m\xe1s tarde")})}})}]});yield i.present()})}buscar(t){return Object(c.a)(this,void 0,void 0,function*(){if(""!==t.detail.value){this.desde=0,this.infinite.disabled=!1,this.patron=t.detail.value;const i=yield this.almacenamiento.obtenerToken();i&&this.apiPedidos.misChats(i.token,{desde:this.desde,patron:this.patron}).subscribe(t=>{t.exe?(this.salas=t.response,0===t.response.length&&(this.desde=0)):this.toast.toastError("No se pudo realizar la consulta, intentelo m\xe1s tarde")},t=>{this.toast.toastError("No se pudo realizar la consulta, intentelo m\xe1s tarde")})}else this.desde=0,this.pedidosListar()})}loadData(t){return Object(c.a)(this,void 0,void 0,function*(){this.desde=this.desde+15;const i=yield this.almacenamiento.obtenerToken();i&&(""===this.patron?this.apiPedidos.misChats(i.token,{desde:this.desde,patron:this.patron}).subscribe(i=>{i.exe?i.response.length>0?(i.response.forEach(t=>{this.salas.push(t)}),t.target.complete()):(t.target.disabled=!0,this.desde=0):this.toast.toastError("No se pudo traer los chats, int\xe9ntelo m\xe1s tarde.")},t=>{this.toast.toastError("No se pudo traer los chats, int\xe9ntelo m\xe1s tarde.")}):this.apiPedidos.misChats(i.token,{desde:this.desde,patron:this.patron}).subscribe(i=>{i.exe?i.response.length>0?(i.response.forEach(t=>{this.salas.push(t)}),t.target.complete()):(t.target.disabled=!0,this.desde=0):this.toast.toastError("No se pudo realizar la consulta, intentelo m\xe1s tarde")},t=>{this.toast.toastError("No se pudo realizar la consulta, intentelo m\xe1s tarde")}))})}ionViewWillLeave(){this.parar=!0,this.salas.forEach(t=>{this.socket.emit("salidachat",{id:t._id})})}}return t.\u0275fac=function(i){return new(i||t)(b.Lb(a.g),b.Lb(n.b),b.Lb(h.a),b.Lb(p.a),b.Lb(f.a),b.Lb(u.a),b.Lb(n.qb),b.Lb(n.tb),b.Lb(n.rb))},t.\u0275cmp=b.Fb({type:t,selectors:[["app-salas-inicio"]],viewQuery:function(t,i){if(1&t&&(b.Ac(m,1),b.Ac(v,1)),2&t){let t;b.oc(t=b.Xb())&&(i.infinite=t.first),b.oc(t=b.Xb())&&(i.contenido=t.first)}},decls:6,vars:1,consts:[["color","oscuro"],["slot","start","icon","chevron-back-outline","defaultHref","/central/menu"],[4,"ngIf"],["contenido",""],["slot","fixed","pullFactor","0.5","pullMin","50","pullMax","150",3,"ionRefresh"],["pullingIcon","arrow-dropdown","refreshingSpinner","circles"],["debounce","300","mode","ios","placeholder","Buscar chats por tipo",3,"ionChange"],["class","flcenter ion-padding",4,"ngIf"],[1,"divider","light"],["threshold","100px",3,"ionInfinite",4,"ngIf"],[1,"flcenter","ion-padding"],["name","crescent","color","oscuro"],["class","flcenter ion-padding ",4,"ngIf"],["class"," ",4,"ngIf"],[1,"ct"],["src","/assets/Chats.png","width","80px","alt",""],[1,""],[4,"ngFor","ngForOf"],[3,"click"],["slot","start",4,"ngIf"],[1,"relativo"],[1,"info"],[1,"escribiendo"],["class","nv",4,"ngIf"],["side","end"],["color","barra",3,"click",4,"ngIf"],["color","danger",3,"click"],["name","trash-outline","slot","icon-only"],["slot","start"],[3,"src"],[1,"nv"],["color","barra",3,"click"],["name","add-outline","slot","icon-only"],["threshold","100px",3,"ionInfinite"],["inifinito",""],["loadingSpinner","bubbles","loadingText","Cargando Hojas de Vida..."]],template:function(t,i){1&t&&(b.Ob(0,"ion-header"),b.Ob(1,"ion-toolbar",0),b.Mb(2,"ion-back-button",1),b.Ob(3,"ion-title"),b.wc(4,"Sistema de Chats"),b.Nb(),b.Nb(),b.Nb(),b.vc(5,E,9,3,"ion-content",2)),2&t&&(b.Ab(5),b.fc("ngIf",i.scroll))},directives:[n.z,n.lb,n.g,n.h,n.jb,o.j,n.t,n.Q,n.R,n.U,n.yb,n.cb,n.L,o.i,n.J,n.F,n.K,n.I,n.H,n.A,n.f,n.C,n.D],pipes:[g.a],styles:[".flcenter[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:center;align-items:center;font-size:20px;text-align:center}ion-card[_ngcontent-%COMP%]{position:relative}.tp[_ngcontent-%COMP%]{z-index:10;background-color:initial}.ct[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;font-size:20px;font-weight:300}.msg[_ngcontent-%COMP%]{position:absolute;top:0;right:0;text-align:center;padding:5px 10px;border-radius:10px}.escribiendo[_ngcontent-%COMP%]{color:#627e42;font-weight:700;font-size:14px;height:20px}.relativo[_ngcontent-%COMP%]{position:relative}.nv[_ngcontent-%COMP%]{position:absolute;bottom:5px;right:5px;background-color:#627e42;color:#fff;text-align:center;min-width:20px;min-height:20px;max-width:50px;max-height:50px;border-radius:100%}.info[_ngcontent-%COMP%]{width:70%}.ticket[_ngcontent-%COMP%]{color:#e53935}.pedido[_ngcontent-%COMP%]{color:orange}.hoja[_ngcontent-%COMP%]{color:#4a4a4a}"],data:{animation:[Object(r.m)("escribiendo",[Object(r.j)("activo",Object(r.k)({opacity:.5})),Object(r.j)("noactivo",Object(r.k)({opacity:1})),Object(r.l)("activo <=> noactivo",[Object(r.e)("300ms")])])]}}),t})()}];let Y=(()=>{class t{}return t.\u0275fac=function(i){return new(i||t)},t.\u0275mod=b.Jb({type:t}),t.\u0275inj=b.Ib({imports:[[a.j.forChild(L)],a.j]}),t})();var T=e("iTUp");let z=(()=>{class t{}return t.\u0275fac=function(i){return new(i||t)},t.\u0275mod=b.Jb({type:t}),t.\u0275inj=b.Ib({imports:[[o.b,s.e,n.mb,Y,T.a]]}),t})()}}]);