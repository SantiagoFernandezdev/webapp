(window.webpackJsonp=window.webpackJsonp||[]).push([[12],{HavB:function(t,e,i){"use strict";i.d(e,"a",function(){return f});var n=i("AytR"),o=i("tk/3"),r=i("coGc"),a=i("lJxs"),s=i("IzEk"),c=i("MtjB"),d=i("JIr8"),h=i("PqYM"),l=i("Cfvw"),p=i("fXoL"),b=i("tyNb"),u=i("B7Rs");let f=(()=>{class t{constructor(t,e,i){this.http=t,this.router=e,this.MmyTransfer=i}hanflerError(t){return t.pipe(Object(r.a)(()=>Object(h.a)(3e3)),Object(a.a)(t=>{if(console.log("Entramos a intentos"),t instanceof ErrorEvent)throw new Error("Error de Red");if(404===t.status)throw new Error(" P\xe1gina no encontrada");if(401===t.status)throw new Error(" No tiene permisos ")}),Object(s.a)(3))}crearPedido(t,e){const i={headers:new o.c({"x-token":t})};return this.http.post(`${n.a}/pedidos/crear/`,e,i).pipe(Object(c.a)(t=>this.hanflerError(t)))}misPedido(t){const e={headers:new o.c({"x-token":t})};return this.http.get(`${n.a}/pedidos/lista/`,e).pipe(Object(c.a)(t=>this.hanflerError(t)))}misChats(t,e){const i={headers:new o.c({"x-token":t})};return this.http.post(`${n.a}/chats/lista/`,e,i).pipe(Object(c.a)(t=>this.hanflerError(t)))}misPedidoUsuario(t,e){const i={headers:new o.c({"x-token":t})};return this.http.post(`${n.a}/pedidos/lista/`,e,i).pipe(Object(c.a)(t=>this.hanflerError(t)))}misSalas(t){const e={headers:new o.c({"x-token":t})};return this.http.get(`${n.a}/ticket/salas`,e).pipe(Object(c.a)(t=>this.hanflerError(t)))}mensajes(t,e){const i={headers:new o.c({"x-token":t})};return this.http.post(`${n.a}/pedidos/chat`,e,i).pipe(Object(c.a)(t=>this.hanflerError(t)))}traermensajesNoVistos(t,e){const i={headers:new o.c({"x-token":t})};return this.http.post(`${n.a}/pedidos/chat/vistos`,e,i).pipe(Object(c.a)(t=>this.hanflerError(t)))}marcarvisto(t,e){const i={headers:new o.c({"x-token":t})};return this.http.put(`${n.a}/pedidos/chat/vistos`,e,i).pipe(Object(c.a)(t=>this.hanflerError(t)))}infoPedido(t,e){const i={headers:new o.c({"x-token":t})};return this.http.post(`${n.a}/pedidos/info`,e,i).pipe(Object(c.a)(t=>this.hanflerError(t)))}infoPedidoPut(t,e){const i={headers:new o.c({"x-token":t})};return this.http.put(`${n.a}/pedidos/info`,e,i).pipe(Object(c.a)(t=>this.hanflerError(t)))}crearEstados(t,e){const i={headers:new o.c({"x-token":t})};return this.http.post(`${n.a}/pedidos/estados`,e,i).pipe(Object(c.a)(t=>this.hanflerError(t)))}consultarEstados(t,e){const i={headers:new o.c({"x-token":t})};return this.http.put(`${n.a}/pedidos/estados`,e,i).pipe(Object(c.a)(t=>this.hanflerError(t)))}consultarChat(t,e){const i={headers:new o.c({"x-token":t})};return this.http.post(`${n.a}/unico/consultar/chat`,e,i).pipe(Object(c.a)(t=>this.hanflerError(t)))}consultarChatFotos(t,e){const i={headers:new o.c({"x-token":t})};return this.http.post(`${n.a}/unico/consultar/chat/fotos`,e,i).pipe(Object(c.a)(t=>this.hanflerError(t)))}consultarSala(t,e){const i={headers:new o.c({"x-token":t})};return this.http.post(`${n.a}/pedidos/consultar/chat`,e,i).pipe(Object(c.a)(t=>this.hanflerError(t)))}consultarMapa(t,e){const i={headers:new o.c({"x-token":t})};return this.http.post(`${n.a}/pedidos/consultar/mapa`,e,i).pipe(Object(c.a)(t=>this.hanflerError(t)))}consultarMapaUnico(t,e){const i={headers:new o.c({"x-token":t})};return this.http.post(`${n.a}/pedidos/consultar/mapa/unico`,e,i).pipe(Object(c.a)(t=>this.hanflerError(t)))}crearMapa(t,e){const i={headers:new o.c({"x-token":t})};return this.http.post(`${n.a}/pedidos/crear/mapa`,e,i).pipe(Object(c.a)(t=>this.hanflerError(t)))}editarMapa(t,e){const i={headers:new o.c({"x-token":t})};return this.http.put(`${n.a}/pedidos/editar/mapa`,e,i).pipe(Object(c.a)(t=>this.hanflerError(t)))}editarMapaInfo(t,e){const i={headers:new o.c({"x-token":t})};return this.http.put(`${n.a}/pedidos/editar/mapa/info`,e,i).pipe(Object(c.a)(t=>this.hanflerError(t)))}editarMapaInfoD(t,e){const i={headers:new o.c({"x-token":t})};return this.http.put(`${n.a}/pedidos/editar/mapa/infod`,e,i).pipe(Object(c.a)(t=>this.hanflerError(t)))}editarPedido(t,e){const i={headers:new o.c({"x-token":t})};return this.http.post(`${n.a}/pedidos/editar`,e,i).pipe(Object(c.a)(t=>this.hanflerError(t)))}editarChat(t,e){const i={headers:new o.c({"x-token":t})};return this.http.post(`${n.a}/chat/editar`,e,i).pipe(Object(c.a)(t=>this.hanflerError(t)))}subirArchivosChat(t,e,i,o,r,a,s){console.log("archivo",i);const c={fileKey:"archivo",fileName:a,mimeType:s,httpMethod:"PUT",headers:{"x-token":t,"x-sala":e,"x-final":o,"x-cont":r}},h=this.MmyTransfer.create();return Object(l.a)(h.upload(i,`${n.a}/pedido/upload`,c)).pipe(Object(d.a)(t=>{throw new Error(i)}))}subirweb(t,e,i,r,a){console.log(t,e,i,r);const s={headers:new o.c({"x-token":t,"x-sala":e,"x-final":i.toString(),"x-cont":r.toString()})};return this.http.put(`${n.a}/pedido/upload`,a,s).pipe(Object(c.a)(t=>this.hanflerError(t)))}}return t.\u0275fac=function(e){return new(e||t)(p.Qb(o.a),p.Qb(b.g),p.Qb(u.a))},t.\u0275prov=p.Fb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})()},mpxO:function(t,e,i){"use strict";i.r(e),i.d(e,"SalaModalChatPageModule",function(){return C});var n=i("ofXK"),o=i("3Pt+"),r=i("TEn/"),a=i("tyNb"),s=i("mrSG"),c=i("fXoL"),d=i("fsfq"),h=i("fmoy"),l=i("7JkF"),p=i("a/9d"),b=i("r3ab"),u=i("HavB");function f(t,e){if(1&t&&(c.Mb(0,"ion-slides",6),c.Mb(1,"ion-slide"),c.Kb(2,"img",7),c.Lb(),c.Lb()),2&t){const t=c.Wb();c.dc("options",t.slide),c.zb(2),c.fc("src","https://www.motocaliapp.com/2807/",t.img,"",c.mc)}}let g=(()=>{class t{constructor(t,e,i,n,o,r,a,s){this.almacenamiento=t,this.modal=e,this.toast=i,this.socket=n,this.actionCtrl=o,this.camera=r,this.myLoading=a,this.apiPedido=s,this.carga=!1,this.slide={zoom:{maxRation:8}}}ngOnInit(){}ionViewWillEnter(){this.crear()}crear(){return Object(s.a)(this,void 0,void 0,function*(){(yield this.almacenamiento.obtenerToken())&&(this.carga=!0)})}cerrar(){this.modal.dismiss()}}return t.\u0275fac=function(e){return new(e||t)(c.Jb(d.a),c.Jb(r.ob),c.Jb(h.a),c.Jb(l.a),c.Jb(r.a),c.Jb(p.a),c.Jb(b.a),c.Jb(u.a))},t.\u0275cmp=c.Db({type:t,selectors:[["app-modal-chat"]],inputs:{img:"img"},decls:9,vars:1,consts:[[1,"ion-no-border"],["color","darkgold"],["slot","end"],[3,"click"],["name","close-outline","slot","icon-only"],[3,"options",4,"ngIf"],[3,"options"],["width","100%",3,"src"]],template:function(t,e){1&t&&(c.Mb(0,"ion-header",0),c.Mb(1,"ion-toolbar",1),c.Mb(2,"ion-title"),c.rc(3,"Foto"),c.Lb(),c.Mb(4,"ion-buttons",2),c.Mb(5,"ion-button",3),c.Ub("click",function(){return e.cerrar()}),c.Kb(6,"ion-icon",4),c.Lb(),c.Lb(),c.Lb(),c.Lb(),c.Mb(7,"ion-content",1),c.qc(8,f,3,2,"ion-slides",5),c.Lb()),2&t&&(c.zb(8),c.dc("ngIf",e.carga&&e.img))},directives:[r.z,r.jb,r.hb,r.k,r.j,r.A,r.t,n.j,r.ab,r.Z],styles:[".flexc[_ngcontent-%COMP%]{width:100%;display:flex;flex-direction:column;justify-content:center;align-items:center}ion-slide[_ngcontent-%COMP%], ion-slides[_ngcontent-%COMP%]{width:100%;min-height:100%}ion-slide[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;align-items:center}ion-slide[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{max-height:100%}"]}),t})();const m=["fileUpload"];function v(t,e){if(1&t){const t=c.Nb();c.Mb(0,"ion-buttons",5),c.Mb(1,"ion-button",6),c.Ub("click",function(){return c.lc(t),c.Wb().cerrar()}),c.Kb(2,"ion-icon",7),c.Lb(),c.Lb()}}function w(t,e){if(1&t){const t=c.Nb();c.Mb(0,"ion-buttons",8),c.Mb(1,"ion-button",6),c.Ub("click",function(){return c.lc(t),c.Wb().enviarMensaje()}),c.rc(2,"Enviar"),c.Lb(),c.Lb()}}function M(t,e){1&t&&(c.Mb(0,"div",14),c.Mb(1,"div",15),c.Kb(2,"img",16),c.Kb(3,"br"),c.Mb(4,"h3",17),c.rc(5,"No Hay fotos agregados para enviat."),c.Lb(),c.Lb(),c.Lb())}function O(t,e){if(1&t){const t=c.Nb();c.Mb(0,"ion-slide"),c.Kb(1,"img",20),c.Mb(2,"div",21),c.Ub("click",function(){c.lc(t);const i=e.index;return c.Wb(3).eliminardelCarrete(i)}),c.Mb(3,"ion-chip",22),c.rc(4,"Eliminar"),c.Lb(),c.Lb(),c.Kb(5,"br"),c.Kb(6,"br"),c.Lb()}if(2&t){const t=e.$implicit;c.zb(1),c.ec("src",t,c.mc)}}function x(t,e){if(1&t&&(c.Mb(0,"ion-slides",18),c.qc(1,O,7,1,"ion-slide",19),c.Lb()),2&t){const t=c.Wb(2);c.dc("pager",!0),c.zb(1),c.dc("ngForOf",t.filesRendering)}}function j(t,e){if(1&t){const t=c.Nb();c.Mb(0,"div"),c.Kb(1,"input",9,10),c.Mb(3,"ion-button",11),c.Ub("click",function(){return c.lc(t),c.Wb().opciones()}),c.rc(4,"A\xf1adir Imagen"),c.Lb(),c.Kb(5,"br"),c.qc(6,M,6,0,"div",12),c.qc(7,x,2,2,"ion-slides",13),c.Lb()}if(2&t){const t=c.Wb();c.zb(6),c.dc("ngIf",0===t.filesRendering.length),c.zb(1),c.dc("ngIf",t.filesRendering.length>0)}}function k(t,e){if(1&t){const t=c.Nb();c.Mb(0,"ion-card",25),c.Ub("click",function(){c.lc(t);const i=e.$implicit;return c.Wb(2).modalFoto(i.ruta)}),c.Mb(1,"ion-card-header"),c.Kb(2,"img",26),c.Lb(),c.Mb(3,"ion-card-subtitle"),c.rc(4),c.Lb(),c.Lb()}if(2&t){const t=e.$implicit;c.zb(2),c.fc("src","https://www.motocaliapp.com/2807/",t.ruta,"",c.mc),c.zb(2),c.tc(" @",t.creador.nombreusuario," ")}}function E(t,e){if(1&t&&(c.Mb(0,"div"),c.Mb(1,"div",23),c.qc(2,k,5,2,"ion-card",24),c.Lb(),c.Lb()),2&t){const t=c.Wb();c.zb(2),c.dc("ngForOf",t.fotos)}}const y=[{path:"",component:(()=>{class t{constructor(t,e,i,n,o,r,a,s,c,d,h){this.almacenamiento=t,this.modal=e,this.toast=i,this.socket=n,this.actionCtrl=o,this.camera=r,this.myLoading=a,this.apiPedido=s,this.active=c,this.router=d,this.plt=h,this.cargado=!1,this.carrete=[],this.carreteRoot=[],this.carga=!1,this.id="",this.fotos=[],this.vista=1,this.files=[],this.filesRendering=[],this.plt.backButton.subscribe(()=>{this.router.navigate(["/central/citas",this.active.snapshot.paramMap.get("id")])})}ngOnInit(){}ionViewWillEnter(){this.id=this.active.snapshot.paramMap.get("id"),this.crear()}crear(){return Object(s.a)(this,void 0,void 0,function*(){const t=yield this.almacenamiento.obtenerToken();t&&this.apiPedido.consultarChat(t.token,{id:this.active.snapshot.paramMap.get("id")}).subscribe(t=>{t.exe?(this.sala=t.response,"ver"===this.active.snapshot.paramMap.get("tipo")?this.ver():(this.carga=!0,this.vista=1)):this.toast.toastError("No se pudo traer la informaci\xf3n, int\xe9ntelo m\xe1s tarde")},t=>{this.toast.toastError("No se pudo traer la informaci\xf3n, int\xe9ntelo m\xe1s tarde")})})}ver(){return Object(s.a)(this,void 0,void 0,function*(){const t=yield this.almacenamiento.obtenerToken();t&&this.apiPedido.consultarChatFotos(t.token,{id:this.active.snapshot.paramMap.get("id")}).subscribe(t=>{t.exe?(t.response.forEach(t=>{this.fotos.unshift(t)}),this.vista=2):this.toast.toastError("No se pudo traer las fotos, int\xe9ntelo m\xe1s tarde"),this.carga=!0},t=>{this.toast.toastError("No se pudo traer las fotos, int\xe9ntelo m\xe1s tarde")})})}opciones(){return Object(s.a)(this,void 0,void 0,function*(){const t=yield this.actionCtrl.create({header:"Escoge una opci\xf3n",buttons:[{icon:"image-outline",text:"Subir foto de galer\xeda",handler:()=>{const t=this.fileUpload.nativeElement;t.onchange=e=>{for(let i=0;i<t.files.length;i++){const n=t.files[i];console.log(n,n.name),this.files.push({data:n,inProgress:!1,progress:0});let o,r=new FileReader;r.readAsDataURL(e.target.files[0]),r.onload=function(){console.log(r.result),o=r.result},setTimeout(()=>{this.filesRendering.push(o)},1500)}console.log(this.files,"archivos")},t.click()}}]});yield t.present()})}tomarFoto(t,e){this.camera.getPicture({quality:100,allowEdit:!0,correctOrientation:!0,destinationType:this.camera.DestinationType.FILE_URI,encodingType:this.camera.EncodingType.JPEG,mediaType:this.camera.MediaType.PICTURE,sourceType:t}).then(t=>Object(s.a)(this,void 0,void 0,function*(){let e="",i="";t.includes("jpg")?(e="image/jpg",i="image.jpg"):t.includes("png")?(e="image/png",i="image.png"):t.includes("jpeg")?(e="image/jpeg",i="image.jpeg"):t.includes("gif")?(e="image/gif",i="image.gif"):(e="image/jpg",i="image.jpg"),this.carrete.push({path:t,name:i,mime:e,cont:this.carrete.length+1});const n=window.Ionic.WebView.convertFileSrc(t);this.carreteRoot.push({path:n,mime:e}),this.camera.cleanup().then(()=>{})}))}enviarMensaje(){return Object(s.a)(this,void 0,void 0,function*(){if(this.files.length>0){const t=yield this.almacenamiento.obtenerToken();if(this.myLoading.cargaProcesos("Subiendo mensaje con archivos media, por favor espere"),t){let e=this.files.length,i=1===this.files.length;this.files.forEach(n=>{const o=new FormData;o.append("archivo",n.data),n.inProgress=!0,this.apiPedido.subirweb(t.token,this.id,i,e,o).subscribe(t=>{t.exe&&(e-=1,0===e&&(this.myLoading.finalizarCargado(),this.toast.Especial("Enviado"),this.cerrar()))},t=>{this.myLoading.finalizarCargado(),this.toast.alertApplication("No se pudo subir el archivo de v\xeddeo o imagen"+t,!0)})})}}})}eliminardelCarrete(t){this.files.splice(t,1),this.filesRendering.splice(t,1)}modalFoto(t){return Object(s.a)(this,void 0,void 0,function*(){const e=yield this.modal.create({component:g,componentProps:{img:t}});yield e.present()})}cerrar(){this.router.navigate(["/central/citas",this.id])}}return t.\u0275fac=function(e){return new(e||t)(c.Jb(d.a),c.Jb(r.ob),c.Jb(h.a),c.Jb(l.a),c.Jb(r.a),c.Jb(p.a),c.Jb(b.a),c.Jb(u.a),c.Jb(a.a),c.Jb(a.g),c.Jb(r.rb))},t.\u0275cmp=c.Db({type:t,selectors:[["app-sala-modal-chat"]],viewQuery:function(t,e){if(1&t&&c.vc(m,1),2&t){let t;c.kc(t=c.Vb())&&(e.fileUpload=t.first)}},decls:9,vars:4,consts:[[1,"ion-no-border"],["color","oscuro"],["slot","start",4,"ngIf"],["mode","ios","slot","end",4,"ngIf"],[4,"ngIf"],["slot","start"],[3,"click"],["name","chevron-back-outline","slot","icon-only"],["mode","ios","slot","end"],["type","file","id","fileUpload","name","archivo","accept","image/*",2,"display","none"],["fileUpload",""],["expand","block","mode","ios","color","danger",3,"click"],["class","none",4,"ngIf"],[3,"pager",4,"ngIf"],[1,"none"],[1,"flexc"],["src","/assets/Camara.png","width","70px","alt",""],[1,"tituloGrande"],[3,"pager"],[4,"ngFor","ngForOf"],["width","70px",3,"src"],[1,"eliminar",3,"click"],["color","danger"],[1,"opts"],["mode","ios",3,"click",4,"ngFor","ngForOf"],["mode","ios",3,"click"],["width","100%",3,"src"]],template:function(t,e){1&t&&(c.Mb(0,"ion-header",0),c.Mb(1,"ion-toolbar",1),c.qc(2,v,3,0,"ion-buttons",2),c.Mb(3,"ion-title"),c.rc(4,"Enviar Fotos"),c.Lb(),c.qc(5,w,3,0,"ion-buttons",3),c.Lb(),c.Lb(),c.Mb(6,"ion-content"),c.qc(7,j,8,2,"div",4),c.qc(8,E,3,1,"div",4),c.Lb()),2&t&&(c.zb(2),c.dc("ngIf",e.carga),c.zb(3),c.dc("ngIf",1===e.vista),c.zb(2),c.dc("ngIf",e.carga&&1===e.vista),c.zb(1),c.dc("ngIf",e.carga&&2===e.vista))},directives:[r.z,r.jb,n.j,r.hb,r.t,r.k,r.j,r.A,r.ab,n.i,r.Z,r.r,r.l,r.n,r.o],styles:[".flexc[_ngcontent-%COMP%]{width:100%;display:flex;flex-direction:column;justify-content:center;align-items:center;text-align:center}ion-slide[_ngcontent-%COMP%], ion-slides[_ngcontent-%COMP%]{width:100%;min-height:100%}ion-slide[_ngcontent-%COMP%]{flex-direction:column}.opts[_ngcontent-%COMP%], ion-slide[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap}.opts[_ngcontent-%COMP%]{justify-content:space-between}.opts[_ngcontent-%COMP%]   ion-card[_ngcontent-%COMP%]{width:calc(50% - 10px);margin:10px 5px;display:flex;flex-direction:column;justify-content:center;align-items:center;transition:all .5s}.opts[_ngcontent-%COMP%]   ion-card[_ngcontent-%COMP%]   ion-card-title[_ngcontent-%COMP%]{font-size:22px;text-align:center}.opts[_ngcontent-%COMP%]   ion-card[_ngcontent-%COMP%]   ion-card-header[_ngcontent-%COMP%]{text-align:center;padding:5px}@media screen and (min-width:800px){.opts[_ngcontent-%COMP%]   ion-card[_ngcontent-%COMP%]{width:calc(33.33% - 10px)}}"]}),t})()}];let P=(()=>{class t{}return t.\u0275mod=c.Hb({type:t}),t.\u0275inj=c.Gb({factory:function(e){return new(e||t)},imports:[[a.i.forChild(y)],a.i]}),t})(),C=(()=>{class t{}return t.\u0275mod=c.Hb({type:t}),t.\u0275inj=c.Gb({factory:function(e){return new(e||t)},imports:[[n.b,o.e,r.kb,P]]}),t})()},r3ab:function(t,e,i){"use strict";i.d(e,"a",function(){return a});var n=i("mrSG"),o=i("fXoL"),r=i("TEn/");let a=(()=>{class t{constructor(t){this.loadingCtrl=t}cargaProcesos(t){return Object(n.a)(this,void 0,void 0,function*(){return this.loading=yield this.loadingCtrl.create({message:t}),this.loading.present()})}finalizarCargado(){this.loading.dismiss()}}return t.\u0275fac=function(e){return new(e||t)(o.Qb(r.mb))},t.\u0275prov=o.Fb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})()}}]);