(window.webpackJsonp=window.webpackJsonp||[]).push([[71],{"+WxW":function(t,i,e){"use strict";e.d(i,"a",function(){return b});var n=e("AytR"),a=e("tk/3"),o=e("coGc"),r=e("lJxs"),s=e("IzEk"),c=e("MtjB"),d=e("PqYM"),l=e("fXoL"),h=e("tyNb");let b=(()=>{class t{constructor(t,i){this.http=t,this.router=i}hanflerError(t){return t.pipe(Object(o.a)(()=>Object(d.a)(3e3)),Object(r.a)(t=>{if(console.log("Entramos a intentos"),t instanceof ErrorEvent)throw new Error("Error de Red");if(404===t.status)throw new Error(" P\xe1gina no encontrada");if(401===t.status)throw new Error(" No tiene permisos ")}),Object(s.a)(3))}disponibilidad(t){const i={headers:new a.c({"x-token":t})};return this.http.get(`${n.a}/ticket/disponibilidad`,i).pipe(Object(c.a)(t=>this.hanflerError(t)))}Creardisponibilidad(t){const i={headers:new a.c({"x-token":t})};return this.http.post(`${n.a}/ticket/disponibilidad`,{},i).pipe(Object(c.a)(t=>this.hanflerError(t)))}editardisponibilidad(t,i){const e={headers:new a.c({"x-token":t})};return this.http.put(`${n.a}/ticket/disponibilidad`,i,e).pipe(Object(c.a)(t=>this.hanflerError(t)))}crearSala(t,i){const e={headers:new a.c({"x-token":t})};return this.http.post(`${n.a}/ticket/salas`,i,e).pipe(Object(c.a)(t=>this.hanflerError(t)))}misSalas(t){const i={headers:new a.c({"x-token":t})};return this.http.get(`${n.a}/ticket/salas`,i).pipe(Object(c.a)(t=>this.hanflerError(t)))}crearTicket(t,i){const e={headers:new a.c({"x-token":t})};return this.http.post(`${n.a}/ticket/crear`,i,e).pipe(Object(c.a)(t=>this.hanflerError(t)))}misTickets(t){const i={headers:new a.c({"x-token":t})};return this.http.get(`${n.a}/ticket/lista`,i).pipe(Object(c.a)(t=>this.hanflerError(t)))}misTicketsLista(t,i){const e={headers:new a.c({"x-token":t})};return this.http.put(`${n.a}/ticket/lista/negocio`,i,e).pipe(Object(c.a)(t=>this.hanflerError(t)))}salasNegocio(t,i){const e={headers:new a.c({"x-token":t})};return this.http.put(`${n.a}/ticket/salas/usuario`,i,e).pipe(Object(c.a)(t=>this.hanflerError(t)))}disponibilidadnegocio(t,i){const e={headers:new a.c({"x-token":t})};return this.http.put(`${n.a}/ticket/disponibilidad/negocio`,i,e).pipe(Object(c.a)(t=>this.hanflerError(t)))}ticketsolo(t,i){const e={headers:new a.c({"x-token":t})};return this.http.put(`${n.a}/ticket/solo`,i,e).pipe(Object(c.a)(t=>this.hanflerError(t)))}ticketelimina(t,i){const e={headers:new a.c({"x-token":t})};return this.http.put(`${n.a}/ticket/eliminar`,i,e).pipe(Object(c.a)(t=>this.hanflerError(t)))}crearHoja(t,i){const e={headers:new a.c({"x-token":t})};return this.http.post(`${n.a}/hoja/dos`,i,e).pipe(Object(c.a)(t=>this.hanflerError(t)))}consultarSala(t,i){const e={headers:new a.c({"x-token":t})};return this.http.post(`${n.a}/ticket/consultar/chat`,i,e).pipe(Object(c.a)(t=>this.hanflerError(t)))}}return t.\u0275fac=function(i){return new(i||t)(l.Sb(a.a),l.Sb(h.g))},t.\u0275prov=l.Hb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})()},NlP8:function(t,i,e){"use strict";e.r(i),e.d(i,"TallerTicketPageModule",function(){return y});var n=e("ofXK"),a=e("3Pt+"),o=e("TEn/"),r=e("tyNb"),s=e("mrSG"),c=e("HDdC"),d=e("fXoL"),l=e("fsfq"),h=e("fmoy"),b=e("+WxW"),p=e("7JkF"),u=e("OKd0");function f(t,i){1&t&&(d.Ob(0,"div",7),d.Mb(1,"ion-spinner",8),d.Ob(2,"div"),d.wc(3," Cargando sistema de turno para "),d.Mb(4,"br"),d.Nb(),d.Nb())}function g(t,i){1&t&&(d.Ob(0,"div",7),d.Ob(1,"div"),d.wc(2," A\xfan no tiene salas creadas "),d.Mb(3,"br"),d.Nb(),d.Nb())}function m(t,i){1&t&&(d.Ob(0,"strong"),d.wc(1,"Libre"),d.Nb())}function k(t,i){1&t&&(d.Ob(0,"strong"),d.wc(1,"Ocupada"),d.Nb())}function O(t,i){if(1&t&&(d.Ob(0,"div"),d.Ob(1,"strong"),d.wc(2,"Dureci\xf3n estimada del trabajo:"),d.Nb(),d.wc(3),d.Zb(4,"diferencia"),d.Nb()),2&t){const t=d.Yb(2).$implicit;d.Ab(3),d.yc(" ",d.cc(4,1,t.fechainicio,t.fechafinal,1),"")}}function w(t,i){if(1&t&&(d.Ob(0,"div"),d.Ob(1,"strong"),d.wc(2,"Tiempo transcurrido:"),d.Nb(),d.wc(3),d.Zb(4,"diferencia"),d.Nb()),2&t){const t=d.Yb(2).$implicit;d.Ab(3),d.yc(" ",d.cc(4,1,t.fechainicio,t.fechafinal,2),"")}}function v(t,i){if(1&t&&(d.Ob(0,"div"),d.Mb(1,"div",14),d.Ob(2,"div"),d.Ob(3,"strong"),d.wc(4,"Usuario:"),d.Nb(),d.wc(5),d.Nb(),d.vc(6,O,5,5,"div",13),d.vc(7,w,5,5,"div",13),d.Nb()),2&t){const t=d.Yb().$implicit;d.Ab(5),d.yc(" ",t.mas.creador.nombrecompleto,""),d.Ab(1),d.fc("ngIf",""!==t.fechainicio),d.Ab(1),d.fc("ngIf",""!==t.fechainicio)}}function x(t,i){if(1&t&&(d.Ob(0,"ion-card",11),d.Ob(1,"ion-card-title"),d.wc(2),d.Nb(),d.Ob(3,"div",12),d.vc(4,m,2,0,"strong",13),d.vc(5,k,2,0,"strong",13),d.Nb(),d.Ob(6,"ion-card-content"),d.Ob(7,"div"),d.Ob(8,"strong"),d.wc(9,"Persona que atiende:"),d.Nb(),d.wc(10),d.Nb(),d.vc(11,v,8,3,"div",13),d.Nb(),d.Nb()),2&t){const t=i.$implicit,e=i.index;d.Ab(2),d.yc("Sala ",e+1," "),d.Ab(1),d.Db("ocupado",t.ocupada)("desocupado",!t.ocupada),d.Ab(1),d.fc("ngIf",!t.ocupada),d.Ab(1),d.fc("ngIf",t.ocupada),d.Ab(5),d.yc(" ",t.atiende,""),d.Ab(1),d.fc("ngIf",t.info)}}function N(t,i){if(1&t&&(d.Ob(0,"div",9),d.vc(1,g,4,0,"div",4),d.vc(2,x,12,9,"ion-card",10),d.Nb()),2&t){const t=d.Yb();d.Ab(1),d.fc("ngIf",0===t.salas.length),d.Ab(1),d.fc("ngForOf",t.salas)}}const E=[{path:"",component:(()=>{class t{constructor(t,i,e,n,a,o,r){this.almacenamiento=t,this.toast=i,this.apiTickets=e,this.alert=n,this.router=a,this.active=o,this.socket=r,this.configurando=!1,this.usuario="",this.habilitado=!1,this.cargado=!1,this.id="",this.salas=[],this.escucharProcesados().subscribe(t=>{t.exe&&this.salas.forEach(i=>{i._id===t.data.sala._id&&(i.ocupada=!0,i.info=!0,i.fechainicio=t.data.sala.fechainicio,i.fechafinal=t.data.sala.fechafinal,i.mas=t.data.doc)})}),this.escucharFinalizados().subscribe(t=>{t.exe&&this.salas.forEach(i=>{i._id===t.data._id&&(i.ocupada=!1,i.info=!1)})})}ngOnInit(){}ionViewWillEnter(){this.disponibilidad(),this.almacenamiento.insertarTicket("entrando").then(t=>{if(t)return!0})}refrescando(t){this.salas=[],this.disponibilidad().then(()=>{t.detail.complete()}).catch(()=>{t.detail.complete()})}disponibilidad(){return Object(s.a)(this,void 0,void 0,function*(){const t=yield this.almacenamiento.obtenerToken();t&&(this.usuario=t.nombre,this.apiTickets.disponibilidadnegocio(t.token,{id:this.active.snapshot.paramMap.get("id")}).subscribe(t=>{t.exe?(this.cargado=!0,this.habilitado=t.data[0].estado,this.id=t.data[0]._id,"no"===t.response?(this.toast.toastNotificacion("No hay disponibilidad en este momento"),this.misSalas()):this.misSalas()):(this.toast.toastError("No se pudo consultar la disponibilidad, int\xe9ntelo m\xe1s tarde"),this.router.navigate(["/central/menu/"]))},t=>{this.toast.toastError("No se pudo consultar la disponibilidad, int\xe9ntelo m\xe1s tarde"),this.router.navigate(["/central/menu/"])}))})}misSalas(){return Object(s.a)(this,void 0,void 0,function*(){this.configurando=!0;const t=yield this.almacenamiento.obtenerToken();t&&this.apiTickets.salasNegocio(t.token,{id:this.active.snapshot.paramMap.get("id")}).subscribe(i=>{i.exe?(i.response.forEach(i=>(i.info=!1,this.socket.emit("ticket",{id:i.creador}),new Promise((e,n)=>{i.ocupada&&this.apiTickets.ticketsolo(t.token,{id:i.ticket._id}).subscribe(t=>{t.exe?(i.info=!0,i.mas=t.response,e(!0)):(i.info=!1,e(!1))},t=>{i.info=!1,e(!1)})}))),this.salas=i.response):(this.toast.toastError("No se pudo traer las salas, int\xe9ntelo m\xe1s tarde"),this.router.navigate(["/central/menu/"])),this.configurando=!1},t=>{this.toast.toastError("No se pudo traer las salas, int\xe9ntelo m\xe1s tarde"),this.router.navigate(["/central/menu/"]),this.configurando=!1})})}escucharProcesados(){return new c.a(t=>{this.socket.on("procesar",i=>{t.next(i)})})}escucharFinalizados(){return new c.a(t=>{this.socket.on("finalizar",i=>{t.next(i)})})}ionViewWillLeave(){this.almacenamiento.eleminarTicket().then(t=>{if(t)return!0})}}return t.\u0275fac=function(i){return new(i||t)(d.Lb(l.a),d.Lb(h.a),d.Lb(b.a),d.Lb(o.b),d.Lb(r.g),d.Lb(r.a),d.Lb(p.a))},t.\u0275cmp=d.Fb({type:t,selectors:[["app-taller-ticket"]],decls:11,vars:2,consts:[["color","oscuro"],["slot","start","icon","chevron-back-outline","defaultHref","/central/menu"],["slot","fixed","pullFactor","0.5","pullMin","50","pullMax","150",3,"ionRefresh"],["pullingIcon","arrow-dropdown","refreshingSpinner","circles"],["class","flcenter ion-padding",4,"ngIf"],[1,"divider","light"],["class","salas",4,"ngIf"],[1,"flcenter","ion-padding"],["name","crescent","color","oscuro"],[1,"salas"],["mode","ios",4,"ngFor","ngForOf"],["mode","ios"],[1,"msg"],[4,"ngIf"],[1,"separador"]],template:function(t,i){1&t&&(d.Ob(0,"ion-header"),d.Ob(1,"ion-toolbar",0),d.Mb(2,"ion-back-button",1),d.Ob(3,"ion-title"),d.wc(4,"Turnos"),d.Nb(),d.Nb(),d.Nb(),d.Ob(5,"ion-content"),d.Ob(6,"ion-refresher",2),d.Wb("ionRefresh",function(t){return i.refrescando(t)}),d.Mb(7,"ion-refresher-content",3),d.Nb(),d.vc(8,f,5,0,"div",4),d.Mb(9,"div",5),d.vc(10,N,3,2,"div",6),d.Nb()),2&t&&(d.Ab(8),d.fc("ngIf",i.configurando),d.Ab(2),d.fc("ngIf",i.cargado))},directives:[o.z,o.lb,o.g,o.h,o.jb,o.t,o.Q,o.R,n.j,o.cb,n.i,o.l,o.p,o.m],pipes:[u.a],styles:[".flcenter[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:center;align-items:center;font-size:18px;text-align:center}.separador[_ngcontent-%COMP%]{width:100%;border-bottom:1px solid #566520;padding:5px;margin-bottom:5px}ion-card[_ngcontent-%COMP%]{position:relative}.msg[_ngcontent-%COMP%]{position:absolute;top:0;right:0;text-align:center;padding:5px 10px;border-radius:10px}ion-card-title[_ngcontent-%COMP%]{width:100%;padding:5px 15px}.ocupado[_ngcontent-%COMP%]{background-color:#ca0900!important;color:#fff}.desocupado[_ngcontent-%COMP%]{background-color:#819830!important;color:#fff}"]}),t})()}];let j=(()=>{class t{}return t.\u0275fac=function(i){return new(i||t)},t.\u0275mod=d.Jb({type:t}),t.\u0275inj=d.Ib({imports:[[r.j.forChild(E)],r.j]}),t})();var M=e("iTUp");let y=(()=>{class t{}return t.\u0275fac=function(i){return new(i||t)},t.\u0275mod=d.Jb({type:t}),t.\u0275inj=d.Ib({imports:[[n.b,a.e,o.mb,j,M.a]]}),t})()}}]);