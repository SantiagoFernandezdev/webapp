(window.webpackJsonp=window.webpackJsonp||[]).push([[55],{efCk:function(t,e,r){"use strict";r.r(e),r.d(e,"InterfazGrupoRutasPageModule",function(){return x});var o=r("ofXK"),i=r("3Pt+"),a=r("TEn/"),s=r("tyNb"),n=r("mrSG"),c=r("fXoL"),p=r("fsfq"),h=r("oQG1"),l=r("fmoy"),u=r("vLoH");const d=["inifinito"];function b(t,e){1&t&&(c.Ob(0,"div",5),c.Mb(1,"img",6),c.Ob(2,"h3"),c.wc(3,"No tiene acceso para ver esta informaci\xf3n, env\xede una invitaci\xf3n a este grupo"),c.Nb(),c.Nb())}function f(t,e){1&t&&(c.Ob(0,"div",16),c.Mb(1,"ion-spinner",17),c.Ob(2,"div"),c.wc(3," Cargando rutas... "),c.Mb(4,"br"),c.Nb(),c.Nb())}function g(t,e){1&t&&(c.Ob(0,"div",18),c.Ob(1,"div",19),c.Ob(2,"div",20),c.Mb(3,"img",21),c.Nb(),c.wc(4," A\xfan no tiene viajes creados "),c.Mb(5,"br"),c.Nb(),c.Nb())}function m(t,e){if(1&t){const t=c.Pb();c.Ob(0,"ion-item-sliding"),c.Ob(1,"ion-item",22),c.Wb("click",function(){c.pc(t);const r=e.$implicit;return c.Yb(2).interfaz(r._id)}),c.Ob(2,"ion-avatar",23),c.Mb(3,"img",24),c.Nb(),c.Ob(4,"ion-label",25),c.Ob(5,"div",26),c.wc(6),c.Nb(),c.Ob(7,"div",27),c.Ob(8,"strong"),c.wc(9),c.Nb(),c.Nb(),c.Nb(),c.Nb(),c.Ob(10,"ion-item-options",28),c.Ob(11,"ion-item-option",29),c.Wb("click",function(){c.pc(t);const r=e.$implicit,o=e.index;return c.Yb(2).eliminar(r,o)}),c.Mb(12,"ion-icon",30),c.Nb(),c.Nb(),c.Nb()}if(2&t){const t=e.$implicit;c.Ab(6),c.xc(t.nombre),c.Ab(3),c.yc("",t.kilometros," Km")}}function v(t,e){if(1&t){const t=c.Pb();c.Ob(0,"ion-infinite-scroll",31,32),c.Wb("ionInfinite",function(e){return c.pc(t),c.Yb(2).loadData(e)}),c.Mb(2,"ion-infinite-scroll-content",33),c.Nb()}}function j(t,e){if(1&t){const t=c.Pb();c.Ob(0,"div"),c.Ob(1,"ion-searchbar",7),c.Wb("ionChange",function(e){return c.pc(t),c.Yb().buscar(e)}),c.Nb(),c.vc(2,f,5,0,"div",8),c.Mb(3,"div",9),c.vc(4,g,6,0,"div",10),c.vc(5,m,13,2,"ion-item-sliding",11),c.vc(6,v,3,0,"ion-infinite-scroll",12),c.Ob(7,"ion-fab",13),c.Ob(8,"ion-fab-button",14),c.Wb("click",function(){return c.pc(t),c.Yb().crearViajes()}),c.Mb(9,"ion-icon",15),c.Nb(),c.Nb(),c.Nb()}if(2&t){const t=c.Yb();c.Ab(2),c.fc("ngIf",!t.cargado),c.Ab(2),c.fc("ngIf",t.cargado&&0===t.viajes.length),c.Ab(1),c.fc("ngForOf",t.viajes),c.Ab(1),c.fc("ngIf",t.cargado)}}const O=[{path:"",component:(()=>{class t{constructor(t,e,r,o,i,a,s){this.almacenamiento=t,this.apiUsuario=e,this.toast=r,this.apigrupo=o,this.router=i,this.active=a,this.alert=s,this.viajes=[],this.cargado=!1,this.patron="",this.desde=0,this.prod=!0,this.load=!1,this.mostrar=!1}ngOnInit(){}ionViewWillEnter(){this.ginfo()}refrescando(t){this.cargado=!1,this.ginfo().then(()=>{t.target.complete()}).catch(()=>{t.target.complete()})}crearViajes(){this.router.navigate(["/interfaz-grupo",this.active.snapshot.paramMap.get("grupo"),"rutas",this.active.snapshot.paramMap.get("grupo"),"viajes",this.active.snapshot.paramMap.get("grupo")])}interfaz(t){this.router.navigate(["/interfaz-grupo",this.active.snapshot.paramMap.get("grupo"),"rutas",this.active.snapshot.paramMap.get("grupo"),"viajes",this.active.snapshot.paramMap.get("grupo"),t])}ginfo(){return Object(n.a)(this,void 0,void 0,function*(){const t=yield this.almacenamiento.obtenerToken();t&&(this.load=!0,this.id=t._id,this.apigrupo.integrantes(t.token,{id:this.active.snapshot.paramMap.get("grupo")}).subscribe(t=>{console.log(t),t.exe?(this.grupo=t.response[0],this.grupo.integrantes.filter(t=>t._id===this.id).length>0?(this.mostrar=!0,this.listar()):this.mostrar=!1,console.log(t)):this.toast.toastError("No se pudo consultar la informaci\xf3n, int\xe9ntelo m\xe1s tarde"),this.cargado=!0},t=>{this.toast.toastError("No se pudo consultar la informaci\xf3n, int\xe9ntelo m\xe1s tarde"),this.cargado=!0}))})}listar(){return Object(n.a)(this,void 0,void 0,function*(){const t=yield this.almacenamiento.obtenerToken();t&&this.apigrupo.viajeBuscar(t.token,{desde:this.desde,grupo:this.active.snapshot.paramMap.get("grupo")}).subscribe(t=>{console.log(t),t.exe?this.viajes=t.response:this.toast.toastError("No se pudo consultar los viajes, int\xe9ntelo m\xe1s tarde"),this.cargado=!0},t=>{this.toast.toastError("No se pudo consultar los viajes, int\xe9ntelo m\xe1s tarde"),this.cargado=!0})})}buscar(t){return Object(n.a)(this,void 0,void 0,function*(){if(""!==t.detail.value){this.desde=0,this.infinite.disabled=!1,this.patron=t.detail.value;const e=yield this.almacenamiento.obtenerToken();e&&this.apigrupo.viajeBuscar(e.token,{grupo:this.active.snapshot.paramMap.get("grupo"),desde:this.desde,patron:this.patron}).subscribe(t=>{t.exe?(this.viajes=t.response,0===t.response.length&&(this.desde=0)):this.toast.toastError("No se pudo realizar la b\xfasqueda, intentelo m\xe1s tarde")},t=>{this.toast.toastError("No se pudo realizar la b\xfasqueda, intentelo m\xe1s tarde")})}else this.desde=0,this.listar()})}loadData(t){return Object(n.a)(this,void 0,void 0,function*(){this.desde=this.desde+5;const e=yield this.almacenamiento.obtenerToken();e&&(""===this.patron?this.apigrupo.viajeBuscar(e.token,{grupo:this.active.snapshot.paramMap.get("grupo"),desde:this.desde}).subscribe(e=>{e.exe?e.response.length>0?(e.response.forEach(t=>{this.viajes.push(t)}),t.target.complete()):(t.target.disabled=!0,this.desde=0):this.toast.toastError("No se pudo traer los viajes, int\xe9ntelo m\xe1s tarde.")},t=>{this.toast.toastError("No se pudo traer los viajes, int\xe9ntelo m\xe1s tarde.")}):this.apigrupo.leerProducto(e.token,{grupo:this.active.snapshot.paramMap.get("grupo"),desde:this.desde}).subscribe(e=>{e.exe?e.response.length>0?(e.response.forEach(t=>{this.viajes.push(t)}),t.target.complete()):(t.target.disabled=!0,this.desde=0):this.toast.toastError("No se pudo realizar la b\xfasqueda, intentelo m\xe1s tarde")},t=>{this.toast.toastError("No se pudo realizar la b\xfasqueda, intentelo m\xe1s tarde")}))})}eliminar(t,e){return Object(n.a)(this,void 0,void 0,function*(){const r=yield this.alert.create({header:"Atenci\xf3n!",message:"\xbfQuieres eliminar este viajede forma permanente? si ya lo terminaste esos jilometros no se borrar\xe1n para el grupo",buttons:[{text:"Cancelar",role:"cancel",cssClass:"cancelarAlerta"},{text:"Sacar",cssClass:"botonalerta",handler:()=>{this.almacenamiento.obtenerToken().then(r=>{this.apigrupo.viajechao(r.token,{id:t._id}).subscribe(t=>{console.log(t),t.exe&&this.viajes.splice(e,1)},t=>{console.log(t),this.toast.toastError("No se pudo eliminar el viaje, int\xe9ntelo m\xe1s tarde")})}).catch(t=>{this.toast.toastError("No se pudo eliminar el viaje, int\xe9ntelo m\xe1s tarde")})}}]});yield r.present()})}}return t.\u0275fac=function(e){return new(e||t)(c.Lb(p.a),c.Lb(h.a),c.Lb(l.a),c.Lb(u.a),c.Lb(s.g),c.Lb(s.a),c.Lb(a.b))},t.\u0275cmp=c.Fb({type:t,selectors:[["app-interfaz-grupo-rutas"]],viewQuery:function(t,e){if(1&t&&c.Ac(d,1),2&t){let t;c.oc(t=c.Xb())&&(e.infinite=t.first)}},decls:9,vars:2,consts:[["color","oscuro"],["slot","fixed","pullFactor","0.5","pullMin","50","pullMax","150",3,"ionRefresh"],["pullingIcon","arrow-dropdown","refreshingSpinner","circles"],["class","fcenter",4,"ngIf"],[4,"ngIf"],[1,"fcenter"],["src","/assets/No.png","width","100px","alt",""],["debounce","300","mode","ios","placeholder","Buscar rutas",3,"ionChange"],["class","flcenter ion-padding",4,"ngIf"],[1,"divider","light"],["class","flcenter",4,"ngIf"],[4,"ngFor","ngForOf"],["threshold","100px",3,"ionInfinite",4,"ngIf"],["vertical","bottom","horizontal","end","slot","fixed"],["color","oscuro",3,"click"],["name","add-outline"],[1,"flcenter","ion-padding"],["name","crescent","color","oscuro"],[1,"flcenter"],[1,"ion-padding"],[1,"ct"],["src","/assets/Rutas.png","width","80px","alt",""],[3,"click"],["slot","start"],["src","/assets/Rutas.png","alt",""],[1,"ion-text-wrap"],[1,"nombre"],[1,"az"],["side","end"],["color","danger",3,"click"],["name","trash","slot","icon-only"],["threshold","100px",3,"ionInfinite"],["inifinito",""],["loadingSpinner","bubbles","loadingText","Cargando Viajes..."]],template:function(t,e){1&t&&(c.Ob(0,"ion-header"),c.Ob(1,"ion-toolbar",0),c.Ob(2,"ion-title"),c.wc(3,"Viajes"),c.Nb(),c.Nb(),c.Nb(),c.Ob(4,"ion-content"),c.Ob(5,"ion-refresher",1),c.Wb("ionRefresh",function(t){return e.refrescando(t)}),c.Mb(6,"ion-refresher-content",2),c.Nb(),c.vc(7,b,4,0,"div",3),c.vc(8,j,10,4,"div",4),c.Nb()),2&t&&(c.Ab(7),c.fc("ngIf",e.cargado&&!e.mostrar),c.Ab(1),c.fc("ngIf",e.cargado&&e.mostrar))},directives:[a.z,a.lb,a.jb,a.t,a.Q,a.R,o.j,a.U,a.yb,o.i,a.v,a.w,a.A,a.cb,a.J,a.F,a.f,a.K,a.I,a.H,a.C,a.D],styles:[".fcenter[_ngcontent-%COMP%], .flcenter[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;flex-direction:column;text-align:center}.fcenter[_ngcontent-%COMP%]{margin:50px auto;width:300px}.az[_ngcontent-%COMP%]{color:var(--ion-color-verde)}"]}),t})()}];let w=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=c.Jb({type:t}),t.\u0275inj=c.Ib({imports:[[s.j.forChild(O)],s.j]}),t})(),x=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=c.Jb({type:t}),t.\u0275inj=c.Ib({imports:[[o.b,i.e,a.mb,w]]}),t})()},vLoH:function(t,e,r){"use strict";r.d(e,"a",function(){return g});var o=r("tk/3"),i=r("PqYM"),a=r("Cfvw"),s=r("coGc"),n=r("lJxs"),c=r("IzEk"),p=r("MtjB"),h=r("JIr8"),l=r("AytR"),u=r("fXoL"),d=r("B7Rs"),b=r("fsfq"),f=r("TEn/");let g=(()=>{class t{constructor(t,e,r,o){this.http=t,this.transfer=e,this.almacenamiento=r,this.navCtrl=o}hanflerError(t){let e=0;return t.pipe(Object(s.a)(()=>Object(i.a)(5e3)),Object(n.a)(t=>{if(e++,console.log("Entramos a intentos"),t instanceof ErrorEvent){if(3===e)throw new Error("Error de Red")}else{if(!(t instanceof ProgressEvent))throw 404===t.status?new Error(" al realizar la solicictud "):401===t.status?(this.almacenamiento.terminarPartida().then(()=>{this.navCtrl.navigateRoot("/home")}),new Error("No tiene permisos para realizar la petici\xf3n ")):(console.log(t,"Error de servidor"),new Error(" No se pudo realizar la petici\xf3n, intentalo m\xe1s tarde "));if(3===e)throw new Error("Error de Red")}}),Object(c.a)(3))}crearGrupo(t,e){const r={headers:new o.c({"x-token":t})};return this.http.post(`${l.a}/grupos/crear`,e,r).pipe(Object(p.a)(t=>this.hanflerError(t)))}listarGrupos(t,e){const r={headers:new o.c({"x-token":t})};return this.http.put(`${l.a}/grupos/lista`,e,r).pipe(Object(p.a)(t=>this.hanflerError(t)))}info(t,e){const r={headers:new o.c({"x-token":t})};return this.http.put(`${l.a}/grupos/info`,e,r).pipe(Object(p.a)(t=>this.hanflerError(t)))}integrantes(t,e){const r={headers:new o.c({"x-token":t})};return this.http.put(`${l.a}/grupos/integrantes`,e,r).pipe(Object(p.a)(t=>this.hanflerError(t)))}fotoPerfilUsuarioMoto(t,e,r,o){const i={fileKey:"archivo",httpMethod:"PUT",headers:{"x-token":t,"x-id":o},params:{tipo:r}},s=this.transfer.create();return Object(a.a)(s.upload(e,`${l.a}/upload/grupos`,i)).pipe(Object(h.a)(t=>{throw console.log("No se pudo subir la imagen "),new Error("No se pudo subir la imagen ")}))}subirweb(t,e,r){const i={headers:new o.c({"x-token":t,"x-id":r})};return this.http.put(`${l.a}/upload/grupos`,e,i).pipe(Object(p.a)(t=>this.hanflerError(t)))}leerProducto(t,e){const r={headers:new o.c({"x-token":t})};return this.http.put(`${l.a}/grupos/filtrar`,e,r).pipe(Object(p.a)(t=>this.hanflerError(t)))}chat(t,e){const r={headers:new o.c({"x-token":t})};return this.http.put(`${l.a}/grupos/chat`,e,r).pipe(Object(p.a)(t=>this.hanflerError(t)))}descarga(t,e){return this.http.get(`https://api.mapbox.com/directions/v5/mapbox/driving-traffic/${e.coordsIniciales.lng},${e.coordsIniciales.lat};${e.coordsFinales.lng},${e.coordsFinales.lat}?geometries=geojson&steps=true&language=es&access_token=${t}`).pipe(Object(p.a)(t=>this.hanflerError(t)))}dibujar(t,e){return this.http.get(`https://api.mapbox.com/directions/v5/mapbox/driving-traffic/${e.lng},${e.lat};${e.lngf},${e.latf}?geometries=geojson&steps=true&language=es&access_token=${t}`).pipe(Object(p.a)(t=>this.hanflerError(t)))}viaje(t,e){const r={headers:new o.c({"x-token":t})};return this.http.post(`${l.a}/grupos/viajes`,e,r).pipe(Object(p.a)(t=>this.hanflerError(t)))}irgrupo(t,e){const r={headers:new o.c({"x-token":t})};return this.http.put(`${l.a}/grupos/bu`,e,r).pipe(Object(p.a)(t=>this.hanflerError(t)))}podio(t,e){const r={headers:new o.c({"x-token":t})};return this.http.put(`${l.a}/grupos/podio`,e,r).pipe(Object(p.a)(t=>this.hanflerError(t)))}tabla(t,e){const r={headers:new o.c({"x-token":t})};return this.http.put(`${l.a}/grupos/tabla`,e,r).pipe(Object(p.a)(t=>this.hanflerError(t)))}viajechao(t,e){const r={headers:new o.c({"x-token":t})};return this.http.put(`${l.a}/grupos/viajes/eliminar`,e,r).pipe(Object(p.a)(t=>this.hanflerError(t)))}fotospodio(t,e){const r={headers:new o.c({"x-token":t})};return this.http.put(`${l.a}/grupos/podio/fotos`,e,r).pipe(Object(p.a)(t=>this.hanflerError(t)))}viajeBuscarUno(t,e){const r={headers:new o.c({"x-token":t})};return this.http.put(`${l.a}/grupos/buscar`,e,r).pipe(Object(p.a)(t=>this.hanflerError(t)))}viajeBuscar(t,e){const r={headers:new o.c({"x-token":t})};return this.http.put(`${l.a}/grupos/viajes/filtrar`,e,r).pipe(Object(p.a)(t=>this.hanflerError(t)))}fotoviaje(t,e,r){const o={fileKey:"archivo",httpMethod:"PUT",headers:{"x-token":e,"x-viaje":r}},i=this.transfer.create();return Object(a.a)(i.upload(t,`${l.a}/grupos/viaje/upload`,o)).pipe(Object(h.a)(t=>{throw new Error("No se pudo subir la imagen ")}))}subirweb2(t,e,r){const i={headers:new o.c({"x-token":t,"x-viaje":r})};return this.http.put(`${l.a}/grupos/viaje/upload`,e,i).pipe(Object(p.a)(t=>this.hanflerError(t)))}fotosviaje(t,e){const r={headers:new o.c({"x-token":t})};return this.http.put(`${l.a}/grupos/viaje/fotos`,e,r).pipe(Object(p.a)(t=>this.hanflerError(t)))}destino(t,e){const r={headers:new o.c({"x-token":t})};return this.http.put(`${l.a}/grupos/viaje/destino`,e,r).pipe(Object(p.a)(t=>this.hanflerError(t)))}eliminarviaje(t,e){const r={headers:new o.c({"x-token":t})};return this.http.put(`${l.a}/grupos/viaje/eliminar`,e,r).pipe(Object(p.a)(t=>this.hanflerError(t)))}eliminarFoto(t,e){const r={headers:new o.c({"x-token":t})};return this.http.put(`${l.a}/grupos/viaje/eliminarfoto`,e,r).pipe(Object(p.a)(t=>this.hanflerError(t)))}km(t,e){const r={headers:new o.c({"x-token":t})};return this.http.put(`${l.a}/grupos/km`,e,r).pipe(Object(p.a)(t=>this.hanflerError(t)))}}return t.\u0275fac=function(e){return new(e||t)(u.Sb(o.a),u.Sb(d.a),u.Sb(b.a),u.Sb(f.rb))},t.\u0275prov=u.Hb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})()}}]);