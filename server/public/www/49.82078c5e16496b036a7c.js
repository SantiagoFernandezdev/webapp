(window.webpackJsonp=window.webpackJsonp||[]).push([[49],{"+Hj7":function(t,e,i){"use strict";i.r(e),i.d(e,"InicioTicketsPageModule",function(){return N});var a=i("ofXK"),n=i("3Pt+"),o=i("TEn/"),r=i("tyNb"),s=i("mrSG"),c=i("HDdC"),d=i("fXoL"),l=i("fsfq"),b=i("fmoy"),u=i("+WxW"),h=i("7JkF"),p=i("OKd0");function f(t,e){if(1&t&&(d.Mb(0,"div",9),d.Kb(1,"ion-spinner",10),d.Mb(2,"div"),d.rc(3," Configurando sistema de turno para "),d.Kb(4,"br"),d.Mb(5,"strong"),d.rc(6),d.Lb(),d.Lb(),d.Lb()),2&t){const t=d.Wb();d.zb(6),d.tc(" ",t.usuario,"")}}function g(t,e){1&t&&(d.Mb(0,"ion-label"),d.rc(1,"Apagar mi sala de turnos"),d.Lb())}function m(t,e){1&t&&(d.Mb(0,"ion-label"),d.rc(1,"Encender mi sala de turnos"),d.Lb())}function k(t,e){if(1&t){const t=d.Nb();d.Mb(0,"ion-list"),d.Mb(1,"ion-item",11),d.qc(2,g,2,0,"ion-label",5),d.qc(3,m,2,0,"ion-label",5),d.Mb(4,"ion-toggle",12),d.Ub("ionChange",function(e){return d.lc(t),d.Wb().cambiar(e)}),d.Lb(),d.Lb(),d.Lb()}if(2&t){const t=d.Wb();d.zb(2),d.dc("ngIf",t.habilitado),d.zb(1),d.dc("ngIf",!t.habilitado),d.zb(1),d.dc("checked",t.habilitado)}}function v(t,e){1&t&&(d.Mb(0,"div",9),d.Mb(1,"div"),d.rc(2," A\xfan no tiene salas creadas "),d.Kb(3,"br"),d.Lb(),d.Lb())}function x(t,e){1&t&&(d.Mb(0,"strong"),d.rc(1,"Libre"),d.Lb())}function E(t,e){1&t&&(d.Mb(0,"strong"),d.rc(1,"Ocupada"),d.Lb())}function M(t,e){if(1&t&&(d.Mb(0,"div"),d.Mb(1,"strong"),d.rc(2,"Dureci\xf3n estimada del trabajo:"),d.Lb(),d.rc(3),d.Xb(4,"diferencia"),d.Lb()),2&t){const t=d.Wb().$implicit;d.zb(3),d.tc(" ",d.ac(4,1,t.fechainicio,t.fechafinal,1),"")}}function L(t,e){if(1&t&&(d.Mb(0,"div"),d.Mb(1,"strong"),d.rc(2,"Tiempo transcurrido:"),d.Lb(),d.rc(3),d.Xb(4,"diferencia"),d.Lb()),2&t){const t=d.Wb().$implicit;d.zb(3),d.tc(" ",d.ac(4,1,t.fechainicio,t.fechafinal,2),"")}}function j(t,e){if(1&t){const t=d.Nb();d.Mb(0,"div",18),d.Mb(1,"ion-button",19),d.Ub("click",function(){d.lc(t);const e=d.Wb().$implicit;return d.Wb(2).navegar(e.ticket._id)}),d.rc(2,"Chat"),d.Lb(),d.Lb()}}function O(t,e){if(1&t){const t=d.Nb();d.Mb(0,"div",18),d.Mb(1,"ion-button",19),d.Ub("click",function(){d.lc(t);const e=d.Wb().$implicit;return d.Wb(2).finalizar(e)}),d.rc(2,"Finalizar Ticket"),d.Lb(),d.Lb()}}function w(t,e){if(1&t){const t=d.Nb();d.Mb(0,"ion-card",15),d.Ub("click",function(){d.lc(t);const i=e.$implicit;return d.Wb(2).salon(i)}),d.Mb(1,"ion-card-title"),d.rc(2),d.Lb(),d.Mb(3,"div",16),d.qc(4,x,2,0,"strong",5),d.qc(5,E,2,0,"strong",5),d.Lb(),d.Mb(6,"ion-card-content"),d.Mb(7,"div"),d.Mb(8,"strong"),d.rc(9,"Persona que atiende:"),d.Lb(),d.rc(10),d.Lb(),d.Kb(11,"br"),d.qc(12,M,5,5,"div",5),d.qc(13,L,5,5,"div",5),d.Kb(14,"br"),d.qc(15,j,3,0,"div",17),d.qc(16,O,3,0,"div",17),d.Lb(),d.Lb()}if(2&t){const t=e.$implicit,i=e.index;d.zb(2),d.tc("Sala ",i+1," "),d.zb(1),d.Bb("ocupado",t.ocupada)("desocupado",!t.ocupada),d.zb(1),d.dc("ngIf",!t.ocupada),d.zb(1),d.dc("ngIf",t.ocupada),d.zb(5),d.tc(" ",t.atiende,""),d.zb(2),d.dc("ngIf",""!==t.fechainicio&&t.ocupada),d.zb(1),d.dc("ngIf",""!==t.fechainicio&&t.ocupada),d.zb(2),d.dc("ngIf",t.ocupada),d.zb(1),d.dc("ngIf",t.ocupada)}}function z(t,e){if(1&t&&(d.Mb(0,"div",13),d.qc(1,v,4,0,"div",4),d.qc(2,w,17,12,"ion-card",14),d.Lb()),2&t){const t=d.Wb();d.zb(1),d.dc("ngIf",0===t.salas.length),d.zb(1),d.dc("ngForOf",t.salas)}}function C(t,e){if(1&t){const t=d.Nb();d.Mb(0,"ion-fab",20),d.Mb(1,"ion-fab-button",21),d.Ub("click",function(){return d.lc(t),d.Wb().crear()}),d.Kb(2,"ion-icon",22),d.Lb(),d.Lb()}}const y=[{path:"",component:(()=>{class t{constructor(t,e,i,a,n,o){this.almacenamiento=t,this.toast=e,this.apiTickets=i,this.alert=a,this.router=n,this.socket=o,this.configurando=!1,this.usuario="",this.habilitado=!1,this.cargado=!1,this.id="",this.salas=[],this.escucharMensajes().subscribe(t=>{t.msg?(this.salas.forEach(e=>{e._id===t.id&&(e.ocupada=!1,e.info=!1)}),this.toast.toastExitoso("Ticket Finalizado")):this.toast.toastError("No se pudo finalizar el ticket, int\xe9ntelo m\xe1s tarde")})}ngOnInit(){}ionViewWillEnter(){this.disponibilidad(),this.almacenamiento.insertarTicket("entrando").then(t=>{if(t)return!0})}refrescando(t){this.salas=[],this.disponibilidad().then(()=>{t.detail.complete()}).catch(()=>{t.detail.complete()})}disponibilidad(){return Object(s.a)(this,void 0,void 0,function*(){const t=yield this.almacenamiento.obtenerToken();t&&("USER_ROLE"===t.role?this.router.navigate(["/central/menu"]):(this.socket.emit("ticket",{id:t._id}),this.usuario=t.nombre,this.apiTickets.disponibilidad(t.token).subscribe(t=>{t.exe?"no"===t.response?this.alerta():(this.cargado=!0,this.habilitado=t.data[0].estado,this.id=t.data[0]._id,this.misSalas()):(this.toast.toastError("No se pudo consultar la disponibilidad, int\xe9ntelo m\xe1s tarde"),this.router.navigate(["/central/menu/"]))},t=>{this.toast.toastError("No se pudo consultar la disponibilidad, int\xe9ntelo m\xe1s tarde"),this.router.navigate(["/central/menu/"])})))})}Creardisponibilidad(){return Object(s.a)(this,void 0,void 0,function*(){this.configurando=!0;const t=yield this.almacenamiento.obtenerToken();t&&this.apiTickets.Creardisponibilidad(t.token).subscribe(t=>{t.exe?(this.toast.toastExitoso("Configuraci\xf3n realizada correcxtamente, ya puedes disfrutar de este m\xf3dulo"),this.disponibilidad()):(this.toast.toastError("No se pudo configurar tu sala de turnos, int\xe9ntelo m\xe1s tarde"),this.router.navigate(["/central/menu/"])),this.configurando=!1},t=>{this.toast.toastError("No se pudo configurar tu sala de turnos, int\xe9ntelo m\xe1s tarde"),this.router.navigate(["/central/menu/"]),this.configurando=!1})})}alerta(){return Object(s.a)(this,void 0,void 0,function*(){const t=yield this.alert.create({header:"Configurar sistema de turnos",message:"A\xfan no has comenzado a usar este m\xf3dulo, si quieres empezar a crear tus salas de turno puedes dar click en configurar",buttons:[{text:"Cancelar",cssClass:"cancelarAlerta",role:"cancel",handler:()=>{this.router.navigate(["/central/menu/"])}},{text:"Configurar",cssClass:"botonalerta",handler:()=>{this.Creardisponibilidad()}}]});yield t.present()})}cambiar(t){return Object(s.a)(this,void 0,void 0,function*(){this.configurando=!0;const e=yield this.almacenamiento.obtenerToken();e&&this.apiTickets.editardisponibilidad(e.token,{id:this.id,estado:t.detail.checked}).subscribe(t=>{t.exe?this.habilitado=t.response.estado:(this.toast.toastError("No se pudo configurar tu sala de turnos, int\xe9ntelo m\xe1s tarde"),this.router.navigate(["/central/menu/"])),this.configurando=!1},t=>{this.toast.toastError("No se pudo configurar tu sala de turnos, int\xe9ntelo m\xe1s tarde"),this.router.navigate(["/central/menu/"]),this.configurando=!1})})}crear(){return Object(s.a)(this,void 0,void 0,function*(){const t=yield this.alert.create({header:"Crear sala",message:"Por medio de una sala puedes atender los usuarios que esten esperando en la fila, crea tus salas dependiendo de la capacidad del negocio.",inputs:[{type:"text",placeholder:"Persona que atiende",name:"persona"}],buttons:[{text:"Cancelar",cssClass:"cancelarAlerta",role:"cancel"},{text:"Crear Sala",cssClass:"botonalerta",handler:t=>{this.CrearSala({persona:t.persona})}}]});yield t.present()})}misSalas(){return Object(s.a)(this,void 0,void 0,function*(){this.configurando=!0;const t=yield this.almacenamiento.obtenerToken();t&&this.apiTickets.misSalas(t.token).subscribe(t=>{t.exe?this.salas=t.response:(this.toast.toastError("No se pudo traer las salas, int\xe9ntelo m\xe1s tarde"),this.router.navigate(["/central/menu/"])),this.configurando=!1},t=>{this.toast.toastError("No se pudo traer las salas, int\xe9ntelo m\xe1s tarde"),this.router.navigate(["/central/menu/"]),this.configurando=!1})})}CrearSala(t){return Object(s.a)(this,void 0,void 0,function*(){this.configurando=!0;const e=yield this.almacenamiento.obtenerToken();e&&this.apiTickets.crearSala(e.token,t).subscribe(t=>{t.exe?(this.toast.toastExitoso("La sala se cre\xf3 correctamente"),this.salas.push(t.response)):(this.toast.toastError("No se pudo crear la sala, int\xe9ntelo m\xe1s tarde"),this.router.navigate(["/central/menu/"])),this.configurando=!1},t=>{this.toast.toastError("No se pudo crear la sala, int\xe9ntelo m\xe1s tarde"),this.router.navigate(["/central/menu/"]),this.configurando=!1})})}salon(t){t.ocupada||this.router.navigate(["/central/tickets",this.id,"ticketsala",t._id])}escucharMensajes(){return new c.a(t=>{this.socket.on("mensajeTicket",e=>{t.next(e)})})}finalizar(t){return Object(s.a)(this,void 0,void 0,function*(){const e=yield this.almacenamiento.obtenerToken();e&&this.socket.emit("finalizar",{idtaller:e._id,id:t._id,ticket:t.ticket._id})})}navegar(t){return Object(s.a)(this,void 0,void 0,function*(){const e=yield this.almacenamiento.obtenerToken();e&&this.apiTickets.consultarSala(e.token,{ticket:t}).subscribe(t=>{t.exe&&t.response.length>0?t.response[0].accesos.length>0?this.almacenamiento.insertarChat(t.response[0]).then(()=>{this.router.navigate(["/central/chats/chat"])}).catch(()=>{this.toast.toastError("No se puede acceder al chat, int\xe9ntelo m\xe1s tarde")}):this.toast.Especial("El ticket fue cancelado, ya no puede acceder al chat"):this.toast.toastError("No se puede acceder al chat, int\xe9ntelo m\xe1s tarde")},t=>{this.toast.toastError("No se puede acceder al chat, int\xe9ntelo m\xe1s tarde")})})}ionViewWillLeave(){this.almacenamiento.eleminarTicket().then(t=>{if(t)return!0})}}return t.\u0275fac=function(e){return new(e||t)(d.Jb(l.a),d.Jb(b.a),d.Jb(u.a),d.Jb(o.b),d.Jb(r.g),d.Jb(h.a))},t.\u0275cmp=d.Db({type:t,selectors:[["app-inicio-tickets"]],decls:13,vars:4,consts:[["color","oscuro"],["slot","start","icon","chevron-back-outline","defaultHref","/central/menu"],["slot","fixed","pullFactor","0.5","pullMin","50","pullMax","150",3,"ionRefresh"],["pullingIcon","arrow-dropdown","refreshingSpinner","circles"],["class","flcenter ion-padding",4,"ngIf"],[4,"ngIf"],[1,"divider","light"],["class","salas",4,"ngIf"],["vertical","bottom","horizontal","end","slot","fixed",4,"ngIf"],[1,"flcenter","ion-padding"],["name","crescent","color","oscuro"],["lines","none","color","light"],["slot","end","mode","ios","color","barra",3,"checked","ionChange"],[1,"salas"],["mode","ios",3,"click",4,"ngFor","ngForOf"],["mode","ios",3,"click"],[1,"msg"],["class","botones",4,"ngIf"],[1,"botones"],["mode","ios","color","light","expand","block",3,"click"],["vertical","bottom","horizontal","end","slot","fixed"],["color","oscuro",3,"click"],["name","add"]],template:function(t,e){1&t&&(d.Mb(0,"ion-header"),d.Mb(1,"ion-toolbar",0),d.Kb(2,"ion-back-button",1),d.Mb(3,"ion-title"),d.rc(4,"Turnos"),d.Lb(),d.Lb(),d.Lb(),d.Mb(5,"ion-content"),d.Mb(6,"ion-refresher",2),d.Ub("ionRefresh",function(t){return e.refrescando(t)}),d.Kb(7,"ion-refresher-content",3),d.Lb(),d.qc(8,f,7,1,"div",4),d.qc(9,k,5,3,"ion-list",5),d.Kb(10,"div",6),d.qc(11,z,3,2,"div",7),d.qc(12,C,3,0,"ion-fab",8),d.Lb()),2&t&&(d.zb(8),d.dc("ngIf",e.configurando),d.zb(1),d.dc("ngIf",e.cargado),d.zb(2),d.dc("ngIf",e.cargado),d.zb(1),d.dc("ngIf",e.cargado))},directives:[o.z,o.jb,o.g,o.h,o.hb,o.t,o.P,o.Q,a.j,o.bb,o.L,o.F,o.ib,o.d,o.K,a.i,o.l,o.p,o.m,o.j,o.v,o.w,o.A],pipes:[p.a],styles:[".flcenter[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:center;align-items:center;font-size:18px;text-align:center}ion-card[_ngcontent-%COMP%]{position:relative}.msg[_ngcontent-%COMP%]{position:absolute;top:0;right:0;text-align:center;padding:5px 10px;border-radius:10px}ion-card-title[_ngcontent-%COMP%]{width:100%;padding:5px 15px}.ocupado[_ngcontent-%COMP%]{background-color:#ca0900!important;color:#fff}.desocupado[_ngcontent-%COMP%]{background-color:#819830!important;color:#fff}"]}),t})()}];let T=(()=>{class t{}return t.\u0275mod=d.Hb({type:t}),t.\u0275inj=d.Gb({factory:function(e){return new(e||t)},imports:[[r.i.forChild(y)],r.i]}),t})();var I=i("iTUp");let N=(()=>{class t{}return t.\u0275mod=d.Hb({type:t}),t.\u0275inj=d.Gb({factory:function(e){return new(e||t)},imports:[[a.b,n.e,o.kb,T,I.a]]}),t})()},"+WxW":function(t,e,i){"use strict";i.d(e,"a",function(){return u});var a=i("AytR"),n=i("tk/3"),o=i("coGc"),r=i("lJxs"),s=i("IzEk"),c=i("MtjB"),d=i("PqYM"),l=i("fXoL"),b=i("tyNb");let u=(()=>{class t{constructor(t,e){this.http=t,this.router=e}hanflerError(t){return t.pipe(Object(o.a)(()=>Object(d.a)(3e3)),Object(r.a)(t=>{if(console.log("Entramos a intentos"),t instanceof ErrorEvent)throw new Error("Error de Red");if(404===t.status)throw new Error(" P\xe1gina no encontrada");if(401===t.status)throw new Error(" No tiene permisos ")}),Object(s.a)(3))}disponibilidad(t){const e={headers:new n.c({"x-token":t})};return this.http.get(`${a.a}/ticket/disponibilidad`,e).pipe(Object(c.a)(t=>this.hanflerError(t)))}Creardisponibilidad(t){const e={headers:new n.c({"x-token":t})};return this.http.post(`${a.a}/ticket/disponibilidad`,{},e).pipe(Object(c.a)(t=>this.hanflerError(t)))}editardisponibilidad(t,e){const i={headers:new n.c({"x-token":t})};return this.http.put(`${a.a}/ticket/disponibilidad`,e,i).pipe(Object(c.a)(t=>this.hanflerError(t)))}crearSala(t,e){const i={headers:new n.c({"x-token":t})};return this.http.post(`${a.a}/ticket/salas`,e,i).pipe(Object(c.a)(t=>this.hanflerError(t)))}misSalas(t){const e={headers:new n.c({"x-token":t})};return this.http.get(`${a.a}/ticket/salas`,e).pipe(Object(c.a)(t=>this.hanflerError(t)))}crearTicket(t,e){const i={headers:new n.c({"x-token":t})};return this.http.post(`${a.a}/ticket/crear`,e,i).pipe(Object(c.a)(t=>this.hanflerError(t)))}misTickets(t){const e={headers:new n.c({"x-token":t})};return this.http.get(`${a.a}/ticket/lista`,e).pipe(Object(c.a)(t=>this.hanflerError(t)))}misTicketsLista(t,e){const i={headers:new n.c({"x-token":t})};return this.http.put(`${a.a}/ticket/lista/negocio`,e,i).pipe(Object(c.a)(t=>this.hanflerError(t)))}salasNegocio(t,e){const i={headers:new n.c({"x-token":t})};return this.http.put(`${a.a}/ticket/salas/usuario`,e,i).pipe(Object(c.a)(t=>this.hanflerError(t)))}disponibilidadnegocio(t,e){const i={headers:new n.c({"x-token":t})};return this.http.put(`${a.a}/ticket/disponibilidad/negocio`,e,i).pipe(Object(c.a)(t=>this.hanflerError(t)))}ticketsolo(t,e){const i={headers:new n.c({"x-token":t})};return this.http.put(`${a.a}/ticket/solo`,e,i).pipe(Object(c.a)(t=>this.hanflerError(t)))}ticketelimina(t,e){const i={headers:new n.c({"x-token":t})};return this.http.put(`${a.a}/ticket/eliminar`,e,i).pipe(Object(c.a)(t=>this.hanflerError(t)))}crearHoja(t,e){const i={headers:new n.c({"x-token":t})};return this.http.post(`${a.a}/hoja/dos`,e,i).pipe(Object(c.a)(t=>this.hanflerError(t)))}consultarSala(t,e){const i={headers:new n.c({"x-token":t})};return this.http.post(`${a.a}/ticket/consultar/chat`,e,i).pipe(Object(c.a)(t=>this.hanflerError(t)))}}return t.\u0275fac=function(e){return new(e||t)(l.Qb(n.a),l.Qb(b.g))},t.\u0275prov=l.Fb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})()}}]);