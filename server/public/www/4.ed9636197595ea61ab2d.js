(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{HavB:function(t,e,a){"use strict";a.d(e,"a",function(){return m});var s=a("AytR"),i=a("tk/3"),o=a("coGc"),n=a("lJxs"),r=a("IzEk"),c=a("MtjB"),h=a("JIr8"),p=a("PqYM"),d=a("Cfvw"),l=a("fXoL"),b=a("tyNb"),u=a("B7Rs");let m=(()=>{class t{constructor(t,e,a){this.http=t,this.router=e,this.MmyTransfer=a}hanflerError(t){return t.pipe(Object(o.a)(()=>Object(p.a)(3e3)),Object(n.a)(t=>{if(console.log("Entramos a intentos"),t instanceof ErrorEvent)throw new Error("Error de Red");if(404===t.status)throw new Error(" P\xe1gina no encontrada");if(401===t.status)throw new Error(" No tiene permisos ")}),Object(r.a)(3))}crearPedido(t,e){const a={headers:new i.c({"x-token":t})};return this.http.post(`${s.a}/pedidos/crear/`,e,a).pipe(Object(c.a)(t=>this.hanflerError(t)))}misPedido(t){const e={headers:new i.c({"x-token":t})};return this.http.get(`${s.a}/pedidos/lista/`,e).pipe(Object(c.a)(t=>this.hanflerError(t)))}misChats(t,e){const a={headers:new i.c({"x-token":t})};return this.http.post(`${s.a}/chats/lista/`,e,a).pipe(Object(c.a)(t=>this.hanflerError(t)))}misChatsGrupos(t,e){const a={headers:new i.c({"x-token":t})};return this.http.post(`${s.a}/chats/lista/grupos`,e,a).pipe(Object(c.a)(t=>this.hanflerError(t)))}misPedidoUsuario(t,e){const a={headers:new i.c({"x-token":t})};return this.http.post(`${s.a}/pedidos/lista/`,e,a).pipe(Object(c.a)(t=>this.hanflerError(t)))}misSalas(t){const e={headers:new i.c({"x-token":t})};return this.http.get(`${s.a}/ticket/salas`,e).pipe(Object(c.a)(t=>this.hanflerError(t)))}mensajes(t,e){const a={headers:new i.c({"x-token":t})};return this.http.post(`${s.a}/pedidos/chat`,e,a).pipe(Object(c.a)(t=>this.hanflerError(t)))}traermensajesNoVistos(t,e){const a={headers:new i.c({"x-token":t})};return this.http.post(`${s.a}/pedidos/chat/vistos`,e,a).pipe(Object(c.a)(t=>this.hanflerError(t)))}marcarvisto(t,e){const a={headers:new i.c({"x-token":t})};return this.http.put(`${s.a}/pedidos/chat/vistos`,e,a).pipe(Object(c.a)(t=>this.hanflerError(t)))}infoPedido(t,e){const a={headers:new i.c({"x-token":t})};return this.http.post(`${s.a}/pedidos/info`,e,a).pipe(Object(c.a)(t=>this.hanflerError(t)))}infoPedidoPut(t,e){const a={headers:new i.c({"x-token":t})};return this.http.put(`${s.a}/pedidos/info`,e,a).pipe(Object(c.a)(t=>this.hanflerError(t)))}crearEstados(t,e){const a={headers:new i.c({"x-token":t})};return this.http.post(`${s.a}/pedidos/estados`,e,a).pipe(Object(c.a)(t=>this.hanflerError(t)))}consultarEstados(t,e){const a={headers:new i.c({"x-token":t})};return this.http.put(`${s.a}/pedidos/estados`,e,a).pipe(Object(c.a)(t=>this.hanflerError(t)))}consultarChat(t,e){const a={headers:new i.c({"x-token":t})};return this.http.post(`${s.a}/unico/consultar/chat`,e,a).pipe(Object(c.a)(t=>this.hanflerError(t)))}consultarChatFotos(t,e){const a={headers:new i.c({"x-token":t})};return this.http.post(`${s.a}/unico/consultar/chat/fotos`,e,a).pipe(Object(c.a)(t=>this.hanflerError(t)))}consultarSala(t,e){const a={headers:new i.c({"x-token":t})};return this.http.post(`${s.a}/pedidos/consultar/chat`,e,a).pipe(Object(c.a)(t=>this.hanflerError(t)))}consultarMapa(t,e){const a={headers:new i.c({"x-token":t})};return this.http.post(`${s.a}/pedidos/consultar/mapa`,e,a).pipe(Object(c.a)(t=>this.hanflerError(t)))}consultarMapaUnico(t,e){const a={headers:new i.c({"x-token":t})};return this.http.post(`${s.a}/pedidos/consultar/mapa/unico`,e,a).pipe(Object(c.a)(t=>this.hanflerError(t)))}crearMapa(t,e){const a={headers:new i.c({"x-token":t})};return this.http.post(`${s.a}/pedidos/crear/mapa`,e,a).pipe(Object(c.a)(t=>this.hanflerError(t)))}editarMapa(t,e){const a={headers:new i.c({"x-token":t})};return this.http.put(`${s.a}/pedidos/editar/mapa`,e,a).pipe(Object(c.a)(t=>this.hanflerError(t)))}editarMapaInfo(t,e){const a={headers:new i.c({"x-token":t})};return this.http.put(`${s.a}/pedidos/editar/mapa/info`,e,a).pipe(Object(c.a)(t=>this.hanflerError(t)))}editarMapaInfoD(t,e){const a={headers:new i.c({"x-token":t})};return this.http.put(`${s.a}/pedidos/editar/mapa/infod`,e,a).pipe(Object(c.a)(t=>this.hanflerError(t)))}editarPedido(t,e){const a={headers:new i.c({"x-token":t})};return this.http.post(`${s.a}/pedidos/editar`,e,a).pipe(Object(c.a)(t=>this.hanflerError(t)))}editarChat(t,e){const a={headers:new i.c({"x-token":t})};return this.http.post(`${s.a}/chat/editar`,e,a).pipe(Object(c.a)(t=>this.hanflerError(t)))}subirArchivosChat(t,e,a,i,o,n,r){console.log("archivo",a);const c={fileKey:"archivo",fileName:n,mimeType:r,httpMethod:"PUT",headers:{"x-token":t,"x-sala":e,"x-final":i,"x-cont":o}},p=this.MmyTransfer.create();return Object(d.a)(p.upload(a,`${s.a}/pedido/upload`,c)).pipe(Object(h.a)(t=>{throw new Error(a)}))}subirweb(t,e,a,o,n){console.log(t,e,a,o);const r={headers:new i.c({"x-token":t,"x-sala":e,"x-final":a.toString(),"x-cont":o.toString()})};return this.http.put(`${s.a}/pedido/upload`,n,r).pipe(Object(c.a)(t=>this.hanflerError(t)))}}return t.\u0275fac=function(e){return new(e||t)(l.Qb(i.a),l.Qb(b.g),l.Qb(u.a))},t.\u0275prov=l.Fb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})()},SpuA:function(t,e,a){"use strict";a.d(e,"a",function(){return o});var s=a("wd/R"),i=a("fXoL");let o=(()=>{class t{transform(t){console.log(t,"fechin");let e=s.utc(t).toDate();return s(e).format("dddd, DD MMMM YYYY h:mm:a")}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275pipe=i.Ib({name:"cambioUTC",type:t,pure:!0}),t})()},wYDu:function(t,e,a){"use strict";a.r(e),a.d(e,"SalasChatPageModule",function(){return V});var s=a("ofXK"),i=a("3Pt+"),o=a("TEn/"),n=a("tyNb"),r=a("mrSG"),c=a("HDdC"),h=a("R0Ic"),p=a("69E9"),d=a("fXoL"),l=a("fsfq"),b=a("fmoy"),u=a("7JkF"),m=a("HavB"),g=a("cb8P"),f=a("SpuA"),v=a("Tsh3");const M=["contenido"];function j(t,e){1&t&&d.Kb(0,"ion-back-button",7)}function x(t,e){1&t&&d.Kb(0,"ion-back-button",8)}function O(t,e){if(1&t){const t=d.Nb();d.Mb(0,"ion-buttons",9),d.Mb(1,"ion-button",10),d.Ub("click",function(){return d.lc(t),d.Wb().gp()}),d.Kb(2,"ion-icon",11),d.Lb(),d.Lb()}}function k(t,e){if(1&t){const t=d.Nb();d.Mb(0,"ion-buttons",9),d.Mb(1,"ion-button",10),d.Ub("click",function(){return d.lc(t),d.Wb().dir()}),d.Kb(2,"ion-icon",11),d.Lb(),d.Lb()}}function w(t,e){if(1&t&&(d.Mb(0,"span",12),d.rc(1),d.Lb()),2&t){const t=d.Wb();d.zb(1),d.sc(t.sala.tipo)}}function E(t,e){if(1&t&&(d.Mb(0,"div"),d.rc(1),d.Lb()),2&t){const t=d.Wb();d.zb(1),d.sc(t.sala.creador.nombrecompleto)}}function _(t,e){if(1&t&&(d.Mb(0,"div"),d.rc(1),d.Lb()),2&t){const t=d.Wb();d.zb(1),d.sc(t.sala.taller.nombrecompleto)}}function C(t,e){if(1&t){const t=d.Nb();d.Mb(0,"ion-buttons",13),d.Mb(1,"ion-button",10),d.Ub("click",function(e){return d.lc(t),d.Wb().abrir(e)}),d.Kb(2,"ion-icon",14),d.Lb(),d.Lb()}}function I(t,e){if(1&t){const t=d.Nb();d.Mb(0,"ion-infinite-scroll",22,23),d.Ub("ionInfinite",function(e){return d.lc(t),d.Wb(2).cargaMensajesLimite(e)}),d.Kb(2,"ion-infinite-scroll-content",24),d.Lb()}}function P(t,e){1&t&&(d.Mb(0,"div",25),d.Kb(1,"ion-spinner",26),d.Kb(2,"br"),d.Mb(3,"strong"),d.rc(4,"Cargando mensajes..."),d.Lb(),d.Lb())}function L(t,e){if(1&t&&(d.Mb(0,"ion-avatar",31),d.Kb(1,"img",32),d.Lb()),2&t){const t=d.Wb().$implicit;d.zb(1),d.fc("src","https://www.motocaliapp.com/",t.creador.imagen[0].path,"",d.mc)}}function z(t,e){if(1&t&&(d.Mb(0,"div",40),d.rc(1),d.Lb()),2&t){const t=d.Wb(2).$implicit;d.zb(1),d.tc(" ",t.creador.nombrecompleto," ")}}function y(t,e){1&t&&(d.Mb(0,"div",41),d.rc(1," T\xfa "),d.Kb(2,"br"),d.Lb())}function $(t,e){if(1&t&&(d.Mb(0,"div",42),d.rc(1),d.Xb(2,"cambioUTC"),d.Lb()),2&t){const t=d.Wb(2).$implicit;d.zb(1),d.sc(d.Yb(2,1,t.fecha))}}function N(t,e){1&t&&d.Kb(0,"div",43)}function q(t,e){if(1&t&&(d.Mb(0,"div",48),d.rc(1),d.Lb()),2&t){const t=e.$implicit;d.zb(1),d.tc(" - ",t," ")}}function T(t,e){if(1&t&&(d.Mb(0,"div",48),d.rc(1),d.Lb()),2&t){const t=e.$implicit;d.zb(1),d.tc(" - ",t," ")}}function R(t,e){if(1&t&&(d.Mb(0,"div",44),d.Mb(1,"div",42),d.rc(2),d.Xb(3,"cambioUTC"),d.Lb(),d.Kb(4,"br"),d.Mb(5,"strong",45),d.rc(6,"Visto por: "),d.Lb(),d.Kb(7,"br"),d.qc(8,q,2,1,"div",46),d.Xb(9,"fchat"),d.Kb(10,"br"),d.Mb(11,"strong",47),d.rc(12,"No lo ha visto: "),d.Lb(),d.Kb(13,"br"),d.qc(14,T,2,1,"div",46),d.Xb(15,"fchat"),d.Lb()),2&t){const t=d.Wb(2).$implicit;d.zb(2),d.sc(d.Yb(3,3,t.fecha)),d.zb(6),d.dc("ngForOf",d.ac(9,5,t.accesos,t.vistos,2)),d.zb(6),d.dc("ngForOf",d.ac(15,9,t.accesos,t.vistos,1))}}function W(t,e){if(1&t&&(d.Mb(0,"div",33),d.qc(1,z,2,1,"div",34),d.qc(2,y,3,0,"div",35),d.Mb(3,"div",36),d.rc(4),d.Lb(),d.qc(5,$,3,3,"div",37),d.qc(6,N,1,0,"div",38),d.qc(7,R,16,13,"div",39),d.Lb()),2&t){const t=d.Wb().$implicit,e=d.Wb(2);d.zb(1),d.dc("ngIf",t.creador._id!==e.id),d.zb(1),d.dc("ngIf",t.creador._id===e.id),d.zb(2),d.tc(" ",t.mensaje," "),d.zb(1),d.dc("ngIf",t.creador._id!==e.id),d.zb(1),d.dc("ngIf",0===t.vistos.length&&t.creador._id===e.id),d.zb(1),d.dc("ngIf",t.vs)}}function K(t,e){1&t&&(d.Mb(0,"div",49),d.Mb(1,"div"),d.rc(2," Mensajes sin leer "),d.Lb(),d.Lb())}function S(t,e){if(1&t){const t=d.Nb();d.Mb(0,"div",27),d.Ub("click",function(){d.lc(t);const a=e.$implicit,s=e.index;return d.Wb(2).ver(a,s)}),d.qc(1,L,2,1,"ion-avatar",28),d.qc(2,W,8,6,"div",29),d.qc(3,K,3,0,"div",30),d.Lb()}if(2&t){const t=e.$implicit,a=d.Wb(2);d.Bb("right",t.creador._id===a.id)("left",t.creador._id!==a.id),d.zb(1),d.dc("ngIf",t.creador._id!==a.id&&!t.ms),d.zb(1),d.dc("ngIf",!t.ms),d.zb(1),d.dc("ngIf",t.ms)}}function J(t,e){if(1&t){const t=d.Nb();d.Mb(0,"ion-content",null,15),d.Mb(2,"ion-refresher",16),d.Ub("ionRefresh",function(e){return d.lc(t),d.Wb().refrescando(e)}),d.Kb(3,"ion-refresher-content",17),d.Lb(),d.qc(4,I,3,0,"ion-infinite-scroll",18),d.qc(5,P,5,0,"div",19),d.Mb(6,"div",20),d.qc(7,S,4,7,"div",21),d.Lb(),d.Lb()}if(2&t){const t=d.Wb();d.dc("@escribiendo",t.escribiendo?"activo":"noactivo"),d.zb(4),d.dc("ngIf",t.carga),d.zb(1),d.dc("ngIf",!t.carga),d.zb(2),d.dc("ngForOf",t.mensajes)}}function U(t,e){if(1&t){const t=d.Nb();d.Mb(0,"ion-footer"),d.Mb(1,"ion-toolbar"),d.Mb(2,"div",50),d.Mb(3,"ion-textarea",51),d.Ub("ionChange",function(e){return d.lc(t),d.Wb().escribir(e)})("ngModelChange",function(e){return d.lc(t),d.Wb().mensaje=e}),d.Lb(),d.Mb(4,"ion-buttons"),d.Mb(5,"ion-button",10),d.Ub("click",function(){return d.lc(t),d.Wb().enviarmensaje()}),d.Kb(6,"ion-icon",52),d.Lb(),d.Lb(),d.Lb(),d.Lb(),d.Lb()}if(2&t){const t=d.Wb();d.zb(3),d.dc("ngModel",t.mensaje)}}const A=[{path:"",component:(()=>{class t{constructor(t,e,a,s,i,o,n,c,h,p,d){this.almacenamiento=t,this.router=e,this.toast=a,this.socket=s,this.apiPedidos=i,this.cargarElementos=o,this.plt=n,this.modal=c,this.popover=h,this.active=p,this.nav=d,this.mensaje="",this.mensajes=[],this.desde=0,this.carga=!1,this.ct=!0,this.escribiendo=!1,this.frenar=!1,this.parar=!1,this.cargamsg=!1,this.tipo=!1,this.grupo=!1,this.directo=!1,this.mostrar=!1,this.plt.backButton.subscribe(()=>{this.active.snapshot.paramMap.get("tipo")&&!this.active.snapshot.paramMap.get("grupo")?this.nav.navigateRoot("/central/menu/monitoreo"):!this.active.snapshot.paramMap.get("tipo")&&this.active.snapshot.paramMap.get("grupo")?this.nav.navigateRoot(["/interfaz-grupo",this.active.snapshot.paramMap.get("grupo"),"apps",this.active.snapshot.paramMap.get("grupo"),"chats",this.active.snapshot.paramMap.get("grupo")]):this.active.snapshot.paramMap.get("tipo")||this.active.snapshot.paramMap.get("grupo")||!this.active.snapshot.paramMap.get("directo")||(this.directo=!0,"vi"===this.active.snapshot.paramMap.get("ruta")?this.nav.navigateRoot(["/visita",this.active.snapshot.paramMap.get("usuario"),"s","chat",this.active.snapshot.paramMap.get("usuario")]):this.nav.navigateRoot(["/central/buscar/perfil-visita",this.active.snapshot.paramMap.get("usuario")]))}),this.escucharEnvios().subscribe(t=>Object(r.a)(this,void 0,void 0,function*(){if(console.log(t),!this.parar&&t.exe){this.mensaje="",t.resp.ms=!1,t.resp.vs=!1,this.mensajes.push(t.resp);const e=yield this.almacenamiento.obtenerToken();e&&(console.log("entrando",e),this.contenido.scrollToBottom().then(()=>{}).catch(()=>{}),t.resp.creador._id!==e._id&&(console.log("marcar",t,this.parar),this.parar||this.marcar(t.resp._id,this.mensajes.length-1)))}})),this.escucharVistos().subscribe(t=>{console.log(t,"vistos"),this.parar||t.exe&&this.mensajes.map(e=>{e._id===t.id&&(e.vistos=e.vistos.filter(e=>e!==t.usuario))})}),this.escucharEscritoss().subscribe(t=>{console.log("escribiendo..."),t.exe&&(this.escribiendo=!0,setTimeout(()=>{this.escribiendo=!1},1e3))}),this.cargarElementos.$cargarRed.subscribe(t=>Object(r.a)(this,void 0,void 0,function*(){"none"===t&&this.almacenamiento.eleminarSala().then(()=>{this.toast.Especial("Perdiste la conexi\xf3n, verifica la red de internet e intenta nuevamente"),this.router.navigate(["/central/menu/chats"]),this.socket.emit("salidachat",{id:this.sala._id})}).catch(()=>{this.toast.Especial("Perdiste la conexi\xf3n, verifica la red de internet e intenta nuevamente"),this.router.navigate(["/central/menu/chats"]),this.socket.emit("salidachat",{id:this.sala._id})})})),this.plt.resume.subscribe(t=>Object(r.a)(this,void 0,void 0,function*(){this.parar=!1,this.cargamsg=!1,this.ct=!0,this.parar||this.arranca()}))}ngOnInit(){}ionViewWillEnter(){this.parar=!1,this.arranca()}gp(){this.nav.navigateRoot(["/interfaz-grupo",this.active.snapshot.paramMap.get("grupo"),"apps",this.active.snapshot.paramMap.get("grupo"),"chats",this.active.snapshot.paramMap.get("grupo")])}dir(){"vi"===this.active.snapshot.paramMap.get("ruta")?this.nav.navigateRoot(["/visita",this.active.snapshot.paramMap.get("usuario"),"s","chat",this.active.snapshot.paramMap.get("usuario")]):this.nav.navigateRoot(["/central/buscar/perfil-visita",this.active.snapshot.paramMap.get("usuario")])}arranca(){this.active.snapshot.paramMap.get("tipo")&&!this.active.snapshot.paramMap.get("grupo")?"lista"===this.active.snapshot.paramMap.get("tipo")&&(this.tipo=!0):this.active.snapshot.paramMap.get("grupo")&&(this.grupo=!0),this.mensajes=[],this.almacenamiento.obtenerToken().then(t=>{this.id=t._id,this.almacenamiento.obtenerSala().then(t=>{t.length>0?(console.log(t,"info"),this.sala=t[0],this.sala2=t[0],this.socket.emit("iniciochat",{id:this.sala._id}),"directo"===this.sala.tipo&&(this.mostrar=!0),"grupo"===this.sala.tipo&&(this.mostrar=!0),this.sala.creador.imagen[0].path="notfound.png"===this.sala.creador.imagen[0].path?"/assets/notfound.png":this.sala.creador.imagen[0].path.includes("https://www.motocaliapp.com")?this.sala.creador.imagen[0].path:"https://www.motocaliapp.com/"+this.sala.creador.imagen[0].path,this.sala.taller.imagen[0].path="notfound.png"===this.sala.taller.imagen[0].path?"/assets/notfound.png":this.sala.taller.imagen[0].path.includes("https://www.motocaliapp.com")?this.sala.taller.imagen[0].path:"https://www.motocaliapp.com/"+this.sala.taller.imagen[0].path,this.cargarmensajesVistos()):this.active.snapshot.paramMap.get("tipo")&&!this.active.snapshot.paramMap.get("grupo")?this.nav.navigateRoot("/central/menu/monitoreo"):!this.active.snapshot.paramMap.get("tipo")&&this.active.snapshot.paramMap.get("grupo")?this.nav.navigateRoot(["/interfaz-grupo",this.active.snapshot.paramMap.get("grupo"),"apps",this.active.snapshot.paramMap.get("grupo"),"chats",this.active.snapshot.paramMap.get("grupo")]):this.active.snapshot.paramMap.get("tipo")||this.active.snapshot.paramMap.get("grupo")||!this.active.snapshot.paramMap.get("directo")?this.nav.navigateRoot("/central/menu/chats"):(this.directo=!0,"vi"===this.active.snapshot.paramMap.get("ruta")?this.nav.navigateRoot(["/visita",this.active.snapshot.paramMap.get("usuario"),"s","chat",this.active.snapshot.paramMap.get("usuario")]):this.nav.navigateRoot(["/central/buscar/perfil-visita",this.active.snapshot.paramMap.get("usuario")]))})})}refrescando(t){t.detail.complete()}cargaMensajesLimite(t){return Object(r.a)(this,void 0,void 0,function*(){this.desde=this.desde+15;const e=yield this.almacenamiento.obtenerToken();e&&this.apiPedidos.traermensajesNoVistos(e.token,{idsala:this.sala._id,desde:this.desde,accesos:this.sala.accesos}).subscribe(e=>{console.log(e),e.exe?e.response.length>0?(t.target.complete(),e.response.forEach(t=>{t.ms=!1,t.vs=!1,this.mensajes.unshift(t)})):(t.target.disabled=!0,this.desde=0):this.toast.toastError("No se pudo traer los mensajes, int\xe9ntelo m\xe1s tarde")},t=>{this.toast.toastError("No se pudo traer los mensajes, int\xe9ntelo m\xe1s tarde")})})}cargarmensajes(){return Object(r.a)(this,void 0,void 0,function*(){const t=yield this.almacenamiento.obtenerToken();t&&this.apiPedidos.mensajes(t.token,{idsala:this.sala._id,accesos:this.sala.accesos}).subscribe(e=>{console.log(e,"NO LEIDOS HATSA AHORA"),e.exe?(e.response.length>0&&this.mensajes.push({ms:!0,creador:{_id:""}}),e.response.forEach(e=>{e.ms=!1,e.vs=!1,this.mensajes.push(e),this.marcar(e._id,this.mensajes.length-1),this.socket.emit("vistoChat",{idsala:this.sala._id,usuario:t._id,id:e._id})}),console.log(this.mensajes,"MESNAJITOS DE PAN TOSTADO"),this.cargamsg=!0):this.toast.toastError("No se pudo traer los mensajes, int\xe9ntelo m\xe1s tarde"),this.carga=!0},t=>{this.toast.toastError("No se pudo traer los mensajes, int\xe9ntelo m\xe1s tarde")})})}cargarmensajesVistos(){return Object(r.a)(this,void 0,void 0,function*(){const t=yield this.almacenamiento.obtenerToken();t&&this.apiPedidos.traermensajesNoVistos(t.token,{idsala:this.sala._id,desde:this.desde}).subscribe(t=>{console.log(t,"NOLEIDOS"),t.exe?(t.response.forEach((t,e)=>{t.ms=!1,this.mensajes.unshift(t)}),this.contenido.scrollToBottom().then(()=>{this.cargarmensajes()}).catch(()=>{this.cargarmensajes()})):this.toast.toastError("No se pudo traer los mensajes, int\xe9ntelo m\xe1s tarde")},t=>{this.toast.toastError("No se pudo traer los mensajes, int\xe9ntelo m\xe1s tarde")})})}marcar(t,e){return Object(r.a)(this,void 0,void 0,function*(){const a=yield this.almacenamiento.obtenerToken();a&&this.apiPedidos.marcarvisto(a.token,{id:t}).subscribe(t=>{console.log(t,"MARCADO"),t.exe?(this.mensajes[e].vistos=this.mensajes[e].vistos.filter(t=>(console.log(t,"ITEMMMM",this.mensajes[e]),t!==a._id)),this.socket.emit("vistoChat",{idsala:this.sala._id,usuario:a._id,id:this.mensajes[e]._id})):this.toast.toastError("No se marc\xf3 en visto el mensaje, int\xe9ntelo m\xe1s tarde")},t=>{this.toast.toastError("No se marc\xf3 en visto el mensaje, int\xe9ntelo m\xe1s tarde")})})}escribir(t){this.escribiendo=!1,this.mensaje=t.detail.value,this.socket.emit("escribiendoChat",{idsala:this.sala._id})}escucharEnvios(){if(!this.frenar)return new c.a(t=>{this.socket.on("mensajeChat",e=>{t.next(e)})})}escucharEscritoss(){if(!this.frenar)return new c.a(t=>{this.socket.on("escribiendoChat",e=>{t.next(e)})})}escucharVistos(){if(!this.frenar)return new c.a(t=>{this.socket.on("vistoChat",e=>{t.next(e)})})}enviarmensaje(){if(""!==this.mensaje){let t="",e="";this.id!==this.sala.creador._id?(t=this.sala.creador._id,e=this.sala.creador.nombreusuario):(t=this.sala.taller._id,e=this.sala.taller.nombreusuario),console.log(this.sala.accesos),this.socket.emit("mensajeChat",{idsala:this.sala._id,idenvio:t,emisor:e,id:this.id,msg:this.mensaje,sala:this.sala2,accesos:this.sala.accesos,emite:this.id,grupo:this.grupo,vg:this.active.snapshot.paramMap.get("grupo")})}}cerrar(){this.router.navigate(["/central/menu/chats"])}ver(t,e){t.creador._id===this.id&&(this.mensajes[e].vs=!this.mensajes[e].vs)}abrir(t){return Object(r.a)(this,void 0,void 0,function*(){this.parar=!0;const e=yield this.popover.create({component:p.a,componentProps:{id:this.sala._id,tipo:this.tipo},event:t});return yield e.present()})}ionViewWillLeave(){this.parar=!0,this.socket.emit("salidachat",{id:this.sala._id}),this.almacenamiento.eleminarSala().then(()=>{this.socket.emit("salidachat",{id:this.sala._id})}).catch(()=>{this.socket.emit("salidachat",{id:this.sala._id})})}}return t.\u0275fac=function(e){return new(e||t)(d.Jb(l.a),d.Jb(n.g),d.Jb(b.a),d.Jb(u.a),d.Jb(m.a),d.Jb(g.a),d.Jb(o.sb),d.Jb(o.pb),d.Jb(o.tb),d.Jb(n.a),d.Jb(o.qb))},t.\u0275cmp=d.Db({type:t,selectors:[["app-salas-chat"]],viewQuery:function(t,e){if(1&t&&d.vc(M,1),2&t){let t;d.kc(t=d.Vb())&&(e.contenido=t.first)}},decls:15,vars:10,consts:[["color","oscuro"],["slot","start","icon","chevron-back-outline","defaultHref","/central/menu/chats",4,"ngIf"],["slot","start","icon","chevron-back-outline","defaultHref","/central/menu/monitoreo/grua",4,"ngIf"],["slot","start",4,"ngIf"],["class","tipo",4,"ngIf"],[4,"ngIf"],["slot","end",4,"ngIf"],["slot","start","icon","chevron-back-outline","defaultHref","/central/menu/chats"],["slot","start","icon","chevron-back-outline","defaultHref","/central/menu/monitoreo/grua"],["slot","start"],[3,"click"],["slot","icon-only","icon","chevron-back-outline"],[1,"tipo"],["slot","end"],["name","image","slot","icon-only"],["contenido",""],["slot","fixed","pullFactor","0.5","pullMin","50","pullMax","150",3,"ionRefresh"],["pullingIcon","arrow-dropdown","refreshingSpinner","circles"],["threshold","100px","position","top",3,"ionInfinite",4,"ngIf"],["class","centrar",4,"ngIf"],[1,"chats"],["class","chat",3,"right","left","click",4,"ngFor","ngForOf"],["threshold","100px","position","top",3,"ionInfinite"],["inifinito",""],["loadingSpinner","bubbles","loadingText","Cargando Mensajes..."],[1,"centrar"],["name","crescent","color","primary"],[1,"chat",3,"click"],["class","avt",4,"ngIf"],["class","mensaje",4,"ngIf"],["class","mensaje av",4,"ngIf"],[1,"avt"],["alt","",3,"src"],[1,"mensaje"],["class","emisor",4,"ngIf"],["class","",4,"ngIf"],[1,"texto"],["class","fc",4,"ngIf"],["class","visto",4,"ngIf"],["class","vistos",4,"ngIf"],[1,"emisor"],[1,""],[1,"fc"],[1,"visto"],[1,"vistos"],[1,"vistopor"],["class","usuario",4,"ngFor","ngForOf"],[1,"novistopor"],[1,"usuario"],[1,"mensaje","av"],[1,"barra"],["rows","1","placeholder","Escriba el mensaje",3,"ngModel","ionChange","ngModelChange"],["name","send","slot","icon-only","color","oscuro"]],template:function(t,e){1&t&&(d.Mb(0,"ion-header"),d.Mb(1,"ion-toolbar",0),d.qc(2,j,1,0,"ion-back-button",1),d.qc(3,x,1,0,"ion-back-button",2),d.qc(4,O,3,0,"ion-buttons",3),d.qc(5,k,3,0,"ion-buttons",3),d.Mb(6,"ion-title"),d.rc(7,"Chat "),d.qc(8,w,2,1,"span",4),d.Kb(9,"br"),d.qc(10,E,2,1,"div",5),d.qc(11,_,2,1,"div",5),d.Lb(),d.qc(12,C,3,0,"ion-buttons",6),d.Lb(),d.Lb(),d.qc(13,J,8,4,"ion-content",5),d.qc(14,U,7,1,"ion-footer",5)),2&t&&(d.zb(2),d.dc("ngIf",!e.tipo&&!e.grupo&&!e.directo),d.zb(1),d.dc("ngIf",e.tipo&&!e.grupo),d.zb(1),d.dc("ngIf",e.grupo),d.zb(1),d.dc("ngIf",e.directo),d.zb(3),d.dc("ngIf",e.sala),d.zb(2),d.dc("ngIf",e.sala&&e.sala.creador._id!==e.id),d.zb(1),d.dc("ngIf",e.sala&&e.sala.creador._id===e.id),d.zb(1),d.dc("ngIf",!e.grupo&&!e.directo&&!e.mostrar),d.zb(1),d.dc("ngIf",e.ct),d.zb(1),d.dc("ngIf",e.cargamsg))},directives:[o.z,o.kb,s.j,o.ib,o.g,o.h,o.k,o.j,o.A,o.t,o.Q,o.R,s.i,o.C,o.D,o.cb,o.f,o.x,o.hb,o.xb,i.i,i.k],pipes:[f.a,v.a],styles:[".barra[_ngcontent-%COMP%]{width:100%;display:flex;justify-content:space-between;align-items:center}.barra[_ngcontent-%COMP%]   ion-textarea[_ngcontent-%COMP%]{width:80%;border-radius:10px;padding:10px;border:0;outline:none}.centrar[_ngcontent-%COMP%]{width:100%;padding:20px;display:flex;flex-direction:column;align-items:center;justify-content:center}.tipo[_ngcontent-%COMP%]{color:#e3b61c}.chats[_ngcontent-%COMP%]{padding:10px 5px}.chat[_ngcontent-%COMP%]{width:100%;display:flex}.chat[_ngcontent-%COMP%]   .avt[_ngcontent-%COMP%]{width:30px;height:30px;margin:5px 10px}.mensaje[_ngcontent-%COMP%]{width:80%;padding:5px 25px;border-radius:30px;background-color:#f1f1ff;margin-top:10px;position:relative}.av[_ngcontent-%COMP%]{width:100%;border-radius:10px;margin:10px auto;background-color:#fbe9aa;text-align:center;font-size:14px;padding:5px;color:#333}.fc[_ngcontent-%COMP%]{font-size:12px;opacity:.5}.visto[_ngcontent-%COMP%]{position:absolute;bottom:10px;right:20px;width:10px;height:10px;background-color:#b4ba17;border-radius:100%}.right[_ngcontent-%COMP%], .right[_ngcontent-%COMP%]   .mensaje[_ngcontent-%COMP%]{display:flex;justify-content:flex-end}.right[_ngcontent-%COMP%]   .mensaje[_ngcontent-%COMP%]{background-color:#006c78;color:#f1f1ff;font-size:14px;flex-direction:column}.left[_ngcontent-%COMP%]{font-size:14px;font-weight:300}.left[_ngcontent-%COMP%]   .emisor[_ngcontent-%COMP%]{font-weight:700;color:#819830!important;margin-bottom:5px}.vistopor[_ngcontent-%COMP%]{color:#008dd4}.novistopor[_ngcontent-%COMP%]{color:#e53935}.usuario[_ngcontent-%COMP%]{color:#eee}ion-footer[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]{padding:8px}"],data:{animation:[Object(h.l)("escribiendo",[Object(h.i)("activo",Object(h.j)({opacity:1,background:"#BDC3C6"})),Object(h.i)("noactivo",Object(h.j)({opacity:1,background:"#ffffff"})),Object(h.k)("activo <=> noactivo",[Object(h.e)("300ms")])])]}}),t})()}];let D=(()=>{class t{}return t.\u0275mod=d.Hb({type:t}),t.\u0275inj=d.Gb({factory:function(e){return new(e||t)},imports:[[n.i.forChild(A)],n.i]}),t})();var F=a("iTUp"),H=a("zon2");let V=(()=>{class t{}return t.\u0275mod=d.Hb({type:t}),t.\u0275inj=d.Gb({factory:function(e){return new(e||t)},imports:[[s.b,i.e,o.lb,D,F.a,H.a]]}),t})()}}]);